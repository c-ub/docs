<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.51">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="/img/1.jpg"><title>第42节 服务编排（下）：基于Helm的服务编排部署实战 | 你好</title><meta name="description" content="链学社致力于打造出区块链去中心化的学习平台">
    <link rel="modulepreload" href="/assets/app.9967c189.js"><link rel="modulepreload" href="/assets/42.html.529356d0.js"><link rel="modulepreload" href="/assets/42.html.2d4c045c.js"><link rel="prefetch" href="/assets/index.html.a1393c4c.js"><link rel="prefetch" href="/assets/index.html.e3e54846.js"><link rel="prefetch" href="/assets/1.html.22289593.js"><link rel="prefetch" href="/assets/10.html.fcccc2ff.js"><link rel="prefetch" href="/assets/11.html.aac1a3bd.js"><link rel="prefetch" href="/assets/12.html.b371710f.js"><link rel="prefetch" href="/assets/13.html.4c3ede3b.js"><link rel="prefetch" href="/assets/14.html.a5ba315e.js"><link rel="prefetch" href="/assets/15.html.1580a958.js"><link rel="prefetch" href="/assets/16.html.a8349d9b.js"><link rel="prefetch" href="/assets/17.html.429cbcbd.js"><link rel="prefetch" href="/assets/18.html.d15c806b.js"><link rel="prefetch" href="/assets/19.html.070f0886.js"><link rel="prefetch" href="/assets/2.html.99975564.js"><link rel="prefetch" href="/assets/20.html.93b19902.js"><link rel="prefetch" href="/assets/21.html.cf7d1b5d.js"><link rel="prefetch" href="/assets/22.html.db4afbd7.js"><link rel="prefetch" href="/assets/23.html.a1e62360.js"><link rel="prefetch" href="/assets/24.html.21dea561.js"><link rel="prefetch" href="/assets/25.html.49b862c4.js"><link rel="prefetch" href="/assets/26.html.36989258.js"><link rel="prefetch" href="/assets/27.html.571b1d4e.js"><link rel="prefetch" href="/assets/28.html.4b7e2a2b.js"><link rel="prefetch" href="/assets/29.html.251aabee.js"><link rel="prefetch" href="/assets/3.html.3f00f3d0.js"><link rel="prefetch" href="/assets/30.html.225d86b8.js"><link rel="prefetch" href="/assets/31.html.9f14dfc5.js"><link rel="prefetch" href="/assets/32.html.8ac1706b.js"><link rel="prefetch" href="/assets/33.html.1e0dfe99.js"><link rel="prefetch" href="/assets/34.html.f2444c6f.js"><link rel="prefetch" href="/assets/35.html.a4049674.js"><link rel="prefetch" href="/assets/36.html.d4fcf351.js"><link rel="prefetch" href="/assets/37.html.e29eb8b4.js"><link rel="prefetch" href="/assets/38.html.195d22cf.js"><link rel="prefetch" href="/assets/39.html.90f09380.js"><link rel="prefetch" href="/assets/4.html.be4bc5b5.js"><link rel="prefetch" href="/assets/40.html.45d7a4dc.js"><link rel="prefetch" href="/assets/41.html.e3a2ebf7.js"><link rel="prefetch" href="/assets/43.html.647962a9.js"><link rel="prefetch" href="/assets/44.html.804b2ebc.js"><link rel="prefetch" href="/assets/45.html.ecd5924e.js"><link rel="prefetch" href="/assets/46.html.f0df9beb.js"><link rel="prefetch" href="/assets/47.html.69252181.js"><link rel="prefetch" href="/assets/48.html.8df3099d.js"><link rel="prefetch" href="/assets/49.html.bbcbb6ca.js"><link rel="prefetch" href="/assets/5.html.8fa1df64.js"><link rel="prefetch" href="/assets/50.html.88a6df7a.js"><link rel="prefetch" href="/assets/51.html.2cc2cde7.js"><link rel="prefetch" href="/assets/52.html.8f10d639.js"><link rel="prefetch" href="/assets/53.html.87d57c98.js"><link rel="prefetch" href="/assets/54.html.3c986351.js"><link rel="prefetch" href="/assets/55.html.ef79ab9d.js"><link rel="prefetch" href="/assets/56.html.47391418.js"><link rel="prefetch" href="/assets/57.html.ed714ef8.js"><link rel="prefetch" href="/assets/58.html.e45a8f1a.js"><link rel="prefetch" href="/assets/59.html.a4ef2b6b.js"><link rel="prefetch" href="/assets/6.html.222cdccc.js"><link rel="prefetch" href="/assets/60.html.aa3091f2.js"><link rel="prefetch" href="/assets/61.html.d34e05ef.js"><link rel="prefetch" href="/assets/62.html.73c09267.js"><link rel="prefetch" href="/assets/63.html.ee77d345.js"><link rel="prefetch" href="/assets/64.html.e6870d98.js"><link rel="prefetch" href="/assets/65.html.4803352d.js"><link rel="prefetch" href="/assets/66.html.5f7f7cf5.js"><link rel="prefetch" href="/assets/67.html.1dda677a.js"><link rel="prefetch" href="/assets/68.html.46c4b431.js"><link rel="prefetch" href="/assets/69.html.01202045.js"><link rel="prefetch" href="/assets/7.html.af5be859.js"><link rel="prefetch" href="/assets/70.html.698119d7.js"><link rel="prefetch" href="/assets/71.html.bca58bd1.js"><link rel="prefetch" href="/assets/72.html.0c495f64.js"><link rel="prefetch" href="/assets/73.html.1b1da238.js"><link rel="prefetch" href="/assets/74.html.5790a036.js"><link rel="prefetch" href="/assets/75.html.c0efadfb.js"><link rel="prefetch" href="/assets/76.html.80873dd0.js"><link rel="prefetch" href="/assets/77.html.bd454470.js"><link rel="prefetch" href="/assets/78.html.3610e426.js"><link rel="prefetch" href="/assets/79.html.a3fa3730.js"><link rel="prefetch" href="/assets/8.html.ddecb60c.js"><link rel="prefetch" href="/assets/80.html.ca6615ee.js"><link rel="prefetch" href="/assets/81.html.3ec6cf08.js"><link rel="prefetch" href="/assets/82.html.0c2a9c61.js"><link rel="prefetch" href="/assets/83.html.944f8804.js"><link rel="prefetch" href="/assets/84.html.275503f9.js"><link rel="prefetch" href="/assets/85.html.3a401355.js"><link rel="prefetch" href="/assets/86.html.09d84ac5.js"><link rel="prefetch" href="/assets/87.html.01ce4b91.js"><link rel="prefetch" href="/assets/88.html.17f7c6ee.js"><link rel="prefetch" href="/assets/89.html.564a9562.js"><link rel="prefetch" href="/assets/9.html.37eb122c.js"><link rel="prefetch" href="/assets/90.html.cf98daa9.js"><link rel="prefetch" href="/assets/91.html.43673b0c.js"><link rel="prefetch" href="/assets/92.html.4f001ff0.js"><link rel="prefetch" href="/assets/93.html.788d1091.js"><link rel="prefetch" href="/assets/94.html.99533281.js"><link rel="prefetch" href="/assets/95.html.4730f1df.js"><link rel="prefetch" href="/assets/96.html.563b0639.js"><link rel="prefetch" href="/assets/97.html.0597d140.js"><link rel="prefetch" href="/assets/98.html.2ab04005.js"><link rel="prefetch" href="/assets/99.html.4e64dae3.js"><link rel="prefetch" href="/assets/项目管理从理论到实践.html.6b900c97.js"><link rel="prefetch" href="/assets/404.html.c3e557d0.js"><link rel="prefetch" href="/assets/index.html.a716480a.js"><link rel="prefetch" href="/assets/index.html.c089bcfe.js"><link rel="prefetch" href="/assets/1.html.96c1b483.js"><link rel="prefetch" href="/assets/10.html.70df1453.js"><link rel="prefetch" href="/assets/11.html.a85b103a.js"><link rel="prefetch" href="/assets/12.html.0ef42857.js"><link rel="prefetch" href="/assets/13.html.1f81c8e2.js"><link rel="prefetch" href="/assets/14.html.c359f487.js"><link rel="prefetch" href="/assets/15.html.f1b4dadb.js"><link rel="prefetch" href="/assets/16.html.79d50df3.js"><link rel="prefetch" href="/assets/17.html.40ce0fe6.js"><link rel="prefetch" href="/assets/18.html.4e0ae6fa.js"><link rel="prefetch" href="/assets/19.html.8788756f.js"><link rel="prefetch" href="/assets/2.html.f329a49c.js"><link rel="prefetch" href="/assets/20.html.4a956a1c.js"><link rel="prefetch" href="/assets/21.html.3f94d17c.js"><link rel="prefetch" href="/assets/22.html.5053b9b1.js"><link rel="prefetch" href="/assets/23.html.8be33fb3.js"><link rel="prefetch" href="/assets/24.html.bbeadec5.js"><link rel="prefetch" href="/assets/25.html.fe2f9e6a.js"><link rel="prefetch" href="/assets/26.html.fc1b153f.js"><link rel="prefetch" href="/assets/27.html.5337558f.js"><link rel="prefetch" href="/assets/28.html.5462b281.js"><link rel="prefetch" href="/assets/29.html.ef61bbec.js"><link rel="prefetch" href="/assets/3.html.bf234322.js"><link rel="prefetch" href="/assets/30.html.0a5d70b0.js"><link rel="prefetch" href="/assets/31.html.ebde0fef.js"><link rel="prefetch" href="/assets/32.html.6aae646d.js"><link rel="prefetch" href="/assets/33.html.e48da599.js"><link rel="prefetch" href="/assets/34.html.f4bb5633.js"><link rel="prefetch" href="/assets/35.html.e963c197.js"><link rel="prefetch" href="/assets/36.html.5c9f4e1e.js"><link rel="prefetch" href="/assets/37.html.bc9a6296.js"><link rel="prefetch" href="/assets/38.html.e338e385.js"><link rel="prefetch" href="/assets/39.html.7e20dff2.js"><link rel="prefetch" href="/assets/4.html.276640c7.js"><link rel="prefetch" href="/assets/40.html.9c106b7a.js"><link rel="prefetch" href="/assets/41.html.168b7905.js"><link rel="prefetch" href="/assets/43.html.481a8931.js"><link rel="prefetch" href="/assets/44.html.967f15b5.js"><link rel="prefetch" href="/assets/45.html.fcb4112e.js"><link rel="prefetch" href="/assets/46.html.bc42d448.js"><link rel="prefetch" href="/assets/47.html.c114ab47.js"><link rel="prefetch" href="/assets/48.html.05bf051d.js"><link rel="prefetch" href="/assets/49.html.8a079965.js"><link rel="prefetch" href="/assets/5.html.97bda10f.js"><link rel="prefetch" href="/assets/50.html.0f921e42.js"><link rel="prefetch" href="/assets/51.html.d48cb7de.js"><link rel="prefetch" href="/assets/52.html.e4e46567.js"><link rel="prefetch" href="/assets/53.html.54cefd27.js"><link rel="prefetch" href="/assets/54.html.fdf640a1.js"><link rel="prefetch" href="/assets/55.html.b19c799a.js"><link rel="prefetch" href="/assets/56.html.43da74bc.js"><link rel="prefetch" href="/assets/57.html.69632d1b.js"><link rel="prefetch" href="/assets/58.html.f5b4e3f3.js"><link rel="prefetch" href="/assets/59.html.25ecce2f.js"><link rel="prefetch" href="/assets/6.html.e5b8fe57.js"><link rel="prefetch" href="/assets/60.html.db1ec12a.js"><link rel="prefetch" href="/assets/61.html.9a7ab3dc.js"><link rel="prefetch" href="/assets/62.html.50e959f0.js"><link rel="prefetch" href="/assets/63.html.3018c48d.js"><link rel="prefetch" href="/assets/64.html.c3f1e1db.js"><link rel="prefetch" href="/assets/65.html.d2ca4759.js"><link rel="prefetch" href="/assets/66.html.a742a77e.js"><link rel="prefetch" href="/assets/67.html.1eddb882.js"><link rel="prefetch" href="/assets/68.html.d999abb5.js"><link rel="prefetch" href="/assets/69.html.bfef55ae.js"><link rel="prefetch" href="/assets/7.html.e0dcc1dd.js"><link rel="prefetch" href="/assets/70.html.a56bd111.js"><link rel="prefetch" href="/assets/71.html.0dc0dbb6.js"><link rel="prefetch" href="/assets/72.html.4b8d08dd.js"><link rel="prefetch" href="/assets/73.html.be971ead.js"><link rel="prefetch" href="/assets/74.html.9f9ddcf6.js"><link rel="prefetch" href="/assets/75.html.f0312169.js"><link rel="prefetch" href="/assets/76.html.a48d8cc2.js"><link rel="prefetch" href="/assets/77.html.e20640c8.js"><link rel="prefetch" href="/assets/78.html.0370074f.js"><link rel="prefetch" href="/assets/79.html.8564ea9c.js"><link rel="prefetch" href="/assets/8.html.d0817860.js"><link rel="prefetch" href="/assets/80.html.e7246294.js"><link rel="prefetch" href="/assets/81.html.cb37703e.js"><link rel="prefetch" href="/assets/82.html.ac0663c4.js"><link rel="prefetch" href="/assets/83.html.fa76c17d.js"><link rel="prefetch" href="/assets/84.html.4e2cc728.js"><link rel="prefetch" href="/assets/85.html.dc517fe3.js"><link rel="prefetch" href="/assets/86.html.0a418a90.js"><link rel="prefetch" href="/assets/87.html.e13ae7b2.js"><link rel="prefetch" href="/assets/88.html.94185858.js"><link rel="prefetch" href="/assets/89.html.b9178319.js"><link rel="prefetch" href="/assets/9.html.7ed4bc7b.js"><link rel="prefetch" href="/assets/90.html.8fecf4cc.js"><link rel="prefetch" href="/assets/91.html.f2aab256.js"><link rel="prefetch" href="/assets/92.html.92d20a97.js"><link rel="prefetch" href="/assets/93.html.60aee91c.js"><link rel="prefetch" href="/assets/94.html.98e17b8e.js"><link rel="prefetch" href="/assets/95.html.0d8f773c.js"><link rel="prefetch" href="/assets/96.html.9f0e1107.js"><link rel="prefetch" href="/assets/97.html.bb6d8d92.js"><link rel="prefetch" href="/assets/98.html.83788c50.js"><link rel="prefetch" href="/assets/99.html.b083ab4c.js"><link rel="prefetch" href="/assets/项目管理从理论到实践.html.14b72e37.js"><link rel="prefetch" href="/assets/404.html.c06d2c49.js">
    <link rel="stylesheet" href="/assets/style.03848e77.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="切换侧边栏" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><!----><span class="site-name can-hide">你好</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="🤵关于我"><span class="title">🤵关于我</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="🤵关于我"><span class="title">🤵关于我</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a class="external-link" href="https://github.com/cubxxw/awesome-cs-cloudnative-blockchain" rel="noopener noreferrer" target="_blank" aria-label="Github仓库"><!--[--><!--]--> Github仓库 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="http://nsddd.top" rel="noopener noreferrer" target="_blank" aria-label="我的博客"><!--[--><!--]--> 我的博客 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="https://www.zhihu.com/people/3293172751" rel="noopener noreferrer" target="_blank" aria-label="知乎"><!--[--><!--]--> 知乎 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="https://github.com/kubecub/" rel="noopener noreferrer" target="_blank" aria-label="⛓️链学社组织"><!--[--><!--]--> ⛓️链学社组织 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a href="/" class="" aria-label="🏠首页"><!--[--><!--]--> 🏠首页 <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://docker.nsddd.top/" rel="noopener noreferrer" target="_blank" aria-label="🐋docker文档"><!--[--><!--]--> 🐋docker文档 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="📚go文档"><span class="title">📚go文档</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="📚go文档"><span class="title">📚go文档</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/projec/" class="" aria-label="🔥 K8s-Iam 项目"><!--[--><!--]--> 🔥 K8s-Iam 项目 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/k8s/" class="" aria-label="🔥 k8s 教程"><!--[--><!--]--> 🔥 k8s 教程 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/k8s-iam/" class="" aria-label="🔥 iam 教程"><!--[--><!--]--> 🔥 iam 教程 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/kubecub/docs" rel="noopener noreferrer" target="_blank" aria-label="查看源码"><!--[--><!--]--> 查看源码 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="切换颜色模式"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><div id="docsearch-container"></div></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="🤵关于我"><span class="title">🤵关于我</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="🤵关于我"><span class="title">🤵关于我</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a class="external-link" href="https://github.com/cubxxw/awesome-cs-cloudnative-blockchain" rel="noopener noreferrer" target="_blank" aria-label="Github仓库"><!--[--><!--]--> Github仓库 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="http://nsddd.top" rel="noopener noreferrer" target="_blank" aria-label="我的博客"><!--[--><!--]--> 我的博客 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="https://www.zhihu.com/people/3293172751" rel="noopener noreferrer" target="_blank" aria-label="知乎"><!--[--><!--]--> 知乎 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="https://github.com/kubecub/" rel="noopener noreferrer" target="_blank" aria-label="⛓️链学社组织"><!--[--><!--]--> ⛓️链学社组织 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a href="/" class="" aria-label="🏠首页"><!--[--><!--]--> 🏠首页 <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://docker.nsddd.top/" rel="noopener noreferrer" target="_blank" aria-label="🐋docker文档"><!--[--><!--]--> 🐋docker文档 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="📚go文档"><span class="title">📚go文档</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="📚go文档"><span class="title">📚go文档</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/projec/" class="" aria-label="🔥 K8s-Iam 项目"><!--[--><!--]--> 🔥 K8s-Iam 项目 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/k8s/" class="" aria-label="🔥 k8s 教程"><!--[--><!--]--> 🔥 k8s 教程 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/k8s-iam/" class="" aria-label="🔥 iam 教程"><!--[--><!--]--> 🔥 iam 教程 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/kubecub/docs" rel="noopener noreferrer" target="_blank" aria-label="查看源码"><!--[--><!--]--> 查看源码 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><a href="/" class="sidebar-item sidebar-heading" aria-label="🏠回到主页"><!--[--><!--]--> 🏠回到主页 <!--[--><!--]--></a><!----></li><li><p tabindex="0" class="sidebar-item sidebar-heading active">🔥 Go语言基础篇 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/iam/projects/1.html" class="sidebar-item" aria-label="第1节 IAM项目介绍"><!--[--><!--]--> 第1节 IAM项目介绍 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/2.html" class="sidebar-item" aria-label="第2节 IAM项目部署"><!--[--><!--]--> 第2节 IAM项目部署 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/3.html" class="sidebar-item" aria-label="第3节 设计规范"><!--[--><!--]--> 第3节 设计规范 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/4.html" class="sidebar-item" aria-label="第4节 Go语言项目设计"><!--[--><!--]--> 第4节 Go语言项目设计 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/5.html" class="sidebar-item" aria-label="第5节 设计并写出优雅的Go语言项目"><!--[--><!--]--> 第5节 设计并写出优雅的Go语言项目 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/6.html" class="sidebar-item" aria-label="第6节 API 风格设计"><!--[--><!--]--> 第6节 API 风格设计 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/7.html" class="sidebar-item" aria-label="第7节 高质量的Makefile"><!--[--><!--]--> 第7节 高质量的Makefile <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/8.html" class="sidebar-item" aria-label="第8节 IAM 项目如何进行研发流程管理"><!--[--><!--]--> 第8节 IAM 项目如何进行研发流程管理 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/9.html" class="sidebar-item" aria-label="第9节 静态代码检测"><!--[--><!--]--> 第9节 静态代码检测 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/10.html" class="sidebar-item" aria-label="第10节 如何生成 Swagger API 文档"><!--[--><!--]--> 第10节 如何生成 Swagger API 文档 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/11.html" class="sidebar-item" aria-label="第11节 设计一套科学的错误码"><!--[--><!--]--> 第11节 设计一套科学的错误码 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/12.html" class="sidebar-item" aria-label="第12节 记录和设计日志"><!--[--><!--]--> 第12节 记录和设计日志 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/13.html" class="sidebar-item" aria-label="第13节  从 0 编写一个日志包"><!--[--><!--]--> 第13节  从 0 编写一个日志包 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/14.html" class="sidebar-item" aria-label="第14节 Pflag、Viper、Cobra 核心功能介绍"><!--[--><!--]--> 第14节 Pflag、Viper、Cobra 核心功能介绍 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/15.html" class="sidebar-item" aria-label="第15节 如何构建一个优秀的企业应用框架"><!--[--><!--]--> 第15节 如何构建一个优秀的企业应用框架 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/16.html" class="sidebar-item" aria-label="第16节 Gin 框架"><!--[--><!--]--> 第16节 Gin 框架 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/17.html" class="sidebar-item" aria-label="第17节 认证机制：应用程序如何进行访问认证？"><!--[--><!--]--> 第17节 认证机制：应用程序如何进行访问认证？ <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/18.html" class="sidebar-item" aria-label="第18节 IAM 项目认证"><!--[--><!--]--> 第18节 IAM 项目认证 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/19.html" class="sidebar-item" aria-label="第19节 权限模型：5大权限模型是如何进行资源授权的？"><!--[--><!--]--> 第19节 权限模型：5大权限模型是如何进行资源授权的？ <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/20.html" class="sidebar-item" aria-label="第20节 控制流（上）：通过iam-apiserver设计，看Web服务的构建"><!--[--><!--]--> 第20节 控制流（上）：通过iam-apiserver设计，看Web服务的构建 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/21.html" class="sidebar-item" aria-label="第21节 控制流（下）：iam-apiserver服务核心功能实现讲解"><!--[--><!--]--> 第21节 控制流（下）：iam-apiserver服务核心功能实现讲解 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/22.html" class="sidebar-item" aria-label="第22节 ORM：CURD 神器 GORM 包介绍及实战"><!--[--><!--]--> 第22节 ORM：CURD 神器 GORM 包介绍及实战 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/23.html" class="sidebar-item" aria-label="第23节 数据流：通过iam-authz-server设计，看数据流服务的设计"><!--[--><!--]--> 第23节 数据流：通过iam-authz-server设计，看数据流服务的设计 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/24.html" class="sidebar-item" aria-label="第24节 数据处理：如何高效处理应用程序产生的数据？"><!--[--><!--]--> 第24节 数据处理：如何高效处理应用程序产生的数据？ <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/25.html" class="sidebar-item" aria-label="第25节  SDK 设计（上）：如何设计出一个优秀的 Go SDK？"><!--[--><!--]--> 第25节  SDK 设计（上）：如何设计出一个优秀的 Go SDK？ <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/26.html" class="sidebar-item" aria-label="第26节  SDK 设计（下）：IAM项目Go SDK设计和实现"><!--[--><!--]--> 第26节  SDK 设计（下）：IAM项目Go SDK设计和实现 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/27.html" class="sidebar-item" aria-label="第27节 效率神器：如何设计和实现一个命令行客户端工具？"><!--[--><!--]--> 第27节 效率神器：如何设计和实现一个命令行客户端工具？ <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/28.html" class="sidebar-item" aria-label="第28节 代码测试（上）：如何编写 Go 语言单元测试和性能测试用例？"><!--[--><!--]--> 第28节 代码测试（上）：如何编写 Go 语言单元测试和性能测试用例？ <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/29.html" class="sidebar-item" aria-label="第29节 代码测试（下）：Go 语言其他测试类型及 IAM 测试介绍"><!--[--><!--]--> 第29节 代码测试（下）：Go 语言其他测试类型及 IAM 测试介绍 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/30.html" class="sidebar-item" aria-label="第30节 性能分析（上）：如何分析 Go 语言代码的性能？"><!--[--><!--]--> 第30节 性能分析（上）：如何分析 Go 语言代码的性能？ <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/31.html" class="sidebar-item" aria-label="第31节 性能分析（下）：API Server性能测试和调优实战"><!--[--><!--]--> 第31节 性能分析（下）：API Server性能测试和调优实战 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/32.html" class="sidebar-item" aria-label="第32节 软件部署实战（上）：部署方案及负载均衡、高可用组件介绍"><!--[--><!--]--> 第32节 软件部署实战（上）：部署方案及负载均衡、高可用组件介绍 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/33.html" class="sidebar-item" aria-label="第33节 软件部署实战（中）：IAM 系统生产环境部署实战"><!--[--><!--]--> 第33节 软件部署实战（中）：IAM 系统生产环境部署实战 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/34.html" class="sidebar-item" aria-label="第34节 软件部署实战（下）：IAM系统安全加固、水平扩缩容实战"><!--[--><!--]--> 第34节 软件部署实战（下）：IAM系统安全加固、水平扩缩容实战 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/35.html" class="sidebar-item" aria-label="第35节 技术演进（上）：虚拟化技术演进之路"><!--[--><!--]--> 第35节 技术演进（上）：虚拟化技术演进之路 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/36.html" class="sidebar-item" aria-label="第36节 技术演进（下）：软件架构和应用生命周期技术演进之路"><!--[--><!--]--> 第36节 技术演进（下）：软件架构和应用生命周期技术演进之路 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/37.html" class="sidebar-item" aria-label="第37节 基于Kubernetes的云原生架构设计"><!--[--><!--]--> 第37节 基于Kubernetes的云原生架构设计 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/38.html" class="sidebar-item" aria-label="第38节 如何制作Docker镜像？"><!--[--><!--]--> 第38节 如何制作Docker镜像？ <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/39.html" class="sidebar-item" aria-label="第39节 如何编写Kubernetes资源定义文件？"><!--[--><!--]--> 第39节 如何编写Kubernetes资源定义文件？ <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/40.html" class="sidebar-item" aria-label="第40节 IAM 容器化部署实战"><!--[--><!--]--> 第40节 IAM 容器化部署实战 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/41.html" class="sidebar-item" aria-label="第41节 服务编排（上）：Helm服务编排基础知识"><!--[--><!--]--> 第41节 服务编排（上）：Helm服务编排基础知识 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/iam/projects/42.html" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="第42节 服务编排（下）：基于Helm的服务编排部署实战"><!--[--><!--]--> 第42节 服务编排（下）：基于Helm的服务编排部署实战 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/iam/projects/42.html#制作iam-chart包" class="router-link-active router-link-exact-active sidebar-item" aria-label="制作IAM Chart包"><!--[--><!--]--> 制作IAM Chart包 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/iam/projects/42.html#iam-chart部署" class="router-link-active router-link-exact-active sidebar-item" aria-label="IAM Chart部署"><!--[--><!--]--> IAM Chart部署 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/iam/projects/42.html#iam应用多环境部署" class="router-link-active router-link-exact-active sidebar-item" aria-label="IAM应用多环境部署"><!--[--><!--]--> IAM应用多环境部署 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/iam/projects/42.html#总结" class="router-link-active router-link-exact-active sidebar-item" aria-label="总结"><!--[--><!--]--> 总结 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/iam/projects/42.html#课后练习" class="router-link-active router-link-exact-active sidebar-item" aria-label="课后练习"><!--[--><!--]--> 课后练习 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/iam/projects/42.html#end-链接" class="router-link-active router-link-exact-active sidebar-item" aria-label="END 链接"><!--[--><!--]--> END 链接 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a href="/iam/projects/43.html" class="sidebar-item" aria-label="第43节 基于 GitHub Actions 的 CI 实战"><!--[--><!--]--> 第43节 基于 GitHub Actions 的 CI 实战 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/44.html" class="sidebar-item" aria-label="第44节 可直接套用的 Go 编码规范"><!--[--><!--]--> 第44节 可直接套用的 Go 编码规范 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/45.html" class="sidebar-item" aria-label="第45节 Go Modules依赖包管理全讲"><!--[--><!--]--> 第45节 Go Modules依赖包管理全讲 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/46.html" class="sidebar-item" aria-label="第46节 IAM排障指南"><!--[--><!--]--> 第46节 IAM排障指南 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/47.html" class="sidebar-item" aria-label="第47节"><!--[--><!--]--> 第47节 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/48.html" class="sidebar-item" aria-label="第48节 分布式系统设计"><!--[--><!--]--> 第48节 分布式系统设计 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/49.html" class="sidebar-item" aria-label="第49节 如何从小白进阶成 Go 语言专家？"><!--[--><!--]--> 第49节 如何从小白进阶成 Go 语言专家？ <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/50.html" class="sidebar-item" aria-label="第50节"><!--[--><!--]--> 第50节 <!--[--><!--]--></a><!----></li><li><a class="external-link sidebar-item" href="https://nsddd.top/archives/contributors" rel="noopener noreferrer" target="_blank" aria-label="💝如何参与贡献？"><!--[--><!--]--> 💝如何参与贡献？ <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><ul><li><a href="https://github.com/cubxxw/iam" target="_blank" rel="noopener noreferrer">🔥 开源地址<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><h1 id="第42节-服务编排-下-基于helm的服务编排部署实战" tabindex="-1"><a class="header-anchor" href="#第42节-服务编排-下-基于helm的服务编排部署实战" aria-hidden="true">#</a> 第42节 服务编排（下）：基于Helm的服务编排部署实战</h1><br><div><a href="41.md" style="float:left;">⬆️上一节🔗 </a><a href="43.md" style="float:right;"> ⬇️下一节🔗</a></div><br><blockquote><p>❤️💕💕During the winter vacation, I followed up and learned two projects: tiktok project and IAM project, and summarized and practiced the CloudNative project and Go language. I learned a lot in the process.Myblog:<a href="http://nsddd.top/" target="_blank" rel="noopener noreferrer">http://nsddd.top<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></blockquote><hr><nav class="table-of-contents"><ul><li><a aria-current="page" href="/iam/projects/42.html#制作iam-chart包" class="router-link-active router-link-exact-active">制作IAM Chart包</a></li><li><a aria-current="page" href="/iam/projects/42.html#iam-chart部署" class="router-link-active router-link-exact-active">IAM Chart部署</a></li><li><a aria-current="page" href="/iam/projects/42.html#iam应用多环境部署" class="router-link-active router-link-exact-active">IAM应用多环境部署</a></li><li><a aria-current="page" href="/iam/projects/42.html#总结" class="router-link-active router-link-exact-active">总结</a></li><li><a aria-current="page" href="/iam/projects/42.html#课后练习" class="router-link-active router-link-exact-active">课后练习</a></li><li><a aria-current="page" href="/iam/projects/42.html#end-链接" class="router-link-active router-link-exact-active">END 链接</a></li></ul></nav><p>[TOC]</p><p>上一讲，我介绍了 Helm 的基础知识，并带着你部署了一个简单的应用。掌握Helm的基础知识之后，今天我们就来实战下，一起通过Helm部署一个IAM应用。</p><p>通过Helm部署IAM应用，首先需要制作IAM Chart包，然后通过Chart包来一键部署IAM应用。在实际开发中，我们需要将应用部署在不同的环境中，所以我也会给你演示下如何在多环境中部署IAM应用。</p><h2 id="制作iam-chart包" tabindex="-1"><a class="header-anchor" href="#制作iam-chart包" aria-hidden="true">#</a> 制作IAM Chart包</h2><p>在部署IAM应用之前，我们首先需要制作一个IAM Chart包。</p><p>我们假设IAM项目源码根目录为<code>$</code>，进入 <code>$/deployments</code>目录，在该目录下创建Chart包。具体创建流程分为四个步骤，下面我来详细介绍下。</p><p>**第一步，**创建一个模板Chart。</p><p>Chart是一个组织在文件目录中的集合，目录名称就是Chart名称（没有版本信息）。你可以看看这个 <a href="https://helm.sh/zh/docs/topics/charts" target="_blank" rel="noopener noreferrer">Chart 开发指南<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> ，它介绍了如何开发你自己的Chart。</p><p>不过，这里你也可以使用 <code>helm create</code> 命令来快速创建一个模板Chart，并基于该Chart进行修改，得到你自己的Chart。创建命令如下：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ helm create iam
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><code>helm create iam</code>会在当前目录下生成一个<code>iam</code>目录，里面存放的就是Chart文件。Chart目录结构及文件如下：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ tree <span class="token parameter variable">-FC</span> iam/
├── charts/                            <span class="token comment"># [可选]: 该目录中放置当前Chart依赖的其他Chart</span>
├── Chart.yaml                         <span class="token comment"># YAML文件，用于描述Chart的基本信息，包括名称版本等</span>
├── templates/                         <span class="token comment"># [可选]: 部署文件模版目录，模版使用的值来自values.yaml和由Tiller提供的值</span>
│   ├── deployment.yaml                <span class="token comment"># Kubernetes Deployment object</span>
│   ├── _helpers.tpl                   <span class="token comment"># 用于修改Kubernetes objcet配置的模板</span>
│   ├── hpa.yaml                       <span class="token comment"># Kubernetes HPA object</span>
│   ├── ingress.yaml                   <span class="token comment"># Kubernetes Ingress object</span>
│   ├── NOTES.txt                      <span class="token comment"># [可选]: 放置Chart的使用指南</span>
│   ├── serviceaccount.yaml
│   ├── service.yaml
│   └── tests/                         <span class="token comment"># 定义了一些测试资源</span>
│       └── test-connection.yaml
└── values.yaml                        <span class="token comment"># Chart的默认配置文件</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面的目录中，有两个比较重要的文件：</p><ul><li>Chart.yaml 文件</li><li>templates目录</li></ul><p>下面我来详细介绍下这两个文件。<strong>我们先来看Chart.yaml 文件。</strong></p><p>Chart.yaml用来描述Chart的基本信息，包括名称、版本等，内容如下：</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> Chart API 版本 （必需）
<span class="token key atrule">name</span><span class="token punctuation">:</span> Chart名称 （必需）
<span class="token key atrule">version</span><span class="token punctuation">:</span> 语义化版本（必需）
<span class="token key atrule">kubeVersion</span><span class="token punctuation">:</span> 兼容Kubernetes版本的语义化版本（可选）
<span class="token key atrule">description</span><span class="token punctuation">:</span> 对这个项目的一句话描述（可选）
<span class="token key atrule">type</span><span class="token punctuation">:</span> Chart类型 （可选）
<span class="token key atrule">keywords</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> 关于项目的一组关键字（可选）
<span class="token key atrule">home</span><span class="token punctuation">:</span> 项目home页面的URL （可选）
<span class="token key atrule">sources</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> 项目源码的URL列表（可选）
<span class="token key atrule">dependencies</span><span class="token punctuation">:</span> <span class="token comment"># chart 必要条件列表 （可选）</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Chart名称 (nginx)
    <span class="token key atrule">version</span><span class="token punctuation">:</span> Chart版本 (&quot;1.2.3&quot;)
    <span class="token key atrule">repository</span><span class="token punctuation">:</span> （可选）仓库URL (&quot;https<span class="token punctuation">:</span>//example.com/charts&quot;) 或别名 (&quot;@repo<span class="token punctuation">-</span>name&quot;)
    <span class="token key atrule">condition</span><span class="token punctuation">:</span> （可选） 解析为布尔值的YAML路径，用于启用/禁用Chart(e.g. subchart1.enabled )
    <span class="token key atrule">tags</span><span class="token punctuation">:</span> <span class="token comment"># （可选）</span>
      <span class="token punctuation">-</span> 用于一次启用/禁用 一组Chart的tag
    <span class="token key atrule">import-values</span><span class="token punctuation">:</span> <span class="token comment"># （可选）</span>
      <span class="token punctuation">-</span> ImportValue 保存源值到导入父键的映射。每项可以是字符串或者一对子/父列表项
    <span class="token key atrule">alias</span><span class="token punctuation">:</span> （可选） Chart中使用的别名。当你要多次添加相同的Chart时会很有用
<span class="token key atrule">maintainers</span><span class="token punctuation">:</span> <span class="token comment"># （可选）</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> 维护者名字 （每个维护者都需要）
    <span class="token key atrule">email</span><span class="token punctuation">:</span> 维护者邮箱 （每个维护者可选）
    <span class="token key atrule">url</span><span class="token punctuation">:</span> 维护者URL （每个维护者可选）
<span class="token key atrule">icon</span><span class="token punctuation">:</span> 用作icon的SVG或PNG图片URL （可选）
<span class="token key atrule">appVersion</span><span class="token punctuation">:</span> 包含的应用版本（可选）。不需要是语义化，建议使用引号
<span class="token key atrule">deprecated</span><span class="token punctuation">:</span> 不被推荐的Chart（可选，布尔值）
<span class="token key atrule">annotations</span><span class="token punctuation">:</span>
  <span class="token key atrule">example</span><span class="token punctuation">:</span> 按名称输入的批注列表 （可选）.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>**我们再来看下\\templates目录\\这个文件。</p><p>templates目录中包含了应用中各个Kubernetes资源的YAML格式资源定义模板，例如：</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> .Values.pump.name <span class="token punctuation">}</span><span class="token punctuation">}</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> .Values.pump.name <span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> http
    <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
    <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">-</span> toYaml .Values.pump.service.http<span class="token punctuation">|</span> nindent 4 <span class="token punctuation">}</span><span class="token punctuation">}</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> .Values.pump.name <span class="token punctuation">}</span><span class="token punctuation">}</span>
  <span class="token key atrule">sessionAffinity</span><span class="token punctuation">:</span> None
  <span class="token key atrule">type</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> .Values.serviceType <span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>{}</code>会被<code>deployments/iam/values.yaml</code>文件中<code>pump.name</code>的值替换。上面的模版语法扩展了 Go <code>text/template</code>包的语法：</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment"># 这种方式定义的模版，会去除test模版尾部所有的空行</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">-</span> define &quot;test&quot;<span class="token punctuation">}</span><span class="token punctuation">}</span>
模版内容
<span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">-</span> end<span class="token punctuation">}</span><span class="token punctuation">}</span>

<span class="token comment"># 去除test模版头部的第一个空行</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">-</span> template &quot;test&quot; <span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>下面是用于YAML文件前置空格的语法：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 这种方式定义的模版，会去除test模版头部和尾部所有的空行</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span>- define <span class="token string">&quot;test&quot;</span> -<span class="token punctuation">}</span><span class="token punctuation">}</span>
模版内容
<span class="token punctuation">{</span><span class="token punctuation">{</span>- end -<span class="token punctuation">}</span><span class="token punctuation">}</span>

<span class="token comment"># 可以在test模版每一行的头部增加4个空格，用于YAML文件的对齐</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span> include <span class="token string">&quot;test&quot;</span> <span class="token operator">|</span> indent <span class="token number">4</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>最后，这里有三点需要你注意：</p><ul><li>Chart名称必须是小写字母和数字，单词之间可以使用横杠<code>-</code>分隔，Chart名称中不能用大写字母，也不能用下划线，<code>.</code>号也不行。</li><li>尽可能使用<a href="https://semver.org/" target="_blank" rel="noopener noreferrer">SemVer 2<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>来表示版本号。</li><li>YAML 文件应该按照双空格的形式缩进(一定不要使用tab键)。</li></ul><p>第二步，编辑 <code>iam</code> 目录下的Chart文件。</p><p>我们可以基于<code>helm create</code>生成的模板Chart来构建自己的Chart包。这里我们添加了创建iam-apiserver、iam-authz-server、iam-pump、iamctl服务需要的YAML格式的Kubernetes资源文件模板：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">ls</span> <span class="token parameter variable">-1</span> iam/templates/*.yaml
iam/templates/hpa.yaml                                   <span class="token comment"># Kubernetes HPA模板文件</span>
iam/templates/iam-apiserver-deployment.yaml              <span class="token comment"># iam-apiserver服务deployment模板文件</span>
iam/templates/iam-apiserver-service.yaml                 <span class="token comment"># iam-apiserver服务service模板文件</span>
iam/templates/iam-authz-server-deployment.yaml           <span class="token comment"># iam-authz-server服务deployment模板文件</span>
iam/templates/iam-authz-server-service.yaml              <span class="token comment"># iam-authz-server服务service模板文件</span>
iam/templates/iamctl-deployment.yaml                     <span class="token comment"># iamctl服务deployment模板文件</span>
iam/templates/iam-pump-deployment.yaml                   <span class="token comment"># iam-pump服务deployment模板文件</span>
iam/templates/iam-pump-service.yaml                      <span class="token comment"># iam-pump服务service模板文件</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>模板的具体内容，你可以查看<a href="https://github.com/marmotedu/iam/tree/v1.1.0/deployments/iam/templates" target="_blank" rel="noopener noreferrer">deployments/iam/templates/<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>。</p><p>在编辑 Chart 时，我们可以通过 <code>helm lint</code> 验证格式是否正确，例如：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ helm lint iam
<span class="token operator">==</span><span class="token operator">&gt;</span> Linting iam

<span class="token number">1</span> chart<span class="token punctuation">(</span>s<span class="token punctuation">)</span> linted, <span class="token number">0</span> chart<span class="token punctuation">(</span>s<span class="token punctuation">)</span> failed
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>0 chart(s) failed</code> 说明当前Iam Chart包是通过校验的。</p><p>第三步，修改Chart的配置文件，添加自定义配置。</p><p>我们可以编辑<code>deployments/iam/values.yaml</code>文件，定制自己的配置。具体配置你可以参考<a href="https://github.com/marmotedu/iam/blob/v1.1.0/deployments/iam/values.yaml" target="_blank" rel="noopener noreferrer">deployments/iam/values.yaml<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>。</p><p>在修改 <code>values.yaml</code> 文件时，你可以参考下面这些最佳实践。</p><ul><li>变量名称以小写字母开头，单词按驼峰区分，例如<code>chickenNoodleSoup</code>。</li><li>给所有字符串类型的值加上引号。</li><li>为了避免整数转换问题，将整型存储为字符串更好，并用 <code>{{ int $value }}</code> 在模板中将字符串转回整型。</li><li><code>values.yaml</code>中定义的每个属性都应该文档化。文档字符串应该以它要描述的属性开头，并至少给出一句描述。例如：</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># serverHost is the host name for the webserver</span>
serverHost: example
<span class="token comment"># serverPort is the HTTP listener port for the webserver</span>
serverPort: <span class="token number">9191</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这里需要注意，所有的Helm内置变量都以大写字母开头，以便与用户定义的value进行区分，例如<code>.Release.Name</code>、<code>.Capabilities.KubeVersion</code>。</p><p>为了安全，values.yaml中只配置Kubernetes资源相关的配置项，例如Deployment副本数、Service端口等。至于iam-apiserver、iam-authz-server、iam-pump、iamctl组件的配置文件，我们创建单独的ConfigMap，并在Deployment中引用。</p><p>第四步，打包Chart，并上传到Chart仓库中。</p><p>这是一个可选步骤，可以根据你的实际需要来选择。如果想了解具体操作，你可以查看 <a href="https://helm.sh/zh/docs/topics/chart_repository" target="_blank" rel="noopener noreferrer">Helm chart 仓库<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>获取更多信息。</p><p>最后，IAM应用的Chart包见<a href="https://github.com/marmotedu/iam/tree/v1.1.0/deployments/iam" target="_blank" rel="noopener noreferrer">deployments/iam<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>。</p><h2 id="iam-chart部署" tabindex="-1"><a class="header-anchor" href="#iam-chart部署" aria-hidden="true">#</a> IAM Chart部署</h2><p>上面，我们制作了IAM应用的Chart包，接下来我们就使用这个Chart包来一键创建IAM应用。IAM Chart部署一共分为10个步骤，你可以跟着我一步步操作下。</p><p>第一步，配置<code>scripts/install/environment.sh</code>。</p><p><code>scripts/install/environment.sh</code>文件中包含了各类自定义配置，你主要配置下面这些跟数据库相关的就可以，其他配置使用默认值。</p><ul><li>MariaDB配置：environment.sh文件中以<code>MARIADB</code>开头的变量。</li><li>Redis配置：environment.sh文件中以<code>REDIS_</code>开头的变量。</li><li>MongoDB配置：environment.sh文件中以<code>MONGO_</code>开头的变量。</li></ul><p>第二步，创建IAM应用的配置文件。</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ <span class="token builtin class-name">cd</span> <span class="token variable">${IAM_ROOT}</span>
$ <span class="token function">make</span> gen.defaultconfigs <span class="token comment"># 生成iam-apiserver、iam-authz-server、iam-pump、iamctl组件的默认配置文件</span>
$ <span class="token function">make</span> gen.ca <span class="token comment"># 生成 CA 证书</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面的命令会将IAM的配置文件存放在目录<code>$/_output/configs/</code>下。</p><p>第三步，创建 <code>iam</code> 命名空间。</p><p>我们将IAM应用涉及到的各类资源都创建在<code>iam</code>命名空间中。将IAM资源创建在独立的命名空间中，不仅方便维护，还可以有效避免影响其他Kubernetes资源。</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ kubectl create namespace iam
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>第四步，将IAM各服务的配置文件，以ConfigMap资源的形式保存在Kubernetes集群中。</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ kubectl <span class="token parameter variable">-n</span> iam create configmap iam --from-file<span class="token operator">=</span><span class="token variable">${IAM_ROOT}</span>/_output/configs/
$ kubectl <span class="token parameter variable">-n</span> iam get configmap iam
NAME   DATA   AGE
iam    <span class="token number">4</span>      13s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>第五步，将IAM各服务使用的证书文件，以ConfigMap资源的形式保存在Kubernetes集群中。</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ kubectl <span class="token parameter variable">-n</span> iam create configmap iam-cert --from-file<span class="token operator">=</span><span class="token variable">${IAM_ROOT}</span>/_output/cert
$ kubectl <span class="token parameter variable">-n</span> iam get configmap iam-cert
NAME       DATA   AGE
iam-cert   <span class="token number">14</span>     12s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>第六步，创建镜像仓库访问密钥。</p><p>在准备阶段，我们开通了<a href="http://ccr.ccs.tencentyun.com/" target="_blank" rel="noopener noreferrer">腾讯云镜像仓库服务<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>，并创建了用户<code>10000099``xxxx</code>，密码为<code>iam59!z$</code>。</p><p>接下来，我们就可以创建docker-registry secret了。Kubernetes在下载Docker镜像时，需要docker-registry secret来进行认证。创建命令如下：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ kubectl <span class="token parameter variable">-n</span> iam create secret docker-registry ccr-registry --docker-server<span class="token operator">=</span>ccr.ccs.tencentyun.com --docker-username<span class="token operator">=</span>10000099xxxx --docker-password<span class="token operator">=</span><span class="token string">&#39;iam59!z$&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>第七步，创建Docker镜像，并Push到镜像仓库。</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">make</span> push <span class="token assign-left variable">REGISTRY_PREFIX</span><span class="token operator">=</span>ccr.ccs.tencentyun.com/marmotedu <span class="token assign-left variable">VERSION</span><span class="token operator">=</span>v1.1.0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>第八步，安装IAM Chart包。</p><p>在<a href="https://time.geekbang.org/column/article/420940" target="_blank" rel="noopener noreferrer">49讲<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>里，我介绍了4种安装Chart包的方法。这里，我们通过未打包的IAM Chart路径来安装，安装方法如下：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ <span class="token builtin class-name">cd</span> <span class="token variable">${IAM_ROOT}</span>
$ helm <span class="token parameter variable">-n</span> iam <span class="token function">install</span> iam deployments/iam
NAME: iam
LAST DEPLOYED: Sat Aug <span class="token number">21</span> <span class="token number">17</span>:46:56 <span class="token number">2021</span>
NAMESPACE: iam
STATUS: deployed
REVISION: <span class="token number">1</span>
TEST SUITE: None
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>执行 <code>helm install</code> 后，Kubernetes会自动部署应用，等到IAM应用的Pod都处在 <code>Running</code> 状态时，说明IAM应用已经成功安装：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ kubectl <span class="token parameter variable">-n</span> iam get pods<span class="token operator">|</span><span class="token function">grep</span> iam
iam-apiserver-cb4ff955-hs827        <span class="token number">1</span>/1     Running   <span class="token number">0</span>          66s
iam-authz-server-7fccc7db8d-chwnn   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          66s
iam-pump-78b57b4464-rrlbf           <span class="token number">1</span>/1     Running   <span class="token number">0</span>          66s
iamctl-59fdc4995-xrzhn              <span class="token number">1</span>/1     Running   <span class="token number">0</span>          66s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>第九步，测试IAM应用。</p><p>我们通过<code>helm install</code>在<code>iam</code>命令空间下创建了一个测试Deployment <code>iamctl</code>。你可以登陆<code>iamctl</code> Deployment所创建出来的Pod，执行一些运维操作和冒烟测试。登陆命令如下：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ kubectl <span class="token parameter variable">-n</span> iam <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> kubectl <span class="token parameter variable">-n</span> iam get pods <span class="token parameter variable">-l</span> <span class="token assign-left variable">app</span><span class="token operator">=</span>iamctl <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;/iamctl/{print $1}&#39;</span> -- <span class="token function">bash</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>登陆到<code>iamctl-xxxxxxxxxx-xxxxx</code> Pod中后，你就可以执行运维操作和冒烟测试了。</p><p>先来看运维操作。iamctl工具以子命令的方式对外提供功能，你可以使用它提供的各类功能，如下图所示：</p><p><a href="https://static001.geekbang.org/resource/image/69/y2/693f608aa571cbfd6e06c8cfdb242yy2.png?wh=1920x337" target="_blank" rel="noopener noreferrer"><img src="https://static001.geekbang.org/resource/image/69/y2/693f608aa571cbfd6e06c8cfdb242yy2.png?wh=1920x337" alt="图片"><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>再来看冒烟测试：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>
<span class="token comment"># cd /opt/iam/scripts/install</span>
<span class="token comment"># ./test.sh iam::test::smoke</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果<code>./test.sh iam::test::smoke</code>命令打印的输出中，最后一行为<code>congratulations, smoke test passed!</code>字符串，就说明IAM应用安装成功。如下图所示：</p><p><a href="https://static001.geekbang.org/resource/image/9d/8c/9dcc557952b3586f7b37b065bf2bd58c.png?wh=1920x314" target="_blank" rel="noopener noreferrer"><img src="https://static001.geekbang.org/resource/image/9d/8c/9dcc557952b3586f7b37b065bf2bd58c.png?wh=1920x314" alt="图片"><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>第十步，销毁EKS集群的资源。</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ kubectl delete namespace iam
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>你可以根据需要选择是否删除EKS集群，如果不需要了就可以选择删除。</p><h2 id="iam应用多环境部署" tabindex="-1"><a class="header-anchor" href="#iam应用多环境部署" aria-hidden="true">#</a> IAM应用多环境部署</h2><p>在实际的项目开发中，我们需要将IAM应用部署到不同的环境中，不同环境的配置文件是不同的，那么IAM项目是如何进行多环境部署的呢？</p><p>IAM项目在<a href="https://leeshengis.com/archives/421843" target="_blank" rel="noopener noreferrer">configs<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>目录下创建了多个Helm values文件（格式为<code>values--env.yaml</code>）：</p><ul><li>values-test-env.yaml，测试环境Helm values文件。</li><li>values-pre-env.yaml，预发环境Helm values文件。</li><li>values-prod-env.yaml，生产环境Helm values文件。</li></ul><p>在部署IAM应用时，我们在命令行指定<code>-f</code>参数，例如：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ helm <span class="token parameter variable">-n</span> iam <span class="token function">install</span> <span class="token parameter variable">-f</span> configs/values-test-env.yaml iam deployments/iam <span class="token comment"># 安装到测试环境。</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="总结" tabindex="-1"><a class="header-anchor" href="#总结" aria-hidden="true">#</a> 总结</h2><p>这一讲，我们通过 <code>helm create iam</code> 创建了一个模板Chart，并基于这个模板Chart包进行了二次开发，最终创建了IAM应用的Helm Chart包：<a href="https://github.com/marmotedu/iam/tree/v1.1.0/deployments/iam" target="_blank" rel="noopener noreferrer">deployments/iam<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>。</p><p>有了Helm Chart包，我们就可以通过 <code>helm -n iam install iam deployments/iam</code> 命令来一键部署好整个IAM应用。当IAM应用中的所有Pod都处在 <code>Running</code> 状态后，说明IAM应用被成功部署。</p><p>最后，我们可以登录iamctl容器，执行 <code>test.sh iam::test::smoke</code> 命令，来对IAM应用进行冒烟测试。</p><h2 id="课后练习" tabindex="-1"><a class="header-anchor" href="#课后练习" aria-hidden="true">#</a> 课后练习</h2><ol><li>试着在Helm Chart中加入MariaDB、MongoDB、Redis模板，通过Helm一键部署好整个IAM应用。</li><li>试着通过 <code>helm</code> 命令升级、回滚和删除IAM应用。</li></ol><h2 id="end-链接" tabindex="-1"><a class="header-anchor" href="#end-链接" aria-hidden="true">#</a> END 链接</h2><ul><li><div><a href="41.md" style="float:left;">⬆️上一节🔗 </a><a href="43.md" style="float:right;"> ️下一节🔗</a></div></li></ul><ul><li><p><a href="/iam/" class="">Ⓜ️回到目录🏠</a></p></li><li><p><a href="https://nsddd.top/archives/contributors" target="_blank" rel="noopener noreferrer"><strong>🫵参与贡献💞❤️‍🔥💖</strong><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>)</p></li><li><p>✴️版权声明 © ：本书所有内容遵循<a href="http://zh.wikipedia.org/wiki/Wikipedia:CC-by-sa-3.0%E5%8D%8F%E8%AE%AE%E6%96%87%E6%9C%AC" target="_blank" rel="noopener noreferrer">CC-BY-SA 3.0协议（署名-相同方式共享）©<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></li></ul></div><!--[--><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="external-link meta-item-label" href="https://github.com/kubecub/docs/edit/main/docs/iam/projects/42.md" rel="noopener noreferrer" target="_blank" aria-label="在GitHub上贡献此页面"><!--[--><!--]--> 在GitHub上贡献此页面 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">上次更新: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">贡献者: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 3293172751nss@gmail.com">Xinwei Xiong</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/iam/projects/41.html" class="" aria-label="第41节 服务编排（上）：Helm服务编排基础知识"><!--[--><!--]--> 第41节 服务编排（上）：Helm服务编排基础知识 <!--[--><!--]--></a></span><span class="next"><a href="/iam/projects/43.html" class="" aria-label="第43节 基于 GitHub Actions 的 CI 实战"><!--[--><!--]--> 第43节 基于 GitHub Actions 的 CI 实战 <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app.9967c189.js" defer></script>
  </body>
</html>

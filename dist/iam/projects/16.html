<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.51">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="/img/1.jpg"><title>第16节 Gin 框架 | 你好</title><meta name="description" content="链学社致力于打造出区块链去中心化的学习平台">
    <link rel="modulepreload" href="/assets/app.df174e55.js"><link rel="modulepreload" href="/assets/16.html.a1bd17bb.js"><link rel="modulepreload" href="/assets/16.html.2c2a072d.js"><link rel="prefetch" href="/assets/index.html.25a7a27a.js"><link rel="prefetch" href="/assets/index.html.a36ccd78.js"><link rel="prefetch" href="/assets/1.html.461afd80.js"><link rel="prefetch" href="/assets/10.html.4f13ef50.js"><link rel="prefetch" href="/assets/11.html.f09f95c3.js"><link rel="prefetch" href="/assets/12.html.a67acf21.js"><link rel="prefetch" href="/assets/13.html.0420c962.js"><link rel="prefetch" href="/assets/14.html.b0b5806d.js"><link rel="prefetch" href="/assets/15.html.06f1cde4.js"><link rel="prefetch" href="/assets/17.html.be392cda.js"><link rel="prefetch" href="/assets/18.html.8b213912.js"><link rel="prefetch" href="/assets/19.html.1dca5398.js"><link rel="prefetch" href="/assets/2.html.ad5997eb.js"><link rel="prefetch" href="/assets/20.html.1bd75582.js"><link rel="prefetch" href="/assets/21.html.9cb3d476.js"><link rel="prefetch" href="/assets/22.html.4c43a0a4.js"><link rel="prefetch" href="/assets/23.html.0341a155.js"><link rel="prefetch" href="/assets/24.html.f74332a7.js"><link rel="prefetch" href="/assets/25.html.32aca821.js"><link rel="prefetch" href="/assets/26.html.cc5ca1a2.js"><link rel="prefetch" href="/assets/27.html.09791ec4.js"><link rel="prefetch" href="/assets/28.html.4aa1094d.js"><link rel="prefetch" href="/assets/29.html.165cddd8.js"><link rel="prefetch" href="/assets/3.html.427f6088.js"><link rel="prefetch" href="/assets/30.html.5c492d35.js"><link rel="prefetch" href="/assets/31.html.b4a50d0d.js"><link rel="prefetch" href="/assets/32.html.3a8a6f2f.js"><link rel="prefetch" href="/assets/33.html.e8f65480.js"><link rel="prefetch" href="/assets/34.html.580498c1.js"><link rel="prefetch" href="/assets/35.html.2da63961.js"><link rel="prefetch" href="/assets/36.html.d8049f92.js"><link rel="prefetch" href="/assets/37.html.0dbda88b.js"><link rel="prefetch" href="/assets/38.html.d8605d22.js"><link rel="prefetch" href="/assets/39.html.84a2efa8.js"><link rel="prefetch" href="/assets/4.html.3a1de71e.js"><link rel="prefetch" href="/assets/40.html.532610aa.js"><link rel="prefetch" href="/assets/41.html.172bb15b.js"><link rel="prefetch" href="/assets/42.html.e71d9386.js"><link rel="prefetch" href="/assets/43.html.99ab5c93.js"><link rel="prefetch" href="/assets/44.html.ed92b7f3.js"><link rel="prefetch" href="/assets/45.html.2fa65b5e.js"><link rel="prefetch" href="/assets/46.html.f0dd66d1.js"><link rel="prefetch" href="/assets/47.html.4c6f6d3d.js"><link rel="prefetch" href="/assets/48.html.3cdc0986.js"><link rel="prefetch" href="/assets/49.html.936da8ed.js"><link rel="prefetch" href="/assets/5.html.0f758775.js"><link rel="prefetch" href="/assets/50.html.e8114b3c.js"><link rel="prefetch" href="/assets/51.html.8dba5f2d.js"><link rel="prefetch" href="/assets/52.html.4e857563.js"><link rel="prefetch" href="/assets/53.html.c513f2cd.js"><link rel="prefetch" href="/assets/54.html.cc298904.js"><link rel="prefetch" href="/assets/55.html.dd8403bb.js"><link rel="prefetch" href="/assets/56.html.a6fa9c2b.js"><link rel="prefetch" href="/assets/57.html.8d9ca11b.js"><link rel="prefetch" href="/assets/58.html.d2d6137f.js"><link rel="prefetch" href="/assets/59.html.64bfc6aa.js"><link rel="prefetch" href="/assets/6.html.4f7ba7c5.js"><link rel="prefetch" href="/assets/60.html.9d280a7e.js"><link rel="prefetch" href="/assets/61.html.93e3d982.js"><link rel="prefetch" href="/assets/62.html.7c25e781.js"><link rel="prefetch" href="/assets/63.html.c7c354a1.js"><link rel="prefetch" href="/assets/64.html.0d112a0c.js"><link rel="prefetch" href="/assets/65.html.8b9a0ae3.js"><link rel="prefetch" href="/assets/66.html.60a5c98f.js"><link rel="prefetch" href="/assets/67.html.65a79637.js"><link rel="prefetch" href="/assets/68.html.9c8743e4.js"><link rel="prefetch" href="/assets/69.html.f262d742.js"><link rel="prefetch" href="/assets/7.html.658a2ddf.js"><link rel="prefetch" href="/assets/70.html.a13f0df5.js"><link rel="prefetch" href="/assets/71.html.e5232458.js"><link rel="prefetch" href="/assets/72.html.55331bc1.js"><link rel="prefetch" href="/assets/73.html.cf7ccd53.js"><link rel="prefetch" href="/assets/74.html.48daf8af.js"><link rel="prefetch" href="/assets/75.html.4a47e12f.js"><link rel="prefetch" href="/assets/76.html.72c869e6.js"><link rel="prefetch" href="/assets/77.html.a9d9ff7d.js"><link rel="prefetch" href="/assets/78.html.0feb5171.js"><link rel="prefetch" href="/assets/79.html.7a6a2cc4.js"><link rel="prefetch" href="/assets/8.html.8d69e3db.js"><link rel="prefetch" href="/assets/80.html.88f5c71d.js"><link rel="prefetch" href="/assets/81.html.3ec4d333.js"><link rel="prefetch" href="/assets/82.html.70be117a.js"><link rel="prefetch" href="/assets/83.html.07de8b59.js"><link rel="prefetch" href="/assets/84.html.37bf069c.js"><link rel="prefetch" href="/assets/85.html.d88064c7.js"><link rel="prefetch" href="/assets/86.html.2ea4f0ba.js"><link rel="prefetch" href="/assets/87.html.fcd098dc.js"><link rel="prefetch" href="/assets/88.html.455f17e4.js"><link rel="prefetch" href="/assets/89.html.94c12162.js"><link rel="prefetch" href="/assets/9.html.3619251b.js"><link rel="prefetch" href="/assets/90.html.47f84836.js"><link rel="prefetch" href="/assets/91.html.f355cbb5.js"><link rel="prefetch" href="/assets/92.html.4b6d0a6b.js"><link rel="prefetch" href="/assets/93.html.8c027538.js"><link rel="prefetch" href="/assets/94.html.e175d373.js"><link rel="prefetch" href="/assets/95.html.58fba167.js"><link rel="prefetch" href="/assets/96.html.cfc1673c.js"><link rel="prefetch" href="/assets/97.html.71615abb.js"><link rel="prefetch" href="/assets/98.html.817dd510.js"><link rel="prefetch" href="/assets/99.html.41ed9550.js"><link rel="prefetch" href="/assets/404.html.c3e557d0.js"><link rel="prefetch" href="/assets/index.html.5078607b.js"><link rel="prefetch" href="/assets/index.html.238b898d.js"><link rel="prefetch" href="/assets/1.html.68bd8bc7.js"><link rel="prefetch" href="/assets/10.html.6703ed8a.js"><link rel="prefetch" href="/assets/11.html.087bca0d.js"><link rel="prefetch" href="/assets/12.html.54a22c52.js"><link rel="prefetch" href="/assets/13.html.4bb58d38.js"><link rel="prefetch" href="/assets/14.html.503f448c.js"><link rel="prefetch" href="/assets/15.html.8574c656.js"><link rel="prefetch" href="/assets/17.html.1efae1db.js"><link rel="prefetch" href="/assets/18.html.2f97fa21.js"><link rel="prefetch" href="/assets/19.html.3e0f7c64.js"><link rel="prefetch" href="/assets/2.html.58eeb18b.js"><link rel="prefetch" href="/assets/20.html.b8b46978.js"><link rel="prefetch" href="/assets/21.html.70c7de34.js"><link rel="prefetch" href="/assets/22.html.aa7bd96c.js"><link rel="prefetch" href="/assets/23.html.ad35e20a.js"><link rel="prefetch" href="/assets/24.html.0963e8cd.js"><link rel="prefetch" href="/assets/25.html.df593c5c.js"><link rel="prefetch" href="/assets/26.html.21e72cc8.js"><link rel="prefetch" href="/assets/27.html.abbc553f.js"><link rel="prefetch" href="/assets/28.html.eefcc4fe.js"><link rel="prefetch" href="/assets/29.html.b3a7277c.js"><link rel="prefetch" href="/assets/3.html.ece505c8.js"><link rel="prefetch" href="/assets/30.html.4139f101.js"><link rel="prefetch" href="/assets/31.html.78bdceca.js"><link rel="prefetch" href="/assets/32.html.b715024d.js"><link rel="prefetch" href="/assets/33.html.28fbd3f1.js"><link rel="prefetch" href="/assets/34.html.4a53b877.js"><link rel="prefetch" href="/assets/35.html.3714035c.js"><link rel="prefetch" href="/assets/36.html.6593b1dd.js"><link rel="prefetch" href="/assets/37.html.1030763e.js"><link rel="prefetch" href="/assets/38.html.564c84b7.js"><link rel="prefetch" href="/assets/39.html.9e6b9426.js"><link rel="prefetch" href="/assets/4.html.0cced93c.js"><link rel="prefetch" href="/assets/40.html.baa78d6a.js"><link rel="prefetch" href="/assets/41.html.ce225826.js"><link rel="prefetch" href="/assets/42.html.6ef135a0.js"><link rel="prefetch" href="/assets/43.html.235f7002.js"><link rel="prefetch" href="/assets/44.html.d18c82d2.js"><link rel="prefetch" href="/assets/45.html.2f2c2f8c.js"><link rel="prefetch" href="/assets/46.html.45e49c32.js"><link rel="prefetch" href="/assets/47.html.2071b30e.js"><link rel="prefetch" href="/assets/48.html.d1a08b55.js"><link rel="prefetch" href="/assets/49.html.5ebe1da7.js"><link rel="prefetch" href="/assets/5.html.92b708de.js"><link rel="prefetch" href="/assets/50.html.3a175eb7.js"><link rel="prefetch" href="/assets/51.html.d27f00bb.js"><link rel="prefetch" href="/assets/52.html.8b437f64.js"><link rel="prefetch" href="/assets/53.html.d913eb66.js"><link rel="prefetch" href="/assets/54.html.8271495e.js"><link rel="prefetch" href="/assets/55.html.bdc49926.js"><link rel="prefetch" href="/assets/56.html.3dc8abe7.js"><link rel="prefetch" href="/assets/57.html.7d8f4d4c.js"><link rel="prefetch" href="/assets/58.html.2e807b03.js"><link rel="prefetch" href="/assets/59.html.83549612.js"><link rel="prefetch" href="/assets/6.html.1d2cb545.js"><link rel="prefetch" href="/assets/60.html.fb941722.js"><link rel="prefetch" href="/assets/61.html.10d42607.js"><link rel="prefetch" href="/assets/62.html.63d223ec.js"><link rel="prefetch" href="/assets/63.html.afb0566c.js"><link rel="prefetch" href="/assets/64.html.88e70600.js"><link rel="prefetch" href="/assets/65.html.6ee1b8fd.js"><link rel="prefetch" href="/assets/66.html.ab8f36c8.js"><link rel="prefetch" href="/assets/67.html.bb9f4dde.js"><link rel="prefetch" href="/assets/68.html.081ecec1.js"><link rel="prefetch" href="/assets/69.html.94b26ac8.js"><link rel="prefetch" href="/assets/7.html.cef2e333.js"><link rel="prefetch" href="/assets/70.html.21112954.js"><link rel="prefetch" href="/assets/71.html.b6760737.js"><link rel="prefetch" href="/assets/72.html.46e6db4d.js"><link rel="prefetch" href="/assets/73.html.872f9067.js"><link rel="prefetch" href="/assets/74.html.e2fad9a6.js"><link rel="prefetch" href="/assets/75.html.41837637.js"><link rel="prefetch" href="/assets/76.html.bd895802.js"><link rel="prefetch" href="/assets/77.html.d16746b1.js"><link rel="prefetch" href="/assets/78.html.7573af34.js"><link rel="prefetch" href="/assets/79.html.4ba1b576.js"><link rel="prefetch" href="/assets/8.html.ffbe5f0d.js"><link rel="prefetch" href="/assets/80.html.964f8ea4.js"><link rel="prefetch" href="/assets/81.html.f0f8c8ea.js"><link rel="prefetch" href="/assets/82.html.42775672.js"><link rel="prefetch" href="/assets/83.html.dca364d9.js"><link rel="prefetch" href="/assets/84.html.03706d5c.js"><link rel="prefetch" href="/assets/85.html.32142600.js"><link rel="prefetch" href="/assets/86.html.bc85e920.js"><link rel="prefetch" href="/assets/87.html.406eea6e.js"><link rel="prefetch" href="/assets/88.html.2fa5b983.js"><link rel="prefetch" href="/assets/89.html.ac21d36d.js"><link rel="prefetch" href="/assets/9.html.b60314dd.js"><link rel="prefetch" href="/assets/90.html.ccb3b75c.js"><link rel="prefetch" href="/assets/91.html.42ecc4c5.js"><link rel="prefetch" href="/assets/92.html.50a515c1.js"><link rel="prefetch" href="/assets/93.html.b5657afc.js"><link rel="prefetch" href="/assets/94.html.c185d24f.js"><link rel="prefetch" href="/assets/95.html.ad73eb9e.js"><link rel="prefetch" href="/assets/96.html.cb8ab449.js"><link rel="prefetch" href="/assets/97.html.06281eee.js"><link rel="prefetch" href="/assets/98.html.23720464.js"><link rel="prefetch" href="/assets/99.html.ae6e8b44.js"><link rel="prefetch" href="/assets/404.html.e3b93612.js">
    <link rel="stylesheet" href="/assets/style.03848e77.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="切换侧边栏" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><!----><span class="site-name can-hide">你好</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="🤵关于我"><span class="title">🤵关于我</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="🤵关于我"><span class="title">🤵关于我</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a class="external-link" href="https://github.com/3293172751/cs-awesome-Block_Chain" rel="noopener noreferrer" target="_blank" aria-label="Github仓库"><!--[--><!--]--> Github仓库 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="http://nsddd.top" rel="noopener noreferrer" target="_blank" aria-label="我的博客"><!--[--><!--]--> 我的博客 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="https://www.zhihu.com/people/3293172751" rel="noopener noreferrer" target="_blank" aria-label="知乎"><!--[--><!--]--> 知乎 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="https://github.com/C-UB/" rel="noopener noreferrer" target="_blank" aria-label="⛓️链学社组织"><!--[--><!--]--> ⛓️链学社组织 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a href="/" class="" aria-label="🏠首页"><!--[--><!--]--> 🏠首页 <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://docker.nsddd.top/" rel="noopener noreferrer" target="_blank" aria-label="🐋docker文档"><!--[--><!--]--> 🐋docker文档 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="📚go文档"><span class="title">📚go文档</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="📚go文档"><span class="title">📚go文档</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/projec/" class="" aria-label="🔥 K8s-Iam 项目"><!--[--><!--]--> 🔥 K8s-Iam 项目 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/k8s/" class="" aria-label="🔥 k8s 教程"><!--[--><!--]--> 🔥 k8s 教程 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/k8s-iam/" class="" aria-label="🔥 iam 教程"><!--[--><!--]--> 🔥 iam 教程 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/3293172751/awesome-go" rel="noopener noreferrer" target="_blank" aria-label="查看源码"><!--[--><!--]--> 查看源码 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="切换颜色模式"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><div id="docsearch-container"></div></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="🤵关于我"><span class="title">🤵关于我</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="🤵关于我"><span class="title">🤵关于我</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a class="external-link" href="https://github.com/3293172751/cs-awesome-Block_Chain" rel="noopener noreferrer" target="_blank" aria-label="Github仓库"><!--[--><!--]--> Github仓库 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="http://nsddd.top" rel="noopener noreferrer" target="_blank" aria-label="我的博客"><!--[--><!--]--> 我的博客 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="https://www.zhihu.com/people/3293172751" rel="noopener noreferrer" target="_blank" aria-label="知乎"><!--[--><!--]--> 知乎 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="https://github.com/C-UB/" rel="noopener noreferrer" target="_blank" aria-label="⛓️链学社组织"><!--[--><!--]--> ⛓️链学社组织 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a href="/" class="" aria-label="🏠首页"><!--[--><!--]--> 🏠首页 <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://docker.nsddd.top/" rel="noopener noreferrer" target="_blank" aria-label="🐋docker文档"><!--[--><!--]--> 🐋docker文档 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="📚go文档"><span class="title">📚go文档</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="📚go文档"><span class="title">📚go文档</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/projec/" class="" aria-label="🔥 K8s-Iam 项目"><!--[--><!--]--> 🔥 K8s-Iam 项目 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/k8s/" class="" aria-label="🔥 k8s 教程"><!--[--><!--]--> 🔥 k8s 教程 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/k8s-iam/" class="" aria-label="🔥 iam 教程"><!--[--><!--]--> 🔥 iam 教程 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/3293172751/awesome-go" rel="noopener noreferrer" target="_blank" aria-label="查看源码"><!--[--><!--]--> 查看源码 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><a href="/" class="sidebar-item sidebar-heading" aria-label="🏠回到主页"><!--[--><!--]--> 🏠回到主页 <!--[--><!--]--></a><!----></li><li><p tabindex="0" class="sidebar-item sidebar-heading active">🔥 Go语言基础篇 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/iam/projects/1.html" class="sidebar-item" aria-label="第1节 IAM项目介绍"><!--[--><!--]--> 第1节 IAM项目介绍 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/2.html" class="sidebar-item" aria-label="第2节 IAM项目部署"><!--[--><!--]--> 第2节 IAM项目部署 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/3.html" class="sidebar-item" aria-label="第3节 设计规范"><!--[--><!--]--> 第3节 设计规范 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/4.html" class="sidebar-item" aria-label="第4节 Go语言项目设计"><!--[--><!--]--> 第4节 Go语言项目设计 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/5.html" class="sidebar-item" aria-label="第5节 设计并写出优雅的Go语言项目"><!--[--><!--]--> 第5节 设计并写出优雅的Go语言项目 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/6.html" class="sidebar-item" aria-label="第6节 API 风格设计"><!--[--><!--]--> 第6节 API 风格设计 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/7.html" class="sidebar-item" aria-label="第7节 高质量的Makefile"><!--[--><!--]--> 第7节 高质量的Makefile <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/8.html" class="sidebar-item" aria-label="第8节 IAM 项目如何进行研发流程管理"><!--[--><!--]--> 第8节 IAM 项目如何进行研发流程管理 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/9.html" class="sidebar-item" aria-label="第9节 静态代码检测"><!--[--><!--]--> 第9节 静态代码检测 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/10.html" class="sidebar-item" aria-label="第10节 如何生成 Swagger API 文档"><!--[--><!--]--> 第10节 如何生成 Swagger API 文档 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/11.html" class="sidebar-item" aria-label="第11节 设计一套科学的错误码"><!--[--><!--]--> 第11节 设计一套科学的错误码 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/12.html" class="sidebar-item" aria-label="第12节 记录和设计日志"><!--[--><!--]--> 第12节 记录和设计日志 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/13.html" class="sidebar-item" aria-label="第13节  从 0 编写一个日志包"><!--[--><!--]--> 第13节  从 0 编写一个日志包 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/14.html" class="sidebar-item" aria-label="第14节 Pflag、Viper、Cobra 核心功能介绍"><!--[--><!--]--> 第14节 Pflag、Viper、Cobra 核心功能介绍 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/15.html" class="sidebar-item" aria-label="第15节 如何构建一个优秀的企业应用框架"><!--[--><!--]--> 第15节 如何构建一个优秀的企业应用框架 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/iam/projects/16.html" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="第16节 Gin 框架"><!--[--><!--]--> 第16节 Gin 框架 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/iam/projects/16.html#开始" class="router-link-active router-link-exact-active sidebar-item" aria-label="开始"><!--[--><!--]--> 开始 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/iam/projects/16.html#web-服务的核心功能" class="router-link-active router-link-exact-active sidebar-item" aria-label="Web 服务的核心功能"><!--[--><!--]--> Web 服务的核心功能 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/iam/projects/16.html#为什么选择-gin-框架" class="router-link-active router-link-exact-active sidebar-item" aria-label="为什么选择 Gin 框架？"><!--[--><!--]--> 为什么选择 Gin 框架？ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/iam/projects/16.html#gin-是如何支持-web-服务基础功能的" class="router-link-active router-link-exact-active sidebar-item" aria-label="Gin 是如何支持 Web 服务基础功能的？"><!--[--><!--]--> Gin 是如何支持 Web 服务基础功能的？ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/iam/projects/16.html#gin-是如何支持-web-服务高级功能的" class="router-link-active router-link-exact-active sidebar-item" aria-label="Gin 是如何支持 Web 服务高级功能的？"><!--[--><!--]--> Gin 是如何支持 Web 服务高级功能的？ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/iam/projects/16.html#总结" class="router-link-active router-link-exact-active sidebar-item" aria-label="总结"><!--[--><!--]--> 总结 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/iam/projects/16.html#课后练习" class="router-link-active router-link-exact-active sidebar-item" aria-label="课后练习"><!--[--><!--]--> 课后练习 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/iam/projects/16.html#end-链接" class="router-link-active router-link-exact-active sidebar-item" aria-label="END 链接"><!--[--><!--]--> END 链接 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a href="/iam/projects/17.html" class="sidebar-item" aria-label="第17节 认证机制：应用程序如何进行访问认证？"><!--[--><!--]--> 第17节 认证机制：应用程序如何进行访问认证？ <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/18.html" class="sidebar-item" aria-label="第18节 IAM 项目认证"><!--[--><!--]--> 第18节 IAM 项目认证 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/19.html" class="sidebar-item" aria-label="第19节 权限模型：5大权限模型是如何进行资源授权的？"><!--[--><!--]--> 第19节 权限模型：5大权限模型是如何进行资源授权的？ <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/20.html" class="sidebar-item" aria-label="第20节 控制流（上）：通过iam-apiserver设计，看Web服务的构建"><!--[--><!--]--> 第20节 控制流（上）：通过iam-apiserver设计，看Web服务的构建 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/21.html" class="sidebar-item" aria-label="第21节 控制流（下）：iam-apiserver服务核心功能实现讲解"><!--[--><!--]--> 第21节 控制流（下）：iam-apiserver服务核心功能实现讲解 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/22.html" class="sidebar-item" aria-label="第22节 ORM：CURD 神器 GORM 包介绍及实战"><!--[--><!--]--> 第22节 ORM：CURD 神器 GORM 包介绍及实战 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/23.html" class="sidebar-item" aria-label="第23节 数据流：通过iam-authz-server设计，看数据流服务的设计"><!--[--><!--]--> 第23节 数据流：通过iam-authz-server设计，看数据流服务的设计 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/24.html" class="sidebar-item" aria-label="第24节 数据处理：如何高效处理应用程序产生的数据？"><!--[--><!--]--> 第24节 数据处理：如何高效处理应用程序产生的数据？ <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/25.html" class="sidebar-item" aria-label="第25节  SDK 设计（上）：如何设计出一个优秀的 Go SDK？"><!--[--><!--]--> 第25节  SDK 设计（上）：如何设计出一个优秀的 Go SDK？ <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/26.html" class="sidebar-item" aria-label="第26节  SDK 设计（下）：IAM项目Go SDK设计和实现"><!--[--><!--]--> 第26节  SDK 设计（下）：IAM项目Go SDK设计和实现 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/27.html" class="sidebar-item" aria-label="第27节 效率神器：如何设计和实现一个命令行客户端工具？"><!--[--><!--]--> 第27节 效率神器：如何设计和实现一个命令行客户端工具？ <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/28.html" class="sidebar-item" aria-label="第28节 代码测试（上）：如何编写 Go 语言单元测试和性能测试用例？"><!--[--><!--]--> 第28节 代码测试（上）：如何编写 Go 语言单元测试和性能测试用例？ <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/29.html" class="sidebar-item" aria-label="第29节 代码测试（下）：Go 语言其他测试类型及 IAM 测试介绍"><!--[--><!--]--> 第29节 代码测试（下）：Go 语言其他测试类型及 IAM 测试介绍 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/30.html" class="sidebar-item" aria-label="第30节 性能分析（上）：如何分析 Go 语言代码的性能？"><!--[--><!--]--> 第30节 性能分析（上）：如何分析 Go 语言代码的性能？ <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/31.html" class="sidebar-item" aria-label="第31节 性能分析（下）：API Server性能测试和调优实战"><!--[--><!--]--> 第31节 性能分析（下）：API Server性能测试和调优实战 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/32.html" class="sidebar-item" aria-label="第32节 软件部署实战（上）：部署方案及负载均衡、高可用组件介绍"><!--[--><!--]--> 第32节 软件部署实战（上）：部署方案及负载均衡、高可用组件介绍 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/33.html" class="sidebar-item" aria-label="第33节 软件部署实战（中）：IAM 系统生产环境部署实战"><!--[--><!--]--> 第33节 软件部署实战（中）：IAM 系统生产环境部署实战 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/34.html" class="sidebar-item" aria-label="第34节 软件部署实战（下）：IAM系统安全加固、水平扩缩容实战"><!--[--><!--]--> 第34节 软件部署实战（下）：IAM系统安全加固、水平扩缩容实战 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/35.html" class="sidebar-item" aria-label="第35节 技术演进（上）：虚拟化技术演进之路"><!--[--><!--]--> 第35节 技术演进（上）：虚拟化技术演进之路 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/36.html" class="sidebar-item" aria-label="第36节 技术演进（下）：软件架构和应用生命周期技术演进之路"><!--[--><!--]--> 第36节 技术演进（下）：软件架构和应用生命周期技术演进之路 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/37.html" class="sidebar-item" aria-label="第37节 基于Kubernetes的云原生架构设计"><!--[--><!--]--> 第37节 基于Kubernetes的云原生架构设计 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/38.html" class="sidebar-item" aria-label="第38节 如何制作Docker镜像？"><!--[--><!--]--> 第38节 如何制作Docker镜像？ <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/39.html" class="sidebar-item" aria-label="第39节 如何编写Kubernetes资源定义文件？"><!--[--><!--]--> 第39节 如何编写Kubernetes资源定义文件？ <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/40.html" class="sidebar-item" aria-label="第40节 IAM 容器化部署实战"><!--[--><!--]--> 第40节 IAM 容器化部署实战 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/41.html" class="sidebar-item" aria-label="第41节 服务编排（上）：Helm服务编排基础知识"><!--[--><!--]--> 第41节 服务编排（上）：Helm服务编排基础知识 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/42.html" class="sidebar-item" aria-label="第42节 服务编排（下）：基于Helm的服务编排部署实战"><!--[--><!--]--> 第42节 服务编排（下）：基于Helm的服务编排部署实战 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/43.html" class="sidebar-item" aria-label="第43节 基于 GitHub Actions 的 CI 实战"><!--[--><!--]--> 第43节 基于 GitHub Actions 的 CI 实战 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/44.html" class="sidebar-item" aria-label="第44节 可直接套用的 Go 编码规范"><!--[--><!--]--> 第44节 可直接套用的 Go 编码规范 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/45.html" class="sidebar-item" aria-label="第45节 Go Modules依赖包管理全讲"><!--[--><!--]--> 第45节 Go Modules依赖包管理全讲 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/46.html" class="sidebar-item" aria-label="第46节 IAM排障指南"><!--[--><!--]--> 第46节 IAM排障指南 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/47.html" class="sidebar-item" aria-label="第47节"><!--[--><!--]--> 第47节 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/48.html" class="sidebar-item" aria-label="第48节 分布式系统设计"><!--[--><!--]--> 第48节 分布式系统设计 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/49.html" class="sidebar-item" aria-label="第49节 如何从小白进阶成 Go 语言专家？"><!--[--><!--]--> 第49节 如何从小白进阶成 Go 语言专家？ <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/50.html" class="sidebar-item" aria-label="第50节"><!--[--><!--]--> 第50节 <!--[--><!--]--></a><!----></li><li><a class="external-link sidebar-item" href="https://nsddd.top/archives/contributors" rel="noopener noreferrer" target="_blank" aria-label="💝如何参与贡献？"><!--[--><!--]--> 💝如何参与贡献？ <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><ul><li><a href="https://github.com/cubxxw/iam" target="_blank" rel="noopener noreferrer">🔥 开源地址<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><h1 id="第16节-gin-框架" tabindex="-1"><a class="header-anchor" href="#第16节-gin-框架" aria-hidden="true">#</a> 第16节 Gin 框架</h1><br><div><a href="15.md" style="float:left;">⬆️上一节🔗 </a><a href="17.md" style="float:right;"> ⬇️下一节🔗</a></div><br><blockquote><p>❤️💕💕During the winter vacation, I followed up and learned two projects: tiktok project and IAM project, and summarized and practiced the CloudNative project and Go language. I learned a lot in the process.Myblog:<a href="http://nsddd.top/" target="_blank" rel="noopener noreferrer">http://nsddd.top<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></blockquote><hr><nav class="table-of-contents"><ul><li><a aria-current="page" href="/iam/projects/16.html#开始" class="router-link-active router-link-exact-active">开始</a></li><li><a aria-current="page" href="/iam/projects/16.html#web-服务的核心功能" class="router-link-active router-link-exact-active">Web 服务的核心功能</a></li><li><a aria-current="page" href="/iam/projects/16.html#为什么选择-gin-框架" class="router-link-active router-link-exact-active">为什么选择 Gin 框架？</a></li><li><a aria-current="page" href="/iam/projects/16.html#gin-是如何支持-web-服务基础功能的" class="router-link-active router-link-exact-active">Gin 是如何支持 Web 服务基础功能的？</a><ul><li><a aria-current="page" href="/iam/projects/16.html#http-https-支持" class="router-link-active router-link-exact-active">HTTP/HTTPS 支持</a></li><li><a aria-current="page" href="/iam/projects/16.html#json-数据格式支持" class="router-link-active router-link-exact-active">JSON 数据格式支持</a></li><li><a aria-current="page" href="/iam/projects/16.html#路由匹配" class="router-link-active router-link-exact-active">路由匹配</a></li><li><a aria-current="page" href="/iam/projects/16.html#路由分组" class="router-link-active router-link-exact-active">路由分组</a></li><li><a aria-current="page" href="/iam/projects/16.html#一进程多服务" class="router-link-active router-link-exact-active">一进程多服务</a></li><li><a aria-current="page" href="/iam/projects/16.html#参数解析、参数校验、逻辑处理、返回结果" class="router-link-active router-link-exact-active">参数解析、参数校验、逻辑处理、返回结果</a></li></ul></li><li><a aria-current="page" href="/iam/projects/16.html#gin-是如何支持-web-服务高级功能的" class="router-link-active router-link-exact-active">Gin 是如何支持 Web 服务高级功能的？</a><ul><li><a aria-current="page" href="/iam/projects/16.html#中间件" class="router-link-active router-link-exact-active">中间件</a></li><li><a aria-current="page" href="/iam/projects/16.html#认证、requestid、跨域" class="router-link-active router-link-exact-active">认证、RequestID、跨域</a></li><li><a aria-current="page" href="/iam/projects/16.html#优雅关停" class="router-link-active router-link-exact-active">优雅关停</a></li></ul></li><li><a aria-current="page" href="/iam/projects/16.html#总结" class="router-link-active router-link-exact-active">总结</a></li><li><a aria-current="page" href="/iam/projects/16.html#课后练习" class="router-link-active router-link-exact-active">课后练习</a></li><li><a aria-current="page" href="/iam/projects/16.html#end-链接" class="router-link-active router-link-exact-active">END 链接</a></li></ul></nav><p>[TOC]</p><h2 id="开始" tabindex="-1"><a class="header-anchor" href="#开始" aria-hidden="true">#</a> 开始</h2><p>在 Go 项目开发中，绝大部分情况下，我们是在写能提供某种功能的后端服务，这些功能以 RPC API 接口或者 RESTful API 接口的形式对外提供，能提供这两种 API 接口的服务也统称为 Web 服务。今天这一讲，我就通过介绍 <strong>RESTful API</strong> 风格的 Web 服务，来给你介绍下如何实现 Web 服务的核心功能。</p><p>那今天我们就来看下，Web 服务的核心功能有哪些，以及如何开发这些功能。</p><h2 id="web-服务的核心功能" tabindex="-1"><a class="header-anchor" href="#web-服务的核心功能" aria-hidden="true">#</a> Web 服务的核心功能</h2><p>Web 服务有很多功能，为了便于你理解，我将这些功能分成了基础功能和高级功能两大类，并总结在了下面这张图中：</p><p><img src="http://sm.nsddd.top/sm202302222250672.jpeg" alt="img"></p><p>下面，我就按图中的顺序，来串讲下这些功能。</p><p>要实现一个 Web 服务，首先我们要选择通信协议和通信格式。在 Go 项目开发中，有 <code>HTTP+JSON</code> 和 <code>gRPC+Protobuf</code> 两种组合可选。因为 iam-apiserver 主要提供的是 REST 风格的 API 接口，所以选择的是 <code>HTTP+JSON</code> 组合。</p><blockquote><p>⚠️ 不一样的是：Kubernetes 选择的通信协议是 gRPC，通信格式则使用 Protocol Buffers（简称 protobuf）。</p><p>而 Protocol Buffers 则是一种轻量级的数据序列化格式，它可以将结构化数据序列化为二进制格式，同时提供方便的语言无关性。这种格式不仅可以用于 gRPC 中的消息传递，也可以用于其他数据传输格式，例如存储和传输数据。与其他格式相比，Protocol Buffers 可以生成更小、更快的数据结构，同时也比 JSON 和 XML 等格式更易于阅读和理解。</p></blockquote><p>**Web 服务最核心的功能是路由匹配。**路由匹配其实就是根据(HTTP方法, 请求路径)匹配到处理这个请求的函数，最终由该函数处理这次请求，并返回结果，过程如下图所示：</p><p><img src="http://sm.nsddd.top/sm202302222256592.jpeg" alt="img"></p><p>一次 HTTP 请求经过路由匹配，最终将请求交由<code>Delete(c *gin.Context)</code>函数来处理。变量c中存放了这次请求的参数，在 Delete 函数中，我们可以进行参数解析、参数校验、逻辑处理，最终返回结果。</p><p>对于大型系统，可能会有很多个 API 接口，API 接口随着需求的更新迭代，可能会有多个版本，为了便于管理，我们需要<strong>对路由进行分组</strong>。</p><p>有时候，我们需要在一个服务进程中，同时开启 HTTP 服务的 80 端口和 HTTPS 的 443 端口，这样我们就可以做到：</p><ul><li>对内的服务，访问 80 端口，简化服务访问复杂度；</li><li>对外的服务，访问更为安全的 HTTPS 服务</li></ul><p>显然，我们没必要为相同功能启动多个服务进程，所以这时候就需要 Web 服务能够支持<strong>一进程多服务</strong>的功能。</p><p>我们开发 Web 服务最核心的诉求是：输入一些参数，校验通过后，进行业务逻辑处理，然后返回结果。所以 Web 服务还应该能够进行<strong>参数解析</strong>、<strong>参数校验</strong>、<strong>逻辑处理</strong>、<strong>返回结果</strong>。这些都是 Web 服务的业务处理功能。</p><p>上面这些是 Web 服务的基本功能，此外，我们还需要支持一些高级功能。</p><p>在进行 HTTP 请求时，经常需要针对每一次请求都设置一些通用的操作，比如添加 Header、添加 RequestID、统计请求次数等，这就要求我们的 Web 服务能够支持<strong>中间件</strong>特性。</p><p>为了保证系统安全，对于每一个请求，我们都需要进行<strong>认证</strong>。<strong>Web 服务中，通常有两种认证方式，一种是基于用户名和密码，一种是基于 Token。</strong> 认证通过之后，就可以继续处理请求了。</p><p>为了方便定位和跟踪某一次请求，需要支持 <strong>RequestID</strong>，定位和跟踪 RequestID 主要是为了排障。</p><p>最后，当前的软件架构中，很多采用了前后端分离的架构。在前后端分离的架构中，前端访问地址和后端访问地址往往是不同的，浏览器为了安全，会针对这种情况设置跨域请求，所以 Web 服务需要能够处理浏览器的<strong>跨域</strong>请求。</p><p>到这里，我就把 Web 服务的基础功能和高级功能串讲了一遍。当然，上面只介绍了 Web 服务的核心功能，还有很多其他的功能，你可以通过学习<a href="https://github.com/gin-gonic/gin" target="_blank" rel="noopener noreferrer">Gin 的官方文档<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>来了解。</p><p>你可以看到，Web 服务有很多核心功能，这些功能我们可以基于 net/http 包自己封装。但在实际的项目开发中， 我们更多会选择使用基于 net/http 包进行封装的优秀开源 Web 框架。本实战项目选择了 Gin 框架。</p><p>接下来，我们主要看下 Gin 框架是如何实现以上核心功能的，这些功能我们在实际的开发中可以直接拿来使用。</p><h2 id="为什么选择-gin-框架" tabindex="-1"><a class="header-anchor" href="#为什么选择-gin-框架" aria-hidden="true">#</a> 为什么选择 Gin 框架？</h2><p>优秀的 Web 框架有很多，我们为什么要选择 Gin 呢？在回答这个问题之前，我们先来看下选择 Web 框架时的关注点。</p><p>在选择 Web 框架时，我们可以关注如下几点：</p><ul><li><p>路由功能；</p></li><li><p>是否具备 middleware/filter 能力；</p></li><li><p>HTTP 参数（path、query、form、header、body）解析和返回；</p></li><li><p>性能和稳定性；</p></li><li><p>使用复杂度；</p></li><li><p>社区活跃度。</p></li></ul><p>按 GitHub Star 数来排名，当前比较火的 Go Web 框架有 Gin、Beego、Echo、Revel 、Martini。经过调研，我从中选择了 Gin 框架，原因是 Gin 具有如下特性：</p><ol><li><p>轻量级，代码质量高，性能比较高；</p></li><li><p>项目目前很活跃，并有很多可用的 Middleware；</p></li><li><p>作为一个 Web 框架，功能齐全，使用起来简单。</p></li><li><p>那接下来，我就先详细介绍下 Gin 框架。</p></li></ol><p>Gin是用 Go 语言编写的 Web 框架，功能完善，使用简单，性能很高。Gin 核心的路由功能是通过一个定制版的<a href="https://github.com/julienschmidt/httprouter" target="_blank" rel="noopener noreferrer">HttpRouter<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>来实现的，具有很高的路由性能。</p><p><strong>Gin 有很多功能，这里我给你列出了它的一些核心功能：</strong></p><ol><li><p>支持 HTTP 方法：GET、POST、PUT、PATCH、DELETE、OPTIONS。</p></li><li><p>支持不同位置的 HTTP 参数：路径参数（path）、查询字符串参数（query）、表单参数（form）、HTTP 头参数（header）、消息体参数（body）。</p></li><li><p>支持 HTTP 路由和路由分组。</p></li><li><p>支持 middleware 和自定义 middleware。</p></li><li><p>支持自定义 Log。</p></li><li><p>支持 binding 和 validation，支持自定义 validator。可以 bind 如下参数：query、path、body、header、form。</p></li><li><p>支持重定向。</p></li><li><p>支持 basic auth middleware。</p></li><li><p>支持自定义 HTTP 配置。</p></li><li><p>支持优雅关闭。</p></li><li><p>支持 HTTP2。</p></li><li><p>支持设置和获取 cookie。</p></li></ol><h2 id="gin-是如何支持-web-服务基础功能的" tabindex="-1"><a class="header-anchor" href="#gin-是如何支持-web-服务基础功能的" aria-hidden="true">#</a> Gin 是如何支持 Web 服务基础功能的？</h2><p>接下来，我们先通过一个具体的例子，看下 Gin 是如何支持 Web 服务基础功能的，后面再详细介绍这些功能的用法。</p><p>我们创建一个 webfeature 目录，用来存放示例代码。因为要演示 HTTPS 的用法，所以需要创建证书文件。具体可以分为两步。</p><p>第一步，执行以下命令创建证书：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>cat <span class="token operator">&lt;&lt;</span> <span class="token string">&#39;EOF&#39;</span> <span class="token operator">&gt;</span> ca<span class="token punctuation">.</span>pem
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token constant">BEGIN</span> <span class="token constant">CERTIFICATE</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
MIICSjCCAbOgAwIBAgIJAJHGGR4dGioHMA0GCSqGSIb3DQEBCwUAMFYxCzAJBgNV
BAYTAkFVMRMwEQYDVQQIEwpTb21lLVN0YXRlMSEwHwYDVQQKExhJbnRlcm5ldCBX
aWRnaXRzIFB0eSBMdGQxDzANBgNVBAMTBnRlc3RjYTAeFw0xNDExMTEyMjMxMjla
Fw0yNDExMDgyMjMxMjlaMFYxCzAJBgNVBAYTAkFVMRMwEQYDVQQIEwpTb21lLVN0
YXRlMSEwHwYDVQQKExhJbnRlcm5ldCBXaWRnaXRzIFB0eSBMdGQxDzANBgNVBAMT
BnRlc3RjYTCBnzANBgkqhkiG9w0BAQEFAAOBjQAwgYkCgYEAwEDfBV5MYdlHVHJ7
<span class="token operator">+</span>L4nxrZy7mBfAVXpOc5vMYztssUI7mL2<span class="token operator">/</span>iYujiIXM<span class="token operator">+</span>weZYNTEpLdjyJdu7R5gGUu
g1jSVK<span class="token operator">/</span>EPHfc74O7AyZU34PNIP4Sh33N<span class="token operator">+</span><span class="token operator">/</span>A5YexrNgJlPY<span class="token operator">+</span>E3GdVYi4ldWJjgkAd
Qah2PH5ACLrIIC6tRka9hcaBlIECAwEAAaMgMB4wDAYDVR0TBAUwAwEB<span class="token operator">/</span>zAOBgNV
HQ8BAf8EBAMCAgQwDQYJKoZIhvcNAQELBQADgYEAHzC7jdYlzAVmddi<span class="token operator">/</span>gdAeKPau
sPBG<span class="token operator">/</span>C2HCWqHzpCUHcKuvMzDVkY<span class="token operator">/</span>MP2o6JIW2DBbY64bO<span class="token operator">/</span>FceExhjcykgaYtCH<span class="token operator">/</span>m
oIU63<span class="token operator">+</span>CFOTtR7otyQAWHqXa7q4SbCDlG7DyRFxqG0txPtGvy12lgldA2<span class="token operator">+</span>RgcigQG
Dfcog5wrJytaQ6UA0wE<span class="token operator">=</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token constant">END</span> <span class="token constant">CERTIFICATE</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
<span class="token constant">EOF</span>

cat <span class="token operator">&lt;&lt;</span> <span class="token string">&#39;EOF&#39;</span> <span class="token operator">&gt;</span> server<span class="token punctuation">.</span>key
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token constant">BEGIN</span> <span class="token constant">PRIVATE</span> <span class="token constant">KEY</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
MIICdQIBADANBgkqhkiG9w0BAQEFAASCAl8wggJbAgEAAoGBAOHDFScoLCVJpYDD
M4HYtIdV6Ake<span class="token operator">/</span>sMNaaKdODjDMsux<span class="token operator">/</span>4tDydlumN<span class="token operator">+</span>fm<span class="token operator">+</span>AjPEK5GHhGn1BgzkWF<span class="token operator">+</span>slf
3BxhrA<span class="token operator">/</span>8dNsnunstVA7ZBgA<span class="token operator">/</span>5qQxMfGAq4wHNVX77fBZOgp9VlSMVfyd9N8YwbBY
AckOeUQadTi2X1S6OgJXgQ0m3MWhAgMBAAECgYAn7qGnM2vbjJNBm0VZCkOkTIWm
V10okw7EPJrdL2mkre9NasghNXbE1y5zDshx5Nt3KsazKOxTT8d0Jwh<span class="token operator">/</span>3KbaN<span class="token operator">+</span><span class="token constant">YY</span>
tTCbKGW0pXDRBhwUHRcuRzScjli8Rih5UOCiZkhefUTcRb6xIhZJuQy71tjaSy0p
dHZRmYyBYO2YEQ8xoQJBAPrJPhMBkzmEYFtyIEqAxQ<span class="token operator">/</span>o<span class="token operator">/</span><span class="token constant">A6E</span><span class="token operator">+</span>E4w8i<span class="token operator">+</span>KM7nQCK7q
K4JXzyXVAjLfyBZWHGM2uro<span class="token operator">/</span>fjqPggGD6QH1qXCkI4MCQQDmdKeb2TrKRh5BY1LR
81aJGKcJ2XbcDu6wMZK4oqWbTX2KiYn9GB0woM6nSr<span class="token operator">/</span>Y6iy1u145YzYxEV<span class="token operator">/</span>iMwff
DJULAkB8B2MnyzOg0pNFJqBJuH29bKCcHa8gHJzqXhNO5lAlEbMK95p<span class="token operator">/</span>P2Wi<span class="token operator">+</span>4Hd
aiEIAF1BF326QJcvYKmwSmrORp85AkAlSNxRJ50OWrfMZnBgzVjDx3xG6KsFQVk2
ol6VhqL6dFgKUORFUWBvnKSyhjJxurlPEahV6oo6<span class="token operator">+</span><span class="token constant">A</span><span class="token operator">+</span>mPhFY8eUvAkAZQyTdupP3
XEFQKctGz<span class="token operator">+</span><span class="token number">9</span><span class="token operator">+</span>gKkemDp7LBBMEMBXrGTLPhpEfcjv<span class="token operator">/</span>7KPdnFHYmhYeBTBnuVmTVWe
F98XJ7tIFfJq
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token constant">END</span> <span class="token constant">PRIVATE</span> <span class="token constant">KEY</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
<span class="token constant">EOF</span>

cat <span class="token operator">&lt;&lt;</span> <span class="token string">&#39;EOF&#39;</span> <span class="token operator">&gt;</span> server<span class="token punctuation">.</span>pem
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token constant">BEGIN</span> <span class="token constant">CERTIFICATE</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
MIICnDCCAgWgAwIBAgIBBzANBgkqhkiG9w0BAQsFADBWMQswCQYDVQQGEwJBVTET
MBEGA1UECBMKU29tZS1TdGF0ZTEhMB8GA1UEChMYSW50ZXJuZXQgV2lkZ2l0cyBQ
dHkgTHRkMQ8wDQYDVQQDEwZ0ZXN0Y2EwHhcNMTUxMTA0MDIyMDI0WhcNMjUxMTAx
MDIyMDI0WjBlMQswCQYDVQQGEwJVUzERMA8GA1UECBMISWxsaW5vaXMxEDAOBgNV
BAcTB0NoaWNhZ28xFTATBgNVBAoTDEV4YW1wbGUsIENvLjEaMBgGA1UEAxQRKi50
ZXN0Lmdvb2dsZS5jb20wgZ8wDQYJKoZIhvcNAQEBBQADgY0AMIGJAoGBAOHDFSco
LCVJpYDDM4HYtIdV6Ake<span class="token operator">/</span>sMNaaKdODjDMsux<span class="token operator">/</span>4tDydlumN<span class="token operator">+</span>fm<span class="token operator">+</span>AjPEK5GHhGn1Bg
zkWF<span class="token operator">+</span>slf3BxhrA<span class="token operator">/</span>8dNsnunstVA7ZBgA<span class="token operator">/</span>5qQxMfGAq4wHNVX77fBZOgp9VlSMVfyd
9N8YwbBYAckOeUQadTi2X1S6OgJXgQ0m3MWhAgMBAAGjazBpMAkGA1UdEwQCMAAw
CwYDVR0PBAQDAgXgME8GA1UdEQRIMEaCECoudGVzdC5nb29nbGUuZnKCGHdhdGVy
em9vaS50ZXN0Lmdvb2dsZS5iZYISKi50ZXN0LnlvdXR1YmUuY29thwTAqAEDMA0G
CSqGSIb3DQEBCwUAA4GBAJFXVifQNub1LUP4JlnX5lXNlo8FxZ2a12AFQs<span class="token operator">+</span>bzoJ6
hM044EDjqyxUqSbVePK0ni3w1fHQB5rY9yYC5f8G7aqqTY1QOhoUk8ZTSTRpnkTh
y4jjdvTZeLDVBlueZUTDRmy2feY5aZIU18vFDK08dTG0A87pppuv1LNIR3loveU8
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token constant">END</span> <span class="token constant">CERTIFICATE</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
<span class="token constant">EOF</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>第二步，创建 main.go 文件：</strong></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">package</span> main
<span class="token keyword">import</span> <span class="token punctuation">(</span>
  <span class="token string">&quot;fmt&quot;</span>
  <span class="token string">&quot;log&quot;</span>
  <span class="token string">&quot;net/http&quot;</span>
  <span class="token string">&quot;sync&quot;</span>
  <span class="token string">&quot;time&quot;</span>
  <span class="token string">&quot;github.com/gin-gonic/gin&quot;</span>
  <span class="token string">&quot;golang.org/x/sync/errgroup&quot;</span>
<span class="token punctuation">)</span>
type Product struct <span class="token punctuation">{</span>
  Username    string    <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">json:&quot;username&quot; binding:&quot;required&quot;</span><span class="token template-punctuation string">`</span></span>
  Name        string    <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">json:&quot;name&quot; binding:&quot;required&quot;</span><span class="token template-punctuation string">`</span></span>
  Category    string    <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">json:&quot;category&quot; binding:&quot;required&quot;</span><span class="token template-punctuation string">`</span></span>
  Price       int       <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">json:&quot;price&quot; binding:&quot;gte=0&quot;</span><span class="token template-punctuation string">`</span></span>
  Description string    <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">json:&quot;description&quot;</span><span class="token template-punctuation string">`</span></span>
  CreatedAt   time<span class="token punctuation">.</span>Time <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">json:&quot;createdAt&quot;</span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span>
type productHandler struct <span class="token punctuation">{</span>
  sync<span class="token punctuation">.</span>RWMutex
  products map<span class="token punctuation">[</span>string<span class="token punctuation">]</span>Product
<span class="token punctuation">}</span>
func <span class="token function">newProductHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span>productHandler <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token operator">&amp;</span>productHandler<span class="token punctuation">{</span>
    <span class="token literal-property property">products</span><span class="token operator">:</span> <span class="token function">make</span><span class="token punctuation">(</span>map<span class="token punctuation">[</span>string<span class="token punctuation">]</span>Product<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">func</span> <span class="token punctuation">(</span>u <span class="token operator">*</span>productHandler<span class="token punctuation">)</span> <span class="token function">Create</span><span class="token punctuation">(</span><span class="token parameter">c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  u<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  defer u<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// 1. 参数解析</span>
  <span class="token keyword">var</span> product Product
  <span class="token keyword">if</span> <span class="token literal-property property">err</span> <span class="token operator">:</span><span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">ShouldBindJSON</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>product<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> nil <span class="token punctuation">{</span>
    c<span class="token punctuation">.</span><span class="token constant">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusBadRequest<span class="token punctuation">,</span> gin<span class="token punctuation">.</span><span class="token constant">H</span><span class="token punctuation">{</span><span class="token string-property property">&quot;error&quot;</span><span class="token operator">:</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 2. 参数校验</span>
  <span class="token keyword">if</span> _<span class="token punctuation">,</span> <span class="token literal-property property">ok</span> <span class="token operator">:</span><span class="token operator">=</span> u<span class="token punctuation">.</span>products<span class="token punctuation">[</span>product<span class="token punctuation">.</span>Name<span class="token punctuation">]</span><span class="token punctuation">;</span> ok <span class="token punctuation">{</span>
    c<span class="token punctuation">.</span><span class="token constant">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusBadRequest<span class="token punctuation">,</span> gin<span class="token punctuation">.</span><span class="token constant">H</span><span class="token punctuation">{</span><span class="token string-property property">&quot;error&quot;</span><span class="token operator">:</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;product %s already exist&quot;</span><span class="token punctuation">,</span> product<span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>
  product<span class="token punctuation">.</span>CreatedAt <span class="token operator">=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// 3. 逻辑处理</span>
  u<span class="token punctuation">.</span>products<span class="token punctuation">[</span>product<span class="token punctuation">.</span>Name<span class="token punctuation">]</span> <span class="token operator">=</span> product
  log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Register product %s success&quot;</span><span class="token punctuation">,</span> product<span class="token punctuation">.</span>Name<span class="token punctuation">)</span>
  <span class="token comment">// 4. 返回结果</span>
  c<span class="token punctuation">.</span><span class="token constant">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> product<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">func</span> <span class="token punctuation">(</span>u <span class="token operator">*</span>productHandler<span class="token punctuation">)</span> <span class="token function">Get</span><span class="token punctuation">(</span><span class="token parameter">c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  u<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  defer u<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  product<span class="token punctuation">,</span> <span class="token literal-property property">ok</span> <span class="token operator">:</span><span class="token operator">=</span> u<span class="token punctuation">.</span>products<span class="token punctuation">[</span>c<span class="token punctuation">.</span><span class="token function">Param</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
  <span class="token keyword">if</span> <span class="token operator">!</span>ok <span class="token punctuation">{</span>
    c<span class="token punctuation">.</span><span class="token constant">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusNotFound<span class="token punctuation">,</span> gin<span class="token punctuation">.</span><span class="token constant">H</span><span class="token punctuation">{</span><span class="token string-property property">&quot;error&quot;</span><span class="token operator">:</span> fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;can not found product %s&quot;</span><span class="token punctuation">,</span> c<span class="token punctuation">.</span><span class="token function">Param</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>
  c<span class="token punctuation">.</span><span class="token constant">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> product<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
func <span class="token function">router</span><span class="token punctuation">(</span><span class="token punctuation">)</span> http<span class="token punctuation">.</span>Handler <span class="token punctuation">{</span>
  <span class="token literal-property property">router</span> <span class="token operator">:</span><span class="token operator">=</span> gin<span class="token punctuation">.</span><span class="token function">Default</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token literal-property property">productHandler</span> <span class="token operator">:</span><span class="token operator">=</span> <span class="token function">newProductHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// 路由分组、中间件、认证</span>
  <span class="token literal-property property">v1</span> <span class="token operator">:</span><span class="token operator">=</span> router<span class="token punctuation">.</span><span class="token function">Group</span><span class="token punctuation">(</span><span class="token string">&quot;/v1&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">productv1</span> <span class="token operator">:</span><span class="token operator">=</span> v1<span class="token punctuation">.</span><span class="token function">Group</span><span class="token punctuation">(</span><span class="token string">&quot;/products&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token comment">// 路由匹配</span>
      productv1<span class="token punctuation">.</span><span class="token constant">POST</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> productHandler<span class="token punctuation">.</span>Create<span class="token punctuation">)</span>
      productv1<span class="token punctuation">.</span><span class="token constant">GET</span><span class="token punctuation">(</span><span class="token string">&quot;:name&quot;</span><span class="token punctuation">,</span> productHandler<span class="token punctuation">.</span>Get<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> router
<span class="token punctuation">}</span>
func <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> eg errgroup<span class="token punctuation">.</span>Group
  <span class="token comment">// 一进程多端口</span>
  <span class="token literal-property property">insecureServer</span> <span class="token operator">:</span><span class="token operator">=</span> <span class="token operator">&amp;</span>http<span class="token punctuation">.</span>Server<span class="token punctuation">{</span>
    <span class="token literal-property property">Addr</span><span class="token operator">:</span>         <span class="token string">&quot;:8080&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">Handler</span><span class="token operator">:</span>      <span class="token function">router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">ReadTimeout</span><span class="token operator">:</span>  <span class="token number">5</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">,</span>
    <span class="token literal-property property">WriteTimeout</span><span class="token operator">:</span> <span class="token number">10</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  <span class="token literal-property property">secureServer</span> <span class="token operator">:</span><span class="token operator">=</span> <span class="token operator">&amp;</span>http<span class="token punctuation">.</span>Server<span class="token punctuation">{</span>
    <span class="token literal-property property">Addr</span><span class="token operator">:</span>         <span class="token string">&quot;:8443&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">Handler</span><span class="token operator">:</span>      <span class="token function">router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">ReadTimeout</span><span class="token operator">:</span>  <span class="token number">5</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">,</span>
    <span class="token literal-property property">WriteTimeout</span><span class="token operator">:</span> <span class="token number">10</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  eg<span class="token punctuation">.</span><span class="token function">Go</span><span class="token punctuation">(</span><span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> error <span class="token punctuation">{</span>
    <span class="token literal-property property">err</span> <span class="token operator">:</span><span class="token operator">=</span> insecureServer<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> nil <span class="token operator">&amp;&amp;</span> err <span class="token operator">!=</span> http<span class="token punctuation">.</span>ErrServerClosed <span class="token punctuation">{</span>
      log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> err
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  eg<span class="token punctuation">.</span><span class="token function">Go</span><span class="token punctuation">(</span><span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> error <span class="token punctuation">{</span>
    <span class="token literal-property property">err</span> <span class="token operator">:</span><span class="token operator">=</span> secureServer<span class="token punctuation">.</span><span class="token function">ListenAndServeTLS</span><span class="token punctuation">(</span><span class="token string">&quot;server.pem&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;server.key&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> nil <span class="token operator">&amp;&amp;</span> err <span class="token operator">!=</span> http<span class="token punctuation">.</span>ErrServerClosed <span class="token punctuation">{</span>
      log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> err
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token literal-property property">err</span> <span class="token operator">:</span><span class="token operator">=</span> eg<span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> nil <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>运行以上代码：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>$ go run main<span class="token punctuation">.</span>go
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>打开另外一个终端，请求 HTTP 接口：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>$ go run main<span class="token punctuation">.</span>go
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>示例代码存放地址为webfeature。</p><p>另外，Gin 项目仓库中也包含了很多使用示例，如果你想详细了解，可以参考 gin examples。</p><p>下面，我来详细介绍下 Gin 是如何支持 Web 服务基础功能的。</p><h3 id="http-https-支持" tabindex="-1"><a class="header-anchor" href="#http-https-支持" aria-hidden="true">#</a> HTTP/HTTPS 支持</h3><p>因为 Gin 是基于 net/http 包封装的一个 Web 框架，所以它天然就支持 HTTP/HTTPS。在上述代码中，通过以下方式开启一个 HTTP 服务：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token literal-property property">insecureServer</span> <span class="token operator">:</span><span class="token operator">=</span> <span class="token operator">&amp;</span>http<span class="token punctuation">.</span>Server<span class="token punctuation">{</span>
  <span class="token literal-property property">Addr</span><span class="token operator">:</span>         <span class="token string">&quot;:8080&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">Handler</span><span class="token operator">:</span>      <span class="token function">router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">ReadTimeout</span><span class="token operator">:</span>  <span class="token number">5</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">,</span>
  <span class="token literal-property property">WriteTimeout</span><span class="token operator">:</span> <span class="token number">10</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token operator">...</span>
<span class="token literal-property property">err</span> <span class="token operator">:</span><span class="token operator">=</span> insecureServer<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通过以下方式开启一个 HTTPS 服务：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token literal-property property">secureServer</span> <span class="token operator">:</span><span class="token operator">=</span> <span class="token operator">&amp;</span>http<span class="token punctuation">.</span>Server<span class="token punctuation">{</span>
  <span class="token literal-property property">Addr</span><span class="token operator">:</span>         <span class="token string">&quot;:8443&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">Handler</span><span class="token operator">:</span>      <span class="token function">router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">ReadTimeout</span><span class="token operator">:</span>  <span class="token number">5</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">,</span>
  <span class="token literal-property property">WriteTimeout</span><span class="token operator">:</span> <span class="token number">10</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token operator">...</span>
<span class="token literal-property property">err</span> <span class="token operator">:</span><span class="token operator">=</span> secureServer<span class="token punctuation">.</span><span class="token function">ListenAndServeTLS</span><span class="token punctuation">(</span><span class="token string">&quot;server.pem&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;server.key&quot;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="json-数据格式支持" tabindex="-1"><a class="header-anchor" href="#json-数据格式支持" aria-hidden="true">#</a> JSON 数据格式支持</h3><p>Gin 支持多种数据通信格式，例如 application/json、application/xml。可以通过c.ShouldBindJSON函数，将 Body 中的 JSON 格式数据解析到指定的 Struct 中，通过c.JSON函数返回 JSON 格式的数据。</p><h3 id="路由匹配" tabindex="-1"><a class="header-anchor" href="#路由匹配" aria-hidden="true">#</a> 路由匹配</h3><p>Gin 支持两种路由匹配规则。</p><p>**第一种匹配规则是精确匹配。**例如，路由为 <code>/products/:name</code>，匹配情况如下表所示：</p><p><img src="https://static001.geekbang.org/resource/image/11/df/11be05d7fe7f935e01725e2635f315df.jpg?wh=2248x1418" alt="img"></p><p>**第二种匹配规则是模糊匹配。**例如，路由为 /products/*name，匹配情况如下表所示：</p><p><img src="https://static001.geekbang.org/resource/image/b5/7b/b5ccd9924e53dd90a64af6002967b67b.jpg?wh=2248x1636" alt="img"></p><h3 id="路由分组" tabindex="-1"><a class="header-anchor" href="#路由分组" aria-hidden="true">#</a> 路由分组</h3><p>Gin 通过 Group 函数实现了路由分组的功能。路由分组是一个非常常用的功能，可以将相同版本的路由分为一组，也可以将相同 RESTful 资源的路由分为一组。例如：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token literal-property property">v1</span> <span class="token operator">:</span><span class="token operator">=</span> router<span class="token punctuation">.</span><span class="token function">Group</span><span class="token punctuation">(</span><span class="token string">&quot;/v1&quot;</span><span class="token punctuation">,</span> gin<span class="token punctuation">.</span><span class="token function">BasicAuth</span><span class="token punctuation">(</span>gin<span class="token punctuation">.</span>Accounts<span class="token punctuation">{</span><span class="token string-property property">&quot;foo&quot;</span><span class="token operator">:</span> <span class="token string">&quot;bar&quot;</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;colin&quot;</span><span class="token operator">:</span> <span class="token string">&quot;colin404&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token literal-property property">productv1</span> <span class="token operator">:</span><span class="token operator">=</span> v1<span class="token punctuation">.</span><span class="token function">Group</span><span class="token punctuation">(</span><span class="token string">&quot;/products&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// 路由匹配</span>
        productv1<span class="token punctuation">.</span><span class="token constant">POST</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> productHandler<span class="token punctuation">.</span>Create<span class="token punctuation">)</span>
        productv1<span class="token punctuation">.</span><span class="token constant">GET</span><span class="token punctuation">(</span><span class="token string">&quot;:name&quot;</span><span class="token punctuation">,</span> productHandler<span class="token punctuation">.</span>Get<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token literal-property property">orderv1</span> <span class="token operator">:</span><span class="token operator">=</span> v1<span class="token punctuation">.</span><span class="token function">Group</span><span class="token punctuation">(</span><span class="token string">&quot;/orders&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// 路由匹配</span>
        orderv1<span class="token punctuation">.</span><span class="token constant">POST</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> orderHandler<span class="token punctuation">.</span>Create<span class="token punctuation">)</span>
        orderv1<span class="token punctuation">.</span><span class="token constant">GET</span><span class="token punctuation">(</span><span class="token string">&quot;:name&quot;</span><span class="token punctuation">,</span> orderHandler<span class="token punctuation">.</span>Get<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token literal-property property">v2</span> <span class="token operator">:</span><span class="token operator">=</span> router<span class="token punctuation">.</span><span class="token function">Group</span><span class="token punctuation">(</span><span class="token string">&quot;/v2&quot;</span><span class="token punctuation">,</span> gin<span class="token punctuation">.</span><span class="token function">BasicAuth</span><span class="token punctuation">(</span>gin<span class="token punctuation">.</span>Accounts<span class="token punctuation">{</span><span class="token string-property property">&quot;foo&quot;</span><span class="token operator">:</span> <span class="token string">&quot;bar&quot;</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;colin&quot;</span><span class="token operator">:</span> <span class="token string">&quot;colin404&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token literal-property property">productv2</span> <span class="token operator">:</span><span class="token operator">=</span> v2<span class="token punctuation">.</span><span class="token function">Group</span><span class="token punctuation">(</span><span class="token string">&quot;/products&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// 路由匹配</span>
        productv2<span class="token punctuation">.</span><span class="token constant">POST</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> productHandler<span class="token punctuation">.</span>Create<span class="token punctuation">)</span>
        productv2<span class="token punctuation">.</span><span class="token constant">GET</span><span class="token punctuation">(</span><span class="token string">&quot;:name&quot;</span><span class="token punctuation">,</span> productHandler<span class="token punctuation">.</span>Get<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通过将路由分组，可以对相同分组的路由做统一处理。比如上面那个例子，我们可以通过代码</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token literal-property property">v1</span> <span class="token operator">:</span><span class="token operator">=</span> router<span class="token punctuation">.</span><span class="token function">Group</span><span class="token punctuation">(</span><span class="token string">&quot;/v1&quot;</span><span class="token punctuation">,</span> gin<span class="token punctuation">.</span><span class="token function">BasicAuth</span><span class="token punctuation">(</span>gin<span class="token punctuation">.</span>Accounts<span class="token punctuation">{</span><span class="token string-property property">&quot;foo&quot;</span><span class="token operator">:</span> <span class="token string">&quot;bar&quot;</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;colin&quot;</span><span class="token operator">:</span> <span class="token string">&quot;colin404&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>给所有属于 v1 分组的路由都添加 gin.BasicAuth 中间件，以实现认证功能。中间件和认证，这里你先不用深究，下面讲高级功能的时候会介绍到。</p><h3 id="一进程多服务" tabindex="-1"><a class="header-anchor" href="#一进程多服务" aria-hidden="true">#</a> 一进程多服务</h3><p>我们可以通过以下方式实现一进程多服务：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> eg errgroup<span class="token punctuation">.</span>Group
<span class="token literal-property property">insecureServer</span> <span class="token operator">:</span><span class="token operator">=</span> <span class="token operator">&amp;</span>http<span class="token punctuation">.</span>Server<span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token literal-property property">secureServer</span> <span class="token operator">:</span><span class="token operator">=</span> <span class="token operator">&amp;</span>http<span class="token punctuation">.</span>Server<span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
eg<span class="token punctuation">.</span><span class="token function">Go</span><span class="token punctuation">(</span><span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> error <span class="token punctuation">{</span>
  <span class="token literal-property property">err</span> <span class="token operator">:</span><span class="token operator">=</span> insecureServer<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> err <span class="token operator">!=</span> nil <span class="token operator">&amp;&amp;</span> err <span class="token operator">!=</span> http<span class="token punctuation">.</span>ErrServerClosed <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> err
<span class="token punctuation">}</span><span class="token punctuation">)</span>
eg<span class="token punctuation">.</span><span class="token function">Go</span><span class="token punctuation">(</span><span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> error <span class="token punctuation">{</span>
  <span class="token literal-property property">err</span> <span class="token operator">:</span><span class="token operator">=</span> secureServer<span class="token punctuation">.</span><span class="token function">ListenAndServeTLS</span><span class="token punctuation">(</span><span class="token string">&quot;server.pem&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;server.key&quot;</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> err <span class="token operator">!=</span> nil <span class="token operator">&amp;&amp;</span> err <span class="token operator">!=</span> http<span class="token punctuation">.</span>ErrServerClosed <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> err
<span class="token punctuation">}</span>
<span class="token keyword">if</span> <span class="token literal-property property">err</span> <span class="token operator">:</span><span class="token operator">=</span> eg<span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> nil <span class="token punctuation">{</span>
  log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上述代码实现了两个相同的服务，分别监听在不同的端口。这里需要注意的是，为了不阻塞启动第二个服务，我们需要把 ListenAndServe 函数放在 goroutine 中执行，并且调用 eg.Wait() 来阻塞程序进程，从而让两个 HTTP 服务在 goroutine 中持续监听端口，并提供服务。</p><h3 id="参数解析、参数校验、逻辑处理、返回结果" tabindex="-1"><a class="header-anchor" href="#参数解析、参数校验、逻辑处理、返回结果" aria-hidden="true">#</a> 参数解析、参数校验、逻辑处理、返回结果</h3><p>此外，Web 服务还应该具有参数解析、参数校验、逻辑处理、返回结果 4 类功能，因为这些功能联系紧密，我们放在一起来说。</p><p>在 productHandler 的 Create 方法中，我们通过<code>c.ShouldBindJSON</code>来解析参数，接下来自己编写校验代码，然后将 product 信息保存在内存中（也就是业务逻辑处理），最后通过c.JSON返回创建的 product 信息。代码如下：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">func</span> <span class="token punctuation">(</span>u <span class="token operator">*</span>productHandler<span class="token punctuation">)</span> <span class="token function">Create</span><span class="token punctuation">(</span><span class="token parameter">c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  u<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  defer u<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// 1. 参数解析</span>
  <span class="token keyword">var</span> product Product
  <span class="token keyword">if</span> <span class="token literal-property property">err</span> <span class="token operator">:</span><span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">ShouldBindJSON</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>product<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> nil <span class="token punctuation">{</span>
    c<span class="token punctuation">.</span><span class="token constant">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusBadRequest<span class="token punctuation">,</span> gin<span class="token punctuation">.</span><span class="token constant">H</span><span class="token punctuation">{</span><span class="token string-property property">&quot;error&quot;</span><span class="token operator">:</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 2. 参数校验</span>
  <span class="token keyword">if</span> _<span class="token punctuation">,</span> <span class="token literal-property property">ok</span> <span class="token operator">:</span><span class="token operator">=</span> u<span class="token punctuation">.</span>products<span class="token punctuation">[</span>product<span class="token punctuation">.</span>Name<span class="token punctuation">]</span><span class="token punctuation">;</span> ok <span class="token punctuation">{</span>
    c<span class="token punctuation">.</span><span class="token constant">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusBadRequest<span class="token punctuation">,</span> gin<span class="token punctuation">.</span><span class="token constant">H</span><span class="token punctuation">{</span><span class="token string-property property">&quot;error&quot;</span><span class="token operator">:</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;product %s already exist&quot;</span><span class="token punctuation">,</span> product<span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>
  product<span class="token punctuation">.</span>CreatedAt <span class="token operator">=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// 3. 逻辑处理</span>
  u<span class="token punctuation">.</span>products<span class="token punctuation">[</span>product<span class="token punctuation">.</span>Name<span class="token punctuation">]</span> <span class="token operator">=</span> product
  log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Register product %s success&quot;</span><span class="token punctuation">,</span> product<span class="token punctuation">.</span>Name<span class="token punctuation">)</span>
  <span class="token comment">// 4. 返回结果</span>
  c<span class="token punctuation">.</span><span class="token constant">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> product<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>那这个时候，你可能会问：HTTP 的请求参数可以存在不同的位置，Gin 是如何解析的呢？这里，我们先来看下 HTTP 有哪些参数类型。HTTP 具有以下 5 种参数类型：</p><ol><li><p>路径参数（path）。例如<code>gin.Default().GET(&quot;/user/:name&quot;, nil)</code>， name 就是路径参数。</p></li><li><p>查询字符串参数（query）。例如<code>/welcome?firstname=Lingfei&amp;lastname=Kong</code>，firstname 和 lastname 就是查询字符串参数。</p></li><li><p>表单参数（form）。例如<code>curl -X POST -F &#39;username=colin&#39; -F &#39;password=colin1234&#39; http://mydomain.com/login</code>，username 和 password 就是表单参数。</p></li><li><p>HTTP 头参数（header）。例如<code>curl -X POST -H &#39;Content-Type: application/json&#39; -d &#39;{&quot;username&quot;:&quot;colin&quot;,&quot;password&quot;:&quot;colin1234&quot;}&#39; http://mydomain.com/login</code>，Content-Type 就是 HTTP 头参数。</p></li><li><p>消息体参数（body）。例如<code>curl -X POST -H &#39;Content-Type: application/json&#39; -d &#39;{&quot;username&quot;:&quot;colin&quot;,&quot;password&quot;:&quot;colin1234&quot;}&#39; http://mydomain.com/login</code>，username 和 password 就是消息体参数。</p></li></ol><p>Gin 提供了一些函数，来分别读取这些 HTTP 参数，每种类别会提供两种函数，一种函数可以直接读取某个参数的值，另外一种函数会把同类 HTTP 参数绑定到一个 Go 结构体中。比如，有如下路径参数：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>gin<span class="token punctuation">.</span><span class="token function">Default</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token constant">GET</span><span class="token punctuation">(</span><span class="token string">&quot;/:name/:id&quot;</span><span class="token punctuation">,</span> nil<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>我们可以直接读取每个参数：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token literal-property property">name</span> <span class="token operator">:</span><span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">Param</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span>
<span class="token literal-property property">action</span> <span class="token operator">:</span><span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">Param</span><span class="token punctuation">(</span><span class="token string">&quot;action&quot;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>也可以将所有的路径参数，绑定到结构体中：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>type Person struct <span class="token punctuation">{</span>
    <span class="token constant">ID</span> string <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">uri:&quot;id&quot; binding:&quot;required,uuid&quot;</span><span class="token template-punctuation string">`</span></span>
    Name string <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">uri:&quot;name&quot; binding:&quot;required&quot;</span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span> <span class="token literal-property property">err</span> <span class="token operator">:</span><span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">ShouldBindUri</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>person<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> nil <span class="token punctuation">{</span>
    <span class="token comment">// normal code</span>
    <span class="token keyword">return</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Gin 在绑定参数时，是通过结构体的 tag 来判断要绑定哪类参数到结构体中的。这里要注意，不同的 HTTP 参数有不同的结构体 tag。</p><ol><li><p>路径参数：uri。</p></li><li><p>查询字符串参数：form。</p></li><li><p>表单参数：form。</p></li><li><p>HTTP 头参数：header。</p></li><li><p>消息体参数：会根据 Content-Type，自动选择使用 json 或者 xml，也可以调用 ShouldBindJSON 或者 ShouldBindXML 直接指定使用哪个 tag。</p></li></ol><p>针对每种参数类型，Gin 都有对应的函数来获取和绑定这些参数。这些函数都是基于如下两个函数进行封装的：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>ShouldBindWith(obj interface{}, b binding.Binding) error
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>非常重要的一个函数，很多 ShouldBindXXX 函数底层都是调用 ShouldBindWith 函数来完成参数绑定的。该函数会根据传入的绑定引擎，将参数绑定到传入的结构体指针中，**如果绑定失败，只返回错误内容，但不终止 HTTP 请求。**ShouldBindWith 支持多种绑定引擎，例如 binding.JSON、binding.Query、binding.Uri、binding.Header 等，更详细的信息你可以参考 binding.go。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>MustBindWith(obj interface{}, b binding.Binding) error
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>这是另一个非常重要的函数，很多 BindXXX 函数底层都是调用 MustBindWith 函数来完成参数绑定的。该函数会根据传入的绑定引擎，将参数绑定到传入的结构体指针中，**如果绑定失败，返回错误并终止请求，返回 HTTP 400 错误。**MustBindWith 所支持的绑定引擎跟 ShouldBindWith 函数一样。</p><p>Gin 基于 ShouldBindWith 和 MustBindWith 这两个函数，又衍生出很多新的 Bind 函数。这些函数可以满足不同场景下获取 HTTP 参数的需求。Gin 提供的函数可以获取 5 个类别的 HTTP 参数。</p><ol><li><p>路径参数：ShouldBindUri、BindUri；</p></li><li><p>查询字符串参数：ShouldBindQuery、BindQuery；</p></li><li><p>表单参数：ShouldBind；</p></li><li><p>HTTP 头参数：ShouldBindHeader、BindHeader；</p></li><li><p>消息体参数：ShouldBindJSON、BindJSON 等。</p></li></ol><p>每个类别的 Bind 函数，详细信息你可以参考Gin 提供的 Bind 函数。</p><p>这里要注意，Gin 并没有提供类似 ShouldBindForm、BindForm 这类函数来绑定表单参数，但我们可以通过 ShouldBind 来绑定表单参数。当 HTTP 方法为 GET 时，ShouldBind 只绑定 Query 类型的参数；当 HTTP 方法为 POST 时，会先检查 content-type 是否是 json 或者 xml，如果不是，则绑定 Form 类型的参数。</p><p>所以，ShouldBind 可以绑定 Form 类型的参数，但前提是 HTTP 方法是 POST，并且 content-type 不是 application/json、application/xml。</p><p>在 Go 项目开发中，我建议使用 ShouldBindXXX，这样可以确保我们设置的 HTTP Chain（Chain 可以理解为一个 HTTP 请求的一系列处理插件）能够继续被执行。</p><h2 id="gin-是如何支持-web-服务高级功能的" tabindex="-1"><a class="header-anchor" href="#gin-是如何支持-web-服务高级功能的" aria-hidden="true">#</a> Gin 是如何支持 Web 服务高级功能的？</h2><p>上面介绍了 Web 服务的基础功能，这里我再来介绍下高级功能。Web 服务可以具备多个高级功能，但比较核心的高级功能是中间件、认证、RequestID、跨域和优雅关停。</p><h3 id="中间件" tabindex="-1"><a class="header-anchor" href="#中间件" aria-hidden="true">#</a> 中间件</h3><p>Gin 支持中间件，HTTP 请求在转发到实际的处理函数之前，会被一系列加载的中间件进行处理。在中间件中，可以解析 HTTP 请求做一些逻辑处理，例如：跨域处理或者生成 X-Request-ID 并保存在 context 中，以便追踪某个请求。处理完之后，可以选择中断并返回这次请求，也可以选择将请求继续转交给下一个中间件处理。当所有的中间件都处理完之后，请求才会转给路由函数进行处理。具体流程如下图：</p><p><img src="https://static001.geekbang.org/resource/image/f0/80/f0783cb9ee8cffa969f846ebe8eae880.jpg?wh=2248x1655" alt="img"></p><p>通过中间件，可以实现对所有请求都做统一的处理，提高开发效率，并使我们的代码更简洁。但是，因为所有的请求都需要经过中间件的处理，可能会增加请求延时。对于中间件特性，我有如下建议：</p><p>中间件做成可加载的，通过配置文件指定程序启动时加载哪些中间件。</p><p>只将一些通用的、必要的功能做成中间件。</p><p>在编写中间件时，一定要保证中间件的代码质量和性能。</p><p>在 Gin 中，可以通过 gin.Engine 的 Use 方法来加载中间件。中间件可以加载到不同的位置上，而且不同的位置作用范围也不同，例如：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token literal-property property">router</span> <span class="token operator">:</span><span class="token operator">=</span> gin<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
router<span class="token punctuation">.</span><span class="token function">Use</span><span class="token punctuation">(</span>gin<span class="token punctuation">.</span><span class="token function">Logger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> gin<span class="token punctuation">.</span><span class="token function">Recovery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 中间件作用于所有的HTTP请求</span>
<span class="token literal-property property">v1</span> <span class="token operator">:</span><span class="token operator">=</span> router<span class="token punctuation">.</span><span class="token function">Group</span><span class="token punctuation">(</span><span class="token string">&quot;/v1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Use</span><span class="token punctuation">(</span>gin<span class="token punctuation">.</span><span class="token function">BasicAuth</span><span class="token punctuation">(</span>gin<span class="token punctuation">.</span>Accounts<span class="token punctuation">{</span><span class="token string-property property">&quot;foo&quot;</span><span class="token operator">:</span> <span class="token string">&quot;bar&quot;</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;colin&quot;</span><span class="token operator">:</span> <span class="token string">&quot;colin404&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 中间件作用于v1 group</span>
v1<span class="token punctuation">.</span><span class="token constant">POST</span><span class="token punctuation">(</span><span class="token string">&quot;/login&quot;</span><span class="token punctuation">,</span> Login<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Use</span><span class="token punctuation">(</span>gin<span class="token punctuation">.</span><span class="token function">BasicAuth</span><span class="token punctuation">(</span>gin<span class="token punctuation">.</span>Accounts<span class="token punctuation">{</span><span class="token string-property property">&quot;foo&quot;</span><span class="token operator">:</span> <span class="token string">&quot;bar&quot;</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;colin&quot;</span><span class="token operator">:</span> <span class="token string">&quot;colin404&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//中间件只作用于/v1/login API接口</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Gin 框架本身支持了一些中间件。</p><ol><li><p>**gin.Logger()：**Logger 中间件会将日志写到 gin.DefaultWriter，gin.DefaultWriter 默认为 os.Stdout。</p></li><li><p>**gin.Recovery()：**Recovery 中间件可以从任何 panic 恢复，并且写入一个 500 状态码。</p></li><li><p>**gin.CustomRecovery(handle gin.RecoveryFunc)：**类似 Recovery 中间件，但是在恢复时还会调用传入的 handle 方法进行处理。</p></li><li><p>**gin.BasicAuth()：**HTTP 请求基本认证（使用用户名和密码进行认证）。</p></li></ol><p>另外，Gin 还支持自定义中间件。中间件其实是一个函数，函数类型为 gin.HandlerFunc，HandlerFunc 底层类型为 func(*Context)。如下是一个 Logger 中间件的实现：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">package</span> main
<span class="token keyword">import</span> <span class="token punctuation">(</span>
  <span class="token string">&quot;log&quot;</span>
  <span class="token string">&quot;time&quot;</span>
  <span class="token string">&quot;github.com/gin-gonic/gin&quot;</span>
<span class="token punctuation">)</span>
func <span class="token function">Logger</span><span class="token punctuation">(</span><span class="token punctuation">)</span> gin<span class="token punctuation">.</span>HandlerFunc <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token parameter">c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">t</span> <span class="token operator">:</span><span class="token operator">=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// 设置变量example</span>
    c<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">&quot;example&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;12345&quot;</span><span class="token punctuation">)</span>
    <span class="token comment">// 请求之前</span>
    c<span class="token punctuation">.</span><span class="token function">Next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// 请求之后</span>
    <span class="token literal-property property">latency</span> <span class="token operator">:</span><span class="token operator">=</span> time<span class="token punctuation">.</span><span class="token function">Since</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span>
    log<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span>latency<span class="token punctuation">)</span>
    <span class="token comment">// 访问我们发送的状态</span>
    <span class="token literal-property property">status</span> <span class="token operator">:</span><span class="token operator">=</span> c<span class="token punctuation">.</span>Writer<span class="token punctuation">.</span><span class="token function">Status</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>status<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
func <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">r</span> <span class="token operator">:</span><span class="token operator">=</span> gin<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  r<span class="token punctuation">.</span><span class="token function">Use</span><span class="token punctuation">(</span><span class="token function">Logger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  r<span class="token punctuation">.</span><span class="token constant">GET</span><span class="token punctuation">(</span><span class="token string">&quot;/test&quot;</span><span class="token punctuation">,</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token parameter">c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">example</span> <span class="token operator">:</span><span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">MustGet</span><span class="token punctuation">(</span><span class="token string">&quot;example&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span>
    <span class="token comment">// it would print: &quot;12345&quot;</span>
    log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>example<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">// Listen and serve on 0.0.0.0:8080</span>
  r<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token string">&quot;:8080&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>另外，还有很多开源的中间件可供我们选择，我把一些常用的总结在了表格里：</p><p><img src="https://static001.geekbang.org/resource/image/67/10/67137697a09d9f37bd87a81bf322f510.jpg?wh=1832x1521" alt="img"></p><h3 id="认证、requestid、跨域" tabindex="-1"><a class="header-anchor" href="#认证、requestid、跨域" aria-hidden="true">#</a> 认证、RequestID、跨域</h3><p>认证、RequestID、跨域这三个高级功能，都可以通过 Gin 的中间件来实现，例如：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token literal-property property">router</span> <span class="token operator">:</span><span class="token operator">=</span> gin<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// 认证</span>
router<span class="token punctuation">.</span><span class="token function">Use</span><span class="token punctuation">(</span>gin<span class="token punctuation">.</span><span class="token function">BasicAuth</span><span class="token punctuation">(</span>gin<span class="token punctuation">.</span>Accounts<span class="token punctuation">{</span><span class="token string-property property">&quot;foo&quot;</span><span class="token operator">:</span> <span class="token string">&quot;bar&quot;</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;colin&quot;</span><span class="token operator">:</span> <span class="token string">&quot;colin404&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// RequestID</span>
router<span class="token punctuation">.</span><span class="token function">Use</span><span class="token punctuation">(</span>requestid<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span>requestid<span class="token punctuation">.</span>Config<span class="token punctuation">{</span>
    <span class="token literal-property property">Generator</span><span class="token operator">:</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> string <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;test&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// 跨域</span>
<span class="token comment">// CORS for https://foo.com and https://github.com origins, allowing:</span>
<span class="token comment">// - PUT and PATCH methods</span>
<span class="token comment">// - Origin header</span>
<span class="token comment">// - Credentials share</span>
<span class="token comment">// - Preflight requests cached for 12 hours</span>
router<span class="token punctuation">.</span><span class="token function">Use</span><span class="token punctuation">(</span>cors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span>cors<span class="token punctuation">.</span>Config<span class="token punctuation">{</span>
    <span class="token literal-property property">AllowOrigins</span><span class="token operator">:</span>     <span class="token punctuation">[</span><span class="token punctuation">]</span>string<span class="token punctuation">{</span><span class="token string">&quot;https://foo.com&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">AllowMethods</span><span class="token operator">:</span>     <span class="token punctuation">[</span><span class="token punctuation">]</span>string<span class="token punctuation">{</span><span class="token string">&quot;PUT&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;PATCH&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">AllowHeaders</span><span class="token operator">:</span>     <span class="token punctuation">[</span><span class="token punctuation">]</span>string<span class="token punctuation">{</span><span class="token string">&quot;Origin&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">ExposeHeaders</span><span class="token operator">:</span>    <span class="token punctuation">[</span><span class="token punctuation">]</span>string<span class="token punctuation">{</span><span class="token string">&quot;Content-Length&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">AllowCredentials</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">AllowOriginFunc</span><span class="token operator">:</span> <span class="token function">func</span><span class="token punctuation">(</span>origin string<span class="token punctuation">)</span> bool <span class="token punctuation">{</span>
        <span class="token keyword">return</span> origin <span class="token operator">==</span> <span class="token string">&quot;https://github.com&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">MaxAge</span><span class="token operator">:</span> <span class="token number">12</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Hour<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="优雅关停" tabindex="-1"><a class="header-anchor" href="#优雅关停" aria-hidden="true">#</a> 优雅关停</h3><p>Go 项目上线后，我们还需要不断迭代来丰富项目功能、修复 Bug 等，这也就意味着，我们要不断地重启 Go 服务。对于 HTTP 服务来说，如果访问量大，重启服务的时候可能还有很多连接没有断开，请求没有完成。如果这时候直接关闭服务，这些连接会直接断掉，请求异常终止，这就会对用户体验和产品口碑造成很大影响。因此，这种关闭方式不是一种优雅的关闭方式。</p><p>这时候，我们期望 HTTP 服务可以在处理完所有请求后，正常地关闭这些连接，也就是优雅地关闭服务。我们有两种方法来优雅关闭 HTTP 服务，分别是借助第三方的 Go 包和自己编码实现。</p><p>方法一：借助第三方的 Go 包</p><p>如果使用第三方的 Go 包来实现优雅关闭，目前用得比较多的包是fvbock/endless。我们可以使用 fvbock/endless 来替换掉 net/http 的 ListenAndServe 方法，例如：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token literal-property property">router</span> <span class="token operator">:</span><span class="token operator">=</span> gin<span class="token punctuation">.</span><span class="token function">Default</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
router<span class="token punctuation">.</span><span class="token constant">GET</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> handler<span class="token punctuation">)</span>
<span class="token comment">// [...]</span>
endless<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span><span class="token string">&quot;:4242&quot;</span><span class="token punctuation">,</span> router<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>方法二：编码实现</p><p>借助第三方包的好处是可以稍微减少一些编码工作量，但缺点是引入了一个新的依赖包，因此我更倾向于自己编码实现。Go 1.8 版本或者更新的版本，http.Server 内置的 Shutdown 方法，已经实现了优雅关闭。下面是一个示例：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// +build go1.8</span>
<span class="token keyword">package</span> main
<span class="token keyword">import</span> <span class="token punctuation">(</span>
  <span class="token string">&quot;context&quot;</span>
  <span class="token string">&quot;log&quot;</span>
  <span class="token string">&quot;net/http&quot;</span>
  <span class="token string">&quot;os&quot;</span>
  <span class="token string">&quot;os/signal&quot;</span>
  <span class="token string">&quot;syscall&quot;</span>
  <span class="token string">&quot;time&quot;</span>
  <span class="token string">&quot;github.com/gin-gonic/gin&quot;</span>
<span class="token punctuation">)</span>
func <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">router</span> <span class="token operator">:</span><span class="token operator">=</span> gin<span class="token punctuation">.</span><span class="token function">Default</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  router<span class="token punctuation">.</span><span class="token constant">GET</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token parameter">c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">5</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span>
    c<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> <span class="token string">&quot;Welcome Gin Server&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token literal-property property">srv</span> <span class="token operator">:</span><span class="token operator">=</span> <span class="token operator">&amp;</span>http<span class="token punctuation">.</span>Server<span class="token punctuation">{</span>
    <span class="token literal-property property">Addr</span><span class="token operator">:</span>    <span class="token string">&quot;:8080&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">Handler</span><span class="token operator">:</span> router<span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// Initializing the server in a goroutine so that</span>
  <span class="token comment">// it won&#39;t block the graceful shutdown handling below</span>
  go <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token literal-property property">err</span> <span class="token operator">:</span><span class="token operator">=</span> srv<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> nil <span class="token operator">&amp;&amp;</span> err <span class="token operator">!=</span> http<span class="token punctuation">.</span>ErrServerClosed <span class="token punctuation">{</span>
      log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">&quot;listen: %s\n&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// Wait for interrupt signal to gracefully shutdown the server with</span>
  <span class="token comment">// a timeout of 5 seconds.</span>
  <span class="token literal-property property">quit</span> <span class="token operator">:</span><span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span>chan os<span class="token punctuation">.</span>Signal<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token comment">// kill (no param) default send syscall.SIGTERM</span>
  <span class="token comment">// kill -2 is syscall.SIGINT</span>
  <span class="token comment">// kill -9 is syscall.SIGKILL but can&#39;t be catch, so don&#39;t need add it</span>
  signal<span class="token punctuation">.</span><span class="token function">Notify</span><span class="token punctuation">(</span>quit<span class="token punctuation">,</span> syscall<span class="token punctuation">.</span><span class="token constant">SIGINT</span><span class="token punctuation">,</span> syscall<span class="token punctuation">.</span><span class="token constant">SIGTERM</span><span class="token punctuation">)</span>
  <span class="token operator">&lt;</span><span class="token operator">-</span>quit
  log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;Shutting down server...&quot;</span><span class="token punctuation">)</span>
  <span class="token comment">// The context is used to inform the server it has 5 seconds to finish</span>
  <span class="token comment">// the request it is currently handling</span>
  ctx<span class="token punctuation">,</span> <span class="token literal-property property">cancel</span> <span class="token operator">:</span><span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">WithTimeout</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token operator">*</span>time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span>
  defer <span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token literal-property property">err</span> <span class="token operator">:</span><span class="token operator">=</span> srv<span class="token punctuation">.</span><span class="token function">Shutdown</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> nil <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span><span class="token string">&quot;Server forced to shutdown:&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;Server exiting&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面的示例中，需要把 srv.ListenAndServe 放在 goroutine 中执行，这样才不会阻塞到 srv.Shutdown 函数。因为我们把 srv.ListenAndServe 放在了 goroutine 中，所以需要一种可以让整个进程常驻的机制。</p><p>这里，我们借助了有缓冲 channel，并且调用 signal.Notify 函数将该 channel 绑定到 SIGINT、SIGTERM 信号上。这样，收到 SIGINT、SIGTERM 信号后，quilt 通道会被写入值，从而结束阻塞状态，程序继续运行，执行 srv.Shutdown(ctx)，优雅关停 HTTP 服务。</p><h2 id="总结" tabindex="-1"><a class="header-anchor" href="#总结" aria-hidden="true">#</a> 总结</h2><p>今天我们主要学习了 Web 服务的核心功能，以及如何开发这些功能。在实际的项目开发中， 我们一般会使用基于 net/http 包进行封装的优秀开源 Web 框架。</p><p>当前比较火的 Go Web 框架有 Gin、Beego、Echo、Revel、Martini。你可以根据需要进行选择。我比较推荐 Gin，Gin 也是目前比较受欢迎的 Web 框架。Gin Web 框架支持 Web 服务的很多基础功能，例如 HTTP/HTTPS、JSON 格式的数据、路由分组和匹配、一进程多服务等。</p><p>另外，Gin 还支持 Web 服务的一些高级功能，例如 中间件、认证、RequestID、跨域和优雅关停等。</p><h2 id="课后练习" tabindex="-1"><a class="header-anchor" href="#课后练习" aria-hidden="true">#</a> 课后练习</h2><p>使用 Gin 框架编写一个简单的 Web 服务，要求该 Web 服务可以解析参数、校验参数，并进行一些简单的业务逻辑处理，最终返回处理结果。欢迎在留言区分享你的成果，或者遇到的问题。</p><p>思考下，如何给 iam-apiserver 的 /healthz 接口添加一个限流中间件，用来限制请求 /healthz 的频率。</p><p>欢迎你在留言区与我交流讨论，我们下一讲见。</p><h2 id="end-链接" tabindex="-1"><a class="header-anchor" href="#end-链接" aria-hidden="true">#</a> END 链接</h2><ul><li><div><a href="15.md" style="float:left;">⬆️上一节🔗 </a><a href="17.md" style="float:right;"> ️下一节🔗</a></div></li></ul><ul><li><p><a href="/iam/" class="">Ⓜ️回到目录🏠</a></p></li><li><p><a href="https://nsddd.top/archives/contributors" target="_blank" rel="noopener noreferrer"><strong>🫵参与贡献💞❤️‍🔥💖</strong><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>)</p></li><li><p>✴️版权声明 © ：本书所有内容遵循<a href="http://zh.wikipedia.org/wiki/Wikipedia:CC-by-sa-3.0%E5%8D%8F%E8%AE%AE%E6%96%87%E6%9C%AC" target="_blank" rel="noopener noreferrer">CC-BY-SA 3.0协议（署名-相同方式共享）©<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></li></ul></div><!--[--><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="external-link meta-item-label" href="https://github.com/3293172751/awesome-go/edit/master/docs/iam/projects/16.md" rel="noopener noreferrer" target="_blank" aria-label="在GitHub上贡献此页面"><!--[--><!--]--> 在GitHub上贡献此页面 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!----><!----></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/iam/projects/15.html" class="" aria-label="第15节 如何构建一个优秀的企业应用框架"><!--[--><!--]--> 第15节 如何构建一个优秀的企业应用框架 <!--[--><!--]--></a></span><span class="next"><a href="/iam/projects/17.html" class="" aria-label="第17节 认证机制：应用程序如何进行访问认证？"><!--[--><!--]--> 第17节 认证机制：应用程序如何进行访问认证？ <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app.df174e55.js" defer></script>
  </body>
</html>

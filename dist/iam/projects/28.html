<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.51">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="/img/1.jpg"><title>第28节 代码测试（上）：如何编写 Go 语言单元测试和性能测试用例？ | 你好</title><meta name="description" content="链学社致力于打造出区块链去中心化的学习平台">
    <link rel="modulepreload" href="/assets/app.60cd6b8c.js"><link rel="modulepreload" href="/assets/28.html.cd31bf47.js"><link rel="modulepreload" href="/assets/28.html.4b7e2a2b.js"><link rel="prefetch" href="/assets/index.html.484ac428.js"><link rel="prefetch" href="/assets/index.html.e3e54846.js"><link rel="prefetch" href="/assets/1.html.22289593.js"><link rel="prefetch" href="/assets/10.html.fcccc2ff.js"><link rel="prefetch" href="/assets/11.html.aac1a3bd.js"><link rel="prefetch" href="/assets/12.html.b371710f.js"><link rel="prefetch" href="/assets/13.html.4c3ede3b.js"><link rel="prefetch" href="/assets/14.html.a5ba315e.js"><link rel="prefetch" href="/assets/15.html.1580a958.js"><link rel="prefetch" href="/assets/16.html.a8349d9b.js"><link rel="prefetch" href="/assets/17.html.429cbcbd.js"><link rel="prefetch" href="/assets/18.html.d15c806b.js"><link rel="prefetch" href="/assets/19.html.070f0886.js"><link rel="prefetch" href="/assets/2.html.99975564.js"><link rel="prefetch" href="/assets/20.html.93b19902.js"><link rel="prefetch" href="/assets/21.html.cf7d1b5d.js"><link rel="prefetch" href="/assets/22.html.db4afbd7.js"><link rel="prefetch" href="/assets/23.html.a1e62360.js"><link rel="prefetch" href="/assets/24.html.21dea561.js"><link rel="prefetch" href="/assets/25.html.49b862c4.js"><link rel="prefetch" href="/assets/26.html.36989258.js"><link rel="prefetch" href="/assets/27.html.571b1d4e.js"><link rel="prefetch" href="/assets/29.html.251aabee.js"><link rel="prefetch" href="/assets/3.html.3f00f3d0.js"><link rel="prefetch" href="/assets/30.html.225d86b8.js"><link rel="prefetch" href="/assets/31.html.9f14dfc5.js"><link rel="prefetch" href="/assets/32.html.8ac1706b.js"><link rel="prefetch" href="/assets/33.html.1e0dfe99.js"><link rel="prefetch" href="/assets/34.html.f2444c6f.js"><link rel="prefetch" href="/assets/35.html.a4049674.js"><link rel="prefetch" href="/assets/36.html.d4fcf351.js"><link rel="prefetch" href="/assets/37.html.e29eb8b4.js"><link rel="prefetch" href="/assets/38.html.195d22cf.js"><link rel="prefetch" href="/assets/39.html.90f09380.js"><link rel="prefetch" href="/assets/4.html.be4bc5b5.js"><link rel="prefetch" href="/assets/40.html.45d7a4dc.js"><link rel="prefetch" href="/assets/41.html.e3a2ebf7.js"><link rel="prefetch" href="/assets/42.html.2d4c045c.js"><link rel="prefetch" href="/assets/43.html.647962a9.js"><link rel="prefetch" href="/assets/44.html.804b2ebc.js"><link rel="prefetch" href="/assets/45.html.ecd5924e.js"><link rel="prefetch" href="/assets/46.html.f0df9beb.js"><link rel="prefetch" href="/assets/47.html.69252181.js"><link rel="prefetch" href="/assets/48.html.8df3099d.js"><link rel="prefetch" href="/assets/49.html.bbcbb6ca.js"><link rel="prefetch" href="/assets/5.html.8fa1df64.js"><link rel="prefetch" href="/assets/50.html.88a6df7a.js"><link rel="prefetch" href="/assets/51.html.2cc2cde7.js"><link rel="prefetch" href="/assets/52.html.8f10d639.js"><link rel="prefetch" href="/assets/53.html.87d57c98.js"><link rel="prefetch" href="/assets/54.html.3c986351.js"><link rel="prefetch" href="/assets/55.html.ef79ab9d.js"><link rel="prefetch" href="/assets/56.html.47391418.js"><link rel="prefetch" href="/assets/57.html.ed714ef8.js"><link rel="prefetch" href="/assets/58.html.e45a8f1a.js"><link rel="prefetch" href="/assets/59.html.a4ef2b6b.js"><link rel="prefetch" href="/assets/6.html.ff77ac5a.js"><link rel="prefetch" href="/assets/60.html.aa3091f2.js"><link rel="prefetch" href="/assets/61.html.d34e05ef.js"><link rel="prefetch" href="/assets/62.html.73c09267.js"><link rel="prefetch" href="/assets/63.html.ee77d345.js"><link rel="prefetch" href="/assets/64.html.e6870d98.js"><link rel="prefetch" href="/assets/65.html.4803352d.js"><link rel="prefetch" href="/assets/66.html.5f7f7cf5.js"><link rel="prefetch" href="/assets/67.html.1dda677a.js"><link rel="prefetch" href="/assets/68.html.46c4b431.js"><link rel="prefetch" href="/assets/69.html.01202045.js"><link rel="prefetch" href="/assets/7.html.af5be859.js"><link rel="prefetch" href="/assets/70.html.698119d7.js"><link rel="prefetch" href="/assets/71.html.bca58bd1.js"><link rel="prefetch" href="/assets/72.html.0c495f64.js"><link rel="prefetch" href="/assets/73.html.1b1da238.js"><link rel="prefetch" href="/assets/74.html.5790a036.js"><link rel="prefetch" href="/assets/75.html.c0efadfb.js"><link rel="prefetch" href="/assets/76.html.80873dd0.js"><link rel="prefetch" href="/assets/77.html.bd454470.js"><link rel="prefetch" href="/assets/78.html.3610e426.js"><link rel="prefetch" href="/assets/79.html.a3fa3730.js"><link rel="prefetch" href="/assets/8.html.ddecb60c.js"><link rel="prefetch" href="/assets/80.html.ca6615ee.js"><link rel="prefetch" href="/assets/81.html.3ec6cf08.js"><link rel="prefetch" href="/assets/82.html.0c2a9c61.js"><link rel="prefetch" href="/assets/83.html.944f8804.js"><link rel="prefetch" href="/assets/84.html.275503f9.js"><link rel="prefetch" href="/assets/85.html.3a401355.js"><link rel="prefetch" href="/assets/86.html.09d84ac5.js"><link rel="prefetch" href="/assets/87.html.01ce4b91.js"><link rel="prefetch" href="/assets/88.html.17f7c6ee.js"><link rel="prefetch" href="/assets/89.html.564a9562.js"><link rel="prefetch" href="/assets/9.html.37eb122c.js"><link rel="prefetch" href="/assets/90.html.cf98daa9.js"><link rel="prefetch" href="/assets/91.html.43673b0c.js"><link rel="prefetch" href="/assets/92.html.4f001ff0.js"><link rel="prefetch" href="/assets/93.html.788d1091.js"><link rel="prefetch" href="/assets/94.html.99533281.js"><link rel="prefetch" href="/assets/95.html.4730f1df.js"><link rel="prefetch" href="/assets/96.html.563b0639.js"><link rel="prefetch" href="/assets/97.html.0597d140.js"><link rel="prefetch" href="/assets/98.html.2ab04005.js"><link rel="prefetch" href="/assets/99.html.4e64dae3.js"><link rel="prefetch" href="/assets/项目管理从理论到实践.html.ca35b604.js"><link rel="prefetch" href="/assets/404.html.c3e557d0.js"><link rel="prefetch" href="/assets/index.html.8e34e6b8.js"><link rel="prefetch" href="/assets/index.html.c74f844f.js"><link rel="prefetch" href="/assets/1.html.967834ee.js"><link rel="prefetch" href="/assets/10.html.0bf695e0.js"><link rel="prefetch" href="/assets/11.html.43254bdc.js"><link rel="prefetch" href="/assets/12.html.9771adb4.js"><link rel="prefetch" href="/assets/13.html.13ed8444.js"><link rel="prefetch" href="/assets/14.html.6a8b5703.js"><link rel="prefetch" href="/assets/15.html.37fe1907.js"><link rel="prefetch" href="/assets/16.html.5fe18211.js"><link rel="prefetch" href="/assets/17.html.78e1a8ca.js"><link rel="prefetch" href="/assets/18.html.b624933d.js"><link rel="prefetch" href="/assets/19.html.98c659dc.js"><link rel="prefetch" href="/assets/2.html.23e6b5c1.js"><link rel="prefetch" href="/assets/20.html.4ef88bf1.js"><link rel="prefetch" href="/assets/21.html.8de9d3ce.js"><link rel="prefetch" href="/assets/22.html.f18e5dad.js"><link rel="prefetch" href="/assets/23.html.7834d21a.js"><link rel="prefetch" href="/assets/24.html.caaf9436.js"><link rel="prefetch" href="/assets/25.html.8f9f83cb.js"><link rel="prefetch" href="/assets/26.html.7c529de3.js"><link rel="prefetch" href="/assets/27.html.f3088fab.js"><link rel="prefetch" href="/assets/29.html.fae33652.js"><link rel="prefetch" href="/assets/3.html.0659ba8d.js"><link rel="prefetch" href="/assets/30.html.ec66d95c.js"><link rel="prefetch" href="/assets/31.html.3bfcfed2.js"><link rel="prefetch" href="/assets/32.html.bf160b18.js"><link rel="prefetch" href="/assets/33.html.2ce73b8a.js"><link rel="prefetch" href="/assets/34.html.86f2dee5.js"><link rel="prefetch" href="/assets/35.html.a13aded1.js"><link rel="prefetch" href="/assets/36.html.a0a989b0.js"><link rel="prefetch" href="/assets/37.html.782b1c4a.js"><link rel="prefetch" href="/assets/38.html.f542cd8d.js"><link rel="prefetch" href="/assets/39.html.390000c6.js"><link rel="prefetch" href="/assets/4.html.992a8abd.js"><link rel="prefetch" href="/assets/40.html.24a51f10.js"><link rel="prefetch" href="/assets/41.html.469a7e9d.js"><link rel="prefetch" href="/assets/42.html.65ee7f4f.js"><link rel="prefetch" href="/assets/43.html.7eee39e5.js"><link rel="prefetch" href="/assets/44.html.0c088455.js"><link rel="prefetch" href="/assets/45.html.0301041f.js"><link rel="prefetch" href="/assets/46.html.2007b2ee.js"><link rel="prefetch" href="/assets/47.html.ae5d1bb0.js"><link rel="prefetch" href="/assets/48.html.76c48991.js"><link rel="prefetch" href="/assets/49.html.f56cf767.js"><link rel="prefetch" href="/assets/5.html.f32382e1.js"><link rel="prefetch" href="/assets/50.html.3cf679ba.js"><link rel="prefetch" href="/assets/51.html.9a52c2c5.js"><link rel="prefetch" href="/assets/52.html.b1788395.js"><link rel="prefetch" href="/assets/53.html.e113a554.js"><link rel="prefetch" href="/assets/54.html.1420d34c.js"><link rel="prefetch" href="/assets/55.html.1bec865d.js"><link rel="prefetch" href="/assets/56.html.6bc9e6db.js"><link rel="prefetch" href="/assets/57.html.4c384710.js"><link rel="prefetch" href="/assets/58.html.c856e5ca.js"><link rel="prefetch" href="/assets/59.html.759c2720.js"><link rel="prefetch" href="/assets/6.html.7ec4e08f.js"><link rel="prefetch" href="/assets/60.html.67047c78.js"><link rel="prefetch" href="/assets/61.html.7c784973.js"><link rel="prefetch" href="/assets/62.html.1fec511e.js"><link rel="prefetch" href="/assets/63.html.74bfe7a4.js"><link rel="prefetch" href="/assets/64.html.2d722ad3.js"><link rel="prefetch" href="/assets/65.html.499817d0.js"><link rel="prefetch" href="/assets/66.html.a1592299.js"><link rel="prefetch" href="/assets/67.html.b558705f.js"><link rel="prefetch" href="/assets/68.html.66025e24.js"><link rel="prefetch" href="/assets/69.html.f501ef3f.js"><link rel="prefetch" href="/assets/7.html.abb4b464.js"><link rel="prefetch" href="/assets/70.html.cb652936.js"><link rel="prefetch" href="/assets/71.html.53c60886.js"><link rel="prefetch" href="/assets/72.html.061f04cb.js"><link rel="prefetch" href="/assets/73.html.84e83a0e.js"><link rel="prefetch" href="/assets/74.html.aae6e72f.js"><link rel="prefetch" href="/assets/75.html.41427a12.js"><link rel="prefetch" href="/assets/76.html.e6b9d798.js"><link rel="prefetch" href="/assets/77.html.88f43f9a.js"><link rel="prefetch" href="/assets/78.html.c4a2c3a6.js"><link rel="prefetch" href="/assets/79.html.efb42bc2.js"><link rel="prefetch" href="/assets/8.html.8c392a77.js"><link rel="prefetch" href="/assets/80.html.f942556f.js"><link rel="prefetch" href="/assets/81.html.2c8e0bf4.js"><link rel="prefetch" href="/assets/82.html.ad777d33.js"><link rel="prefetch" href="/assets/83.html.c8aa8922.js"><link rel="prefetch" href="/assets/84.html.38a712af.js"><link rel="prefetch" href="/assets/85.html.9652a454.js"><link rel="prefetch" href="/assets/86.html.e096538e.js"><link rel="prefetch" href="/assets/87.html.b89fe274.js"><link rel="prefetch" href="/assets/88.html.2a2b625c.js"><link rel="prefetch" href="/assets/89.html.c684b629.js"><link rel="prefetch" href="/assets/9.html.6beb388d.js"><link rel="prefetch" href="/assets/90.html.653e7eaf.js"><link rel="prefetch" href="/assets/91.html.2b0985f0.js"><link rel="prefetch" href="/assets/92.html.6d119a51.js"><link rel="prefetch" href="/assets/93.html.56606dfb.js"><link rel="prefetch" href="/assets/94.html.e63903cb.js"><link rel="prefetch" href="/assets/95.html.9886a22b.js"><link rel="prefetch" href="/assets/96.html.da6ecb53.js"><link rel="prefetch" href="/assets/97.html.20bedcbe.js"><link rel="prefetch" href="/assets/98.html.68210b7c.js"><link rel="prefetch" href="/assets/99.html.d6851fb8.js"><link rel="prefetch" href="/assets/项目管理从理论到实践.html.1e4b9ece.js"><link rel="prefetch" href="/assets/404.html.d92eb549.js">
    <link rel="stylesheet" href="/assets/style.03848e77.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="切换侧边栏" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><!----><span class="site-name can-hide">你好</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="🤵关于我"><span class="title">🤵关于我</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="🤵关于我"><span class="title">🤵关于我</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a class="external-link" href="https://github.com/cubxxw/awesome-cs-cloudnative-blockchain" rel="noopener noreferrer" target="_blank" aria-label="Github仓库"><!--[--><!--]--> Github仓库 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="http://nsddd.top" rel="noopener noreferrer" target="_blank" aria-label="我的博客"><!--[--><!--]--> 我的博客 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="https://www.zhihu.com/people/3293172751" rel="noopener noreferrer" target="_blank" aria-label="知乎"><!--[--><!--]--> 知乎 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="https://github.com/kubecub/" rel="noopener noreferrer" target="_blank" aria-label="⛓️链学社组织"><!--[--><!--]--> ⛓️链学社组织 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a href="/" class="" aria-label="🏠首页"><!--[--><!--]--> 🏠首页 <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://docker.nsddd.top/" rel="noopener noreferrer" target="_blank" aria-label="🐋docker文档"><!--[--><!--]--> 🐋docker文档 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="📚go文档"><span class="title">📚go文档</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="📚go文档"><span class="title">📚go文档</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/projec/" class="" aria-label="🔥 K8s-Iam 项目"><!--[--><!--]--> 🔥 K8s-Iam 项目 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/k8s/" class="" aria-label="🔥 k8s 教程"><!--[--><!--]--> 🔥 k8s 教程 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/k8s-iam/" class="" aria-label="🔥 iam 教程"><!--[--><!--]--> 🔥 iam 教程 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/kubecub/docs" rel="noopener noreferrer" target="_blank" aria-label="查看源码"><!--[--><!--]--> 查看源码 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="切换颜色模式"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><div id="docsearch-container"></div></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="🤵关于我"><span class="title">🤵关于我</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="🤵关于我"><span class="title">🤵关于我</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a class="external-link" href="https://github.com/cubxxw/awesome-cs-cloudnative-blockchain" rel="noopener noreferrer" target="_blank" aria-label="Github仓库"><!--[--><!--]--> Github仓库 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="http://nsddd.top" rel="noopener noreferrer" target="_blank" aria-label="我的博客"><!--[--><!--]--> 我的博客 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="https://www.zhihu.com/people/3293172751" rel="noopener noreferrer" target="_blank" aria-label="知乎"><!--[--><!--]--> 知乎 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="https://github.com/kubecub/" rel="noopener noreferrer" target="_blank" aria-label="⛓️链学社组织"><!--[--><!--]--> ⛓️链学社组织 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a href="/" class="" aria-label="🏠首页"><!--[--><!--]--> 🏠首页 <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://docker.nsddd.top/" rel="noopener noreferrer" target="_blank" aria-label="🐋docker文档"><!--[--><!--]--> 🐋docker文档 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="📚go文档"><span class="title">📚go文档</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="📚go文档"><span class="title">📚go文档</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/projec/" class="" aria-label="🔥 K8s-Iam 项目"><!--[--><!--]--> 🔥 K8s-Iam 项目 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/k8s/" class="" aria-label="🔥 k8s 教程"><!--[--><!--]--> 🔥 k8s 教程 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/k8s-iam/" class="" aria-label="🔥 iam 教程"><!--[--><!--]--> 🔥 iam 教程 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/kubecub/docs" rel="noopener noreferrer" target="_blank" aria-label="查看源码"><!--[--><!--]--> 查看源码 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><a href="/" class="sidebar-item sidebar-heading" aria-label="🏠回到主页"><!--[--><!--]--> 🏠回到主页 <!--[--><!--]--></a><!----></li><li><p tabindex="0" class="sidebar-item sidebar-heading active">🔥 Go语言基础篇 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/iam/projects/1.html" class="sidebar-item" aria-label="第1节 IAM项目介绍"><!--[--><!--]--> 第1节 IAM项目介绍 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/2.html" class="sidebar-item" aria-label="第2节 IAM项目部署"><!--[--><!--]--> 第2节 IAM项目部署 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/3.html" class="sidebar-item" aria-label="第3节 设计规范"><!--[--><!--]--> 第3节 设计规范 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/4.html" class="sidebar-item" aria-label="第4节 Go语言项目设计"><!--[--><!--]--> 第4节 Go语言项目设计 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/5.html" class="sidebar-item" aria-label="第5节 设计并写出优雅的Go语言项目"><!--[--><!--]--> 第5节 设计并写出优雅的Go语言项目 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/6.html" class="sidebar-item" aria-label="第6节 API 风格设计"><!--[--><!--]--> 第6节 API 风格设计 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/7.html" class="sidebar-item" aria-label="第7节 高质量的Makefile"><!--[--><!--]--> 第7节 高质量的Makefile <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/8.html" class="sidebar-item" aria-label="第8节 IAM 项目如何进行研发流程管理"><!--[--><!--]--> 第8节 IAM 项目如何进行研发流程管理 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/9.html" class="sidebar-item" aria-label="第9节 静态代码检测"><!--[--><!--]--> 第9节 静态代码检测 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/10.html" class="sidebar-item" aria-label="第10节 如何生成 Swagger API 文档"><!--[--><!--]--> 第10节 如何生成 Swagger API 文档 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/11.html" class="sidebar-item" aria-label="第11节 设计一套科学的错误码"><!--[--><!--]--> 第11节 设计一套科学的错误码 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/12.html" class="sidebar-item" aria-label="第12节 记录和设计日志"><!--[--><!--]--> 第12节 记录和设计日志 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/13.html" class="sidebar-item" aria-label="第13节  从 0 编写一个日志包"><!--[--><!--]--> 第13节  从 0 编写一个日志包 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/14.html" class="sidebar-item" aria-label="第14节 Pflag、Viper、Cobra 核心功能介绍"><!--[--><!--]--> 第14节 Pflag、Viper、Cobra 核心功能介绍 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/15.html" class="sidebar-item" aria-label="第15节 如何构建一个优秀的企业应用框架"><!--[--><!--]--> 第15节 如何构建一个优秀的企业应用框架 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/16.html" class="sidebar-item" aria-label="第16节 Gin 框架"><!--[--><!--]--> 第16节 Gin 框架 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/17.html" class="sidebar-item" aria-label="第17节 认证机制：应用程序如何进行访问认证？"><!--[--><!--]--> 第17节 认证机制：应用程序如何进行访问认证？ <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/18.html" class="sidebar-item" aria-label="第18节 IAM 项目认证"><!--[--><!--]--> 第18节 IAM 项目认证 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/19.html" class="sidebar-item" aria-label="第19节 权限模型：5大权限模型是如何进行资源授权的？"><!--[--><!--]--> 第19节 权限模型：5大权限模型是如何进行资源授权的？ <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/20.html" class="sidebar-item" aria-label="第20节 控制流（上）：通过iam-apiserver设计，看Web服务的构建"><!--[--><!--]--> 第20节 控制流（上）：通过iam-apiserver设计，看Web服务的构建 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/21.html" class="sidebar-item" aria-label="第21节 控制流（下）：iam-apiserver服务核心功能实现讲解"><!--[--><!--]--> 第21节 控制流（下）：iam-apiserver服务核心功能实现讲解 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/22.html" class="sidebar-item" aria-label="第22节 ORM：CURD 神器 GORM 包介绍及实战"><!--[--><!--]--> 第22节 ORM：CURD 神器 GORM 包介绍及实战 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/23.html" class="sidebar-item" aria-label="第23节 数据流：通过iam-authz-server设计，看数据流服务的设计"><!--[--><!--]--> 第23节 数据流：通过iam-authz-server设计，看数据流服务的设计 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/24.html" class="sidebar-item" aria-label="第24节 数据处理：如何高效处理应用程序产生的数据？"><!--[--><!--]--> 第24节 数据处理：如何高效处理应用程序产生的数据？ <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/25.html" class="sidebar-item" aria-label="第25节  SDK 设计（上）：如何设计出一个优秀的 Go SDK？"><!--[--><!--]--> 第25节  SDK 设计（上）：如何设计出一个优秀的 Go SDK？ <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/26.html" class="sidebar-item" aria-label="第26节  SDK 设计（下）：IAM项目Go SDK设计和实现"><!--[--><!--]--> 第26节  SDK 设计（下）：IAM项目Go SDK设计和实现 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/27.html" class="sidebar-item" aria-label="第27节 效率神器：如何设计和实现一个命令行客户端工具？"><!--[--><!--]--> 第27节 效率神器：如何设计和实现一个命令行客户端工具？ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/iam/projects/28.html" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="第28节 代码测试（上）：如何编写 Go 语言单元测试和性能测试用例？"><!--[--><!--]--> 第28节 代码测试（上）：如何编写 Go 语言单元测试和性能测试用例？ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/iam/projects/28.html#开始" class="router-link-active router-link-exact-active sidebar-item" aria-label="开始"><!--[--><!--]--> 开始 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/iam/projects/28.html#如何测试-go-代码" class="router-link-active router-link-exact-active sidebar-item" aria-label="如何测试 Go 代码？"><!--[--><!--]--> 如何测试 Go 代码？ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/iam/projects/28.html#测试命名规范" class="router-link-active router-link-exact-active sidebar-item" aria-label="测试命名规范"><!--[--><!--]--> 测试命名规范 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/iam/projects/28.html#单元测试" class="router-link-active router-link-exact-active sidebar-item" aria-label="单元测试"><!--[--><!--]--> 单元测试 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/iam/projects/28.html#性能测试" class="router-link-active router-link-exact-active sidebar-item" aria-label="性能测试"><!--[--><!--]--> 性能测试 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/iam/projects/28.html#总结" class="router-link-active router-link-exact-active sidebar-item" aria-label="总结"><!--[--><!--]--> 总结 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/iam/projects/28.html#课后练习" class="router-link-active router-link-exact-active sidebar-item" aria-label="课后练习"><!--[--><!--]--> 课后练习 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/iam/projects/28.html#end-链接" class="router-link-active router-link-exact-active sidebar-item" aria-label="END 链接"><!--[--><!--]--> END 链接 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a href="/iam/projects/29.html" class="sidebar-item" aria-label="第29节 代码测试（下）：Go 语言其他测试类型及 IAM 测试介绍"><!--[--><!--]--> 第29节 代码测试（下）：Go 语言其他测试类型及 IAM 测试介绍 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/30.html" class="sidebar-item" aria-label="第30节 性能分析（上）：如何分析 Go 语言代码的性能？"><!--[--><!--]--> 第30节 性能分析（上）：如何分析 Go 语言代码的性能？ <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/31.html" class="sidebar-item" aria-label="第31节 性能分析（下）：API Server性能测试和调优实战"><!--[--><!--]--> 第31节 性能分析（下）：API Server性能测试和调优实战 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/32.html" class="sidebar-item" aria-label="第32节 软件部署实战（上）：部署方案及负载均衡、高可用组件介绍"><!--[--><!--]--> 第32节 软件部署实战（上）：部署方案及负载均衡、高可用组件介绍 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/33.html" class="sidebar-item" aria-label="第33节 软件部署实战（中）：IAM 系统生产环境部署实战"><!--[--><!--]--> 第33节 软件部署实战（中）：IAM 系统生产环境部署实战 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/34.html" class="sidebar-item" aria-label="第34节 软件部署实战（下）：IAM系统安全加固、水平扩缩容实战"><!--[--><!--]--> 第34节 软件部署实战（下）：IAM系统安全加固、水平扩缩容实战 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/35.html" class="sidebar-item" aria-label="第35节 技术演进（上）：虚拟化技术演进之路"><!--[--><!--]--> 第35节 技术演进（上）：虚拟化技术演进之路 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/36.html" class="sidebar-item" aria-label="第36节 技术演进（下）：软件架构和应用生命周期技术演进之路"><!--[--><!--]--> 第36节 技术演进（下）：软件架构和应用生命周期技术演进之路 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/37.html" class="sidebar-item" aria-label="第37节 基于Kubernetes的云原生架构设计"><!--[--><!--]--> 第37节 基于Kubernetes的云原生架构设计 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/38.html" class="sidebar-item" aria-label="第38节 如何制作Docker镜像？"><!--[--><!--]--> 第38节 如何制作Docker镜像？ <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/39.html" class="sidebar-item" aria-label="第39节 如何编写Kubernetes资源定义文件？"><!--[--><!--]--> 第39节 如何编写Kubernetes资源定义文件？ <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/40.html" class="sidebar-item" aria-label="第40节 IAM 容器化部署实战"><!--[--><!--]--> 第40节 IAM 容器化部署实战 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/41.html" class="sidebar-item" aria-label="第41节 服务编排（上）：Helm服务编排基础知识"><!--[--><!--]--> 第41节 服务编排（上）：Helm服务编排基础知识 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/42.html" class="sidebar-item" aria-label="第42节 服务编排（下）：基于Helm的服务编排部署实战"><!--[--><!--]--> 第42节 服务编排（下）：基于Helm的服务编排部署实战 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/43.html" class="sidebar-item" aria-label="第43节 基于 GitHub Actions 的 CI 实战"><!--[--><!--]--> 第43节 基于 GitHub Actions 的 CI 实战 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/44.html" class="sidebar-item" aria-label="第44节 可直接套用的 Go 编码规范"><!--[--><!--]--> 第44节 可直接套用的 Go 编码规范 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/45.html" class="sidebar-item" aria-label="第45节 Go Modules依赖包管理全讲"><!--[--><!--]--> 第45节 Go Modules依赖包管理全讲 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/46.html" class="sidebar-item" aria-label="第46节 IAM排障指南"><!--[--><!--]--> 第46节 IAM排障指南 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/47.html" class="sidebar-item" aria-label="第47节"><!--[--><!--]--> 第47节 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/48.html" class="sidebar-item" aria-label="第48节 分布式系统设计"><!--[--><!--]--> 第48节 分布式系统设计 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/49.html" class="sidebar-item" aria-label="第49节 如何从小白进阶成 Go 语言专家？"><!--[--><!--]--> 第49节 如何从小白进阶成 Go 语言专家？ <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/50.html" class="sidebar-item" aria-label="第50节"><!--[--><!--]--> 第50节 <!--[--><!--]--></a><!----></li><li><a class="external-link sidebar-item" href="https://nsddd.top/archives/contributors" rel="noopener noreferrer" target="_blank" aria-label="💝如何参与贡献？"><!--[--><!--]--> 💝如何参与贡献？ <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><ul><li><a href="https://github.com/cubxxw/iam" target="_blank" rel="noopener noreferrer">🔥 开源地址<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><h1 id="第28节-代码测试-上-如何编写-go-语言单元测试和性能测试用例" tabindex="-1"><a class="header-anchor" href="#第28节-代码测试-上-如何编写-go-语言单元测试和性能测试用例" aria-hidden="true">#</a> 第28节 代码测试（上）：如何编写 Go 语言单元测试和性能测试用例？</h1><br><div><a href="27.md" style="float:left;">⬆️上一节🔗 </a><a href="29.md" style="float:right;"> ⬇️下一节🔗</a></div><br><blockquote><p>❤️💕💕During the winter vacation, I followed up and learned two projects: tiktok project and IAM project, and summarized and practiced the CloudNative project and Go language. I learned a lot in the process.Myblog:<a href="http://nsddd.top/" target="_blank" rel="noopener noreferrer">http://nsddd.top<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></blockquote><hr><nav class="table-of-contents"><ul><li><a aria-current="page" href="/iam/projects/28.html#开始" class="router-link-active router-link-exact-active">开始</a></li><li><a aria-current="page" href="/iam/projects/28.html#如何测试-go-代码" class="router-link-active router-link-exact-active">如何测试 Go 代码？</a></li><li><a aria-current="page" href="/iam/projects/28.html#测试命名规范" class="router-link-active router-link-exact-active">测试命名规范</a><ul><li><a aria-current="page" href="/iam/projects/28.html#测试文件的命名规范" class="router-link-active router-link-exact-active">测试文件的命名规范</a></li><li><a aria-current="page" href="/iam/projects/28.html#包的命名规范" class="router-link-active router-link-exact-active">包的命名规范</a></li><li><a aria-current="page" href="/iam/projects/28.html#函数的命名规范" class="router-link-active router-link-exact-active">函数的命名规范</a></li><li><a aria-current="page" href="/iam/projects/28.html#变量的命名规范" class="router-link-active router-link-exact-active">变量的命名规范</a></li></ul></li><li><a aria-current="page" href="/iam/projects/28.html#单元测试" class="router-link-active router-link-exact-active">单元测试</a><ul><li><a aria-current="page" href="/iam/projects/28.html#多个输入的测试用例" class="router-link-active router-link-exact-active">多个输入的测试用例</a></li><li><a aria-current="page" href="/iam/projects/28.html#自动生成单元测试用例" class="router-link-active router-link-exact-active">自动生成单元测试用例</a></li></ul></li><li><a aria-current="page" href="/iam/projects/28.html#性能测试" class="router-link-active router-link-exact-active">性能测试</a></li><li><a aria-current="page" href="/iam/projects/28.html#总结" class="router-link-active router-link-exact-active">总结</a></li><li><a aria-current="page" href="/iam/projects/28.html#课后练习" class="router-link-active router-link-exact-active">课后练习</a></li><li><a aria-current="page" href="/iam/projects/28.html#end-链接" class="router-link-active router-link-exact-active">END 链接</a></li></ul></nav><p>[TOC]</p><h2 id="开始" tabindex="-1"><a class="header-anchor" href="#开始" aria-hidden="true">#</a> 开始</h2><p>你好，我是孔令飞。</p><p>从今天开始，我们就进入了服务测试模块，这一模块主要介绍如何测试我们的Go项目。</p><p>在Go项目开发中，我们不仅要开发功能，更重要的是确保这些功能稳定可靠，并且拥有一个不错的性能。要确保这些，就要对代码进行测试。开发人员通常会进行单元测试和性能测试，分别用来测试代码的功能是否正常和代码的性能是否满足需求。</p><p>每种语言通常都有自己的测试包/模块，Go语言也不例外。在Go中，我们可以通过<code>testing</code>包对代码进行单元测试和性能测试。这一讲，我会用一些示例来讲解如何编写单元测试和性能测试用例，下一讲则会介绍如何编写其他的测试类型，并介绍 IAM 项目的测试用例。</p><h2 id="如何测试-go-代码" tabindex="-1"><a class="header-anchor" href="#如何测试-go-代码" aria-hidden="true">#</a> 如何测试 Go 代码？</h2><p>Go语言有自带的测试框架<code>testing</code>，可以用来实现单元测试（T类型）和性能测试（B类型），通过<code>go test</code>命令来执行单元测试和性能测试。</p><p>go test 执行测试用例时，是以go包为单位进行测试的。执行时需要指定包名，比如<code>go test 包名</code>，如果没有指定包名，默认会选择执行命令时所在的包。go test在执行时，会遍历以<code>_test.go</code>结尾的源码文件，执行其中以<code>Test</code>、<code>Benchmark</code>、<code>Example</code>开头的测试函数。</p><p>为了演示如何编写测试用例，我预先编写了4个函数。假设这些函数保存在test目录下的<code>math.go</code>文件中，包名为<code>test</code>，math.go代码如下：</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">package</span> test

<span class="token keyword">import</span> <span class="token punctuation">(</span>
  <span class="token string">&quot;fmt&quot;</span>
  <span class="token string">&quot;math&quot;</span>
  <span class="token string">&quot;math/rand&quot;</span>
<span class="token punctuation">)</span>

<span class="token comment">// Abs returns the absolute value of x.</span>
<span class="token keyword">func</span> <span class="token function">Abs</span><span class="token punctuation">(</span>x <span class="token builtin">float64</span><span class="token punctuation">)</span> <span class="token builtin">float64</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> math<span class="token punctuation">.</span><span class="token function">Abs</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// Max returns the larger of x or y.</span>
<span class="token keyword">func</span> <span class="token function">Max</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y <span class="token builtin">float64</span><span class="token punctuation">)</span> <span class="token builtin">float64</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> math<span class="token punctuation">.</span><span class="token function">Max</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// Min returns the smaller of x or y.</span>
<span class="token keyword">func</span> <span class="token function">Min</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y <span class="token builtin">float64</span><span class="token punctuation">)</span> <span class="token builtin">float64</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> math<span class="token punctuation">.</span><span class="token function">Min</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// RandInt returns a non-negative pseudo-random int from the default Source.</span>
<span class="token keyword">func</span> <span class="token function">RandInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> rand<span class="token punctuation">.</span><span class="token function">Int</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这一讲后面的内容中，我会演示如何编写测试用例，来对这些函数进行单元测试和性能测试。下面让我们先来看下测试命名规范。</p><h2 id="测试命名规范" tabindex="-1"><a class="header-anchor" href="#测试命名规范" aria-hidden="true">#</a> 测试命名规范</h2><p>在我们对Go代码进行测试时，需要编写测试文件、测试函数、测试变量，它们都需要遵循一定的规范。这些规范有些来自于官方，有些则来自于社区。这里，我分别来介绍下测试文件、包、测试函数和测试变量的命名规范。</p><h3 id="测试文件的命名规范" tabindex="-1"><a class="header-anchor" href="#测试文件的命名规范" aria-hidden="true">#</a> 测试文件的命名规范</h3><p>Go的测试文件名必须以<code>_test.go</code>结尾。例如，如果我们有一个名为<code>person.go</code>的文件，那它的测试文件必须命名为<code>person_test.go</code>。这样做是因为，Go需要区分哪些文件是测试文件。这些测试文件可以被go test命令行工具加载，用来测试我们编写的代码，但会被Go的构建程序忽略掉，因为Go程序的运行不需要这些测试代码。</p><h3 id="包的命名规范" tabindex="-1"><a class="header-anchor" href="#包的命名规范" aria-hidden="true">#</a> 包的命名规范</h3><p>Go的测试可以分为白盒测试和黑盒测试。</p><ul><li>**白盒测试：**将测试和生产代码放在同一个Go包中，这使我们可以同时测试Go包中可导出和不可导出的标识符。当我们编写的单元测试需要访问Go包中不可导出的变量、函数和方法时，就需要编写白盒测试用例。</li><li>**黑盒测试：**将测试和生产代码放在不同的Go包中。这时，我们仅可以测试Go包的可导出标识符。这意味着我们的测试包将无法访问生产代码中的任何内部函数、变量或常量。</li></ul><p>在白盒测试中，Go的测试包名称需要跟被测试的包名保持一致，例如：<code>person.go</code>定义了一个<code>person</code>包，则<code>person_test.go</code>的包名也要为<code>person</code>，这也意味着<code>person.go</code>和<code>person_test.go</code>都要在同一个目录中。</p><p>在黑盒测试中，Go的测试包名称需要跟被测试的包名不同，但仍然可以存放在同一个目录下。比如，<code>person.go</code>定义了一个<code>person</code>包，则<code>person_test.go</code>的包名需要跟<code>person</code>不同，通常我们命名为<code>person_test</code>。</p><p>如果不是需要使用黑盒测试，我们在做单元测试时要尽量使用白盒测试。一方面，这是go test工具的默认行为；另一方面，使用白盒测试，我们可以测试和使用不可导出的标识符。</p><p>测试文件和包的命名规范，由Go语言及go test工具来强制约束。</p><h3 id="函数的命名规范" tabindex="-1"><a class="header-anchor" href="#函数的命名规范" aria-hidden="true">#</a> 函数的命名规范</h3><p>测试用例函数必须以<code>Test</code>、<code>Benchmark</code>、<code>Example</code>开头，例如<code>TestXxx</code>、<code>BenchmarkXxx</code>、<code>ExampleXxx</code>，<code>Xxx</code>部分为任意字母数字的组合，首字母大写。这是由Go语言和go test工具来进行约束的，<code>Xxx</code>一般是需要测试的函数名。</p><p>除此之外，还有一些社区的约束，这些约束不是强制的，但是遵循这些约束会让我们的测试函数名更加易懂。例如，我们有以下函数：</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">type</span> Person <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  age  <span class="token builtin">int64</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>p <span class="token operator">*</span>Person<span class="token punctuation">)</span> <span class="token function">older</span><span class="token punctuation">(</span>other <span class="token operator">*</span>Person<span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> p<span class="token punctuation">.</span>age <span class="token operator">&gt;</span> other<span class="token punctuation">.</span>age
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>很显然，我们可以把测试函数命名为<code>TestOlder</code>，这个名称可以很清晰地说明它是<code>Older</code>函数的测试用例。但是，如果我们想用多个测试用例来测试<code>TestOlder</code>函数，这些测试用例该如何命名呢？也许你会说，我们命名为<code>TestOlder1</code>、<code>TestOlder2</code>不就行了？</p><p>其实，还有其他更好的命名方法。比如，这种情况下，我们可以将函数命名为<code>TestOlderXxx</code>，其中<code>Xxx</code>代表<code>Older</code>函数的某个场景描述。例如，<code>strings.Compare</code>函数有如下测试函数：<code>TestCompare</code>、<code>TestCompareIdenticalString</code>、<code>TestCompareStrings</code>。</p><h3 id="变量的命名规范" tabindex="-1"><a class="header-anchor" href="#变量的命名规范" aria-hidden="true">#</a> 变量的命名规范</h3><p>Go语言和go test没有对变量的命名做任何约束。但是，在编写单元测试用例时，还是有一些规范值得我们去遵守。</p><p>单元测试用例通常会有一个实际的输出，在单元测试中，我们会将预期的输出跟实际的输出进行对比，来判断单元测试是否通过。为了清晰地表达函数的实际输出和预期输出，可以将这两类输出命名为<code>expected/actual</code>，或者<code>got/want</code>。例如：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token keyword">if</span> c.expected <span class="token operator">!=</span> actual <span class="token punctuation">{</span>
  t.Fatalf<span class="token punctuation">(</span><span class="token string">&quot;Expected User-Agent &#39;%s&#39; does not match &#39;%s&#39;&quot;</span>, c.expected, actual<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>或者：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token keyword">if</span> got, want :<span class="token operator">=</span> diags<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>.Description<span class="token punctuation">(</span><span class="token punctuation">)</span>.Summary, undeclPlural<span class="token punctuation">;</span> got <span class="token operator">!=</span> want <span class="token punctuation">{</span>
  t.Errorf<span class="token punctuation">(</span><span class="token string">&quot;wrong summary for diagnostic 3<span class="token entity" title="\n">\n</span>got:  %s<span class="token entity" title="\n">\n</span>want: %s&quot;</span>, got, want<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其他的变量命名，我们可以遵循Go语言推荐的变量命名方法，例如：</p><ul><li>Go中的变量名应该短而不是长，对于范围有限的局部变量来说尤其如此。</li><li>变量离声明越远，对名称的描述性要求越高。</li><li>像循环、索引之类的变量，名称可以是单个字母（i）。如果是不常见的变量和全局变量，变量名就需要具有更多的描述性。</li></ul><p>上面，我介绍了Go测试的一些基础知识。接下来，我们来看看如何编写单元测试用例和性能测试用例。</p><h2 id="单元测试" tabindex="-1"><a class="header-anchor" href="#单元测试" aria-hidden="true">#</a> 单元测试</h2><p>单元测试用例函数以 <code>Test</code> 开头，例如 <code>TestXxx</code> 或 <code>Test_xxx</code> （ <code>Xxx</code> 部分为任意字母数字组合，首字母大写）。函数参数必须是 <code>\*testing.T\*</code>，可以使用该类型来记录错误或测试状态。</p><p><strong>我们可以调用 <code>testing.T</code> 的 <code>Error</code> 、<code>Errorf</code> 、<code>FailNow</code> 、<code>Fatal</code> 、<code>FatalIf</code> 方法，来说明测试不通过；调用 <code>Log</code> 、<code>Logf</code> 方法来记录测试信息。函数列表和相关描述如下表所示：</strong></p><p><img src="http://sm.nsddd.top/sm202303051034819.jpeg" alt="图片"></p><p><strong>下面的代码是两个简单的单元测试函数（函数位于文件<a href="https://github.com/marmotedu/gopractise-demo" target="_blank" rel="noopener noreferrer">math_test.go<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>中）：</strong></p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">TestAbs</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    got <span class="token operator">:=</span> <span class="token function">Abs</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> got <span class="token operator">!=</span> <span class="token number">1</span> <span class="token punctuation">{</span>
        t<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;Abs(-1) = %f; want 1&quot;</span><span class="token punctuation">,</span> got<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">TestMax</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    got <span class="token operator">:=</span> <span class="token function">Max</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> got <span class="token operator">!=</span> <span class="token number">2</span> <span class="token punctuation">{</span>
        t<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;Max(1, 2) = %f; want 2&quot;</span><span class="token punctuation">,</span> got<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>执行<code>go test</code>命令来执行如上单元测试用例：</strong></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>$ go test
PASS
ok      github.com/marmotedu/gopractise-demo/31/test    0.002s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>**<code>go test</code>命令自动搜集所有的测试文件，也就是格式为``*<code>_test.go</code>的文件，<strong>从中提取全部测试函数并执行</strong>。 **</p><p><strong>go test还支持下面三个参数。</strong></p><ul><li><strong>-v，显示所有测试函数的运行细节：</strong></li></ul><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>$ go test -v
=== RUN   TestAbs
--- PASS: TestAbs (0.00s)
=== RUN   TestMax
--- PASS: TestMax (0.00s)
PASS
ok      github.com/marmotedu/gopractise-demo/31/test    0.002s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>-run &lt; regexp&gt;，指定要执行的测试函数：</strong></li></ul><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>$ <span class="token keyword">go</span> test <span class="token operator">-</span>v <span class="token operator">-</span>run<span class="token operator">=</span><span class="token char">&#39;TestA.*&#39;</span>
<span class="token operator">==</span><span class="token operator">=</span> RUN   TestAbs
<span class="token operator">--</span><span class="token operator">-</span> PASS<span class="token punctuation">:</span> TestAbs <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">.</span>00s<span class="token punctuation">)</span>
PASS
ok      github<span class="token punctuation">.</span>com<span class="token operator">/</span>marmotedu<span class="token operator">/</span>gopractise<span class="token operator">-</span>demo<span class="token operator">/</span><span class="token number">31</span><span class="token operator">/</span>test    <span class="token number">0</span><span class="token punctuation">.</span>001s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面的例子中，我们只运行了以<code>TestA</code>开头的测试函数。</p><ul><li><em>-count N，指定执行测试函数的次数：</em></li></ul><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>$ <span class="token keyword">go</span> test <span class="token operator">-</span>v <span class="token operator">-</span>run<span class="token operator">=</span><span class="token char">&#39;TestA.*&#39;</span> <span class="token operator">-</span>count<span class="token operator">=</span><span class="token number">2</span>
<span class="token operator">==</span><span class="token operator">=</span> RUN   TestAbs
<span class="token operator">--</span><span class="token operator">-</span> PASS<span class="token punctuation">:</span> TestAbs <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">.</span>00s<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token operator">=</span> RUN   TestAbs
<span class="token operator">--</span><span class="token operator">-</span> PASS<span class="token punctuation">:</span> TestAbs <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">.</span>00s<span class="token punctuation">)</span>
PASS
ok      github<span class="token punctuation">.</span>com<span class="token operator">/</span>marmotedu<span class="token operator">/</span>gopractise<span class="token operator">-</span>demo<span class="token operator">/</span><span class="token number">31</span><span class="token operator">/</span>test    <span class="token number">0</span><span class="token punctuation">.</span>002s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="多个输入的测试用例" tabindex="-1"><a class="header-anchor" href="#多个输入的测试用例" aria-hidden="true">#</a> 多个输入的测试用例</h3><p>前面介绍的单元测试用例只有一个输入，但是很多时候，我们需要测试一个函数在多种不同输入下是否能正常返回。这时候，我们可以编写一个稍微复杂点的测试用例，用来支持多输入下的用例测试。例如，我们可以将<code>TestAbs</code>改造成如下函数：</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">TestAbs_2</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    tests <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">struct</span> <span class="token punctuation">{</span>
        x    <span class="token builtin">float64</span>
        want <span class="token builtin">float64</span>
    <span class="token punctuation">}</span><span class="token punctuation">{</span>
        <span class="token punctuation">{</span><span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token number">0.3</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token operator">-</span><span class="token number">3.1</span><span class="token punctuation">,</span> <span class="token number">3.1</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> tt <span class="token operator">:=</span> <span class="token keyword">range</span> tests <span class="token punctuation">{</span>
        <span class="token keyword">if</span> got <span class="token operator">:=</span> <span class="token function">Abs</span><span class="token punctuation">(</span>tt<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span> got <span class="token operator">!=</span> tt<span class="token punctuation">.</span>want <span class="token punctuation">{</span>
            t<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;Abs() = %f, want %v&quot;</span><span class="token punctuation">,</span> got<span class="token punctuation">,</span> tt<span class="token punctuation">.</span>want<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上述测试用例函数中，我们定义了一个结构体数组，数组中的每一个元素代表一次测试用例。数组元素的的值包含输入和预期的返回值：</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>tests <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">struct</span> <span class="token punctuation">{</span>
    x    <span class="token builtin">float64</span>
    want <span class="token builtin">float64</span>
<span class="token punctuation">}</span><span class="token punctuation">{</span>
    <span class="token punctuation">{</span><span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token number">0.3</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token operator">-</span><span class="token number">3.1</span><span class="token punctuation">,</span> <span class="token number">3.1</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上述测试用例，将被测函数放在for循环中执行：</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>
   <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> tt <span class="token operator">:=</span> <span class="token keyword">range</span> tests <span class="token punctuation">{</span>
        <span class="token keyword">if</span> got <span class="token operator">:=</span> <span class="token function">Abs</span><span class="token punctuation">(</span>tt<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span> got <span class="token operator">!=</span> tt<span class="token punctuation">.</span>want <span class="token punctuation">{</span>
            t<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;Abs() = %f, want %v&quot;</span><span class="token punctuation">,</span> got<span class="token punctuation">,</span> tt<span class="token punctuation">.</span>want<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面的代码将输入传递给被测函数，并将被测函数的返回值跟预期的返回值进行比较。如果相等，则说明此次测试通过，如果不相等则说明此次测试不通过。通过这种方式，我们就可以在一个测试用例中，测试不同的输入和输出，也就是不同的测试用例。如果要新增一个测试用例，根据需要添加输入和预期的返回值就可以了，这些测试用例都共享其余的测试代码。</p><p>上面的测试用例中，我们通过<code>got != tt.want</code>来对比实际返回结果和预期返回结果。我们也可以使用<code>github.com/stretchr/testify/assert</code>包中提供的函数来做结果对比，例如：</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">TestAbs_3</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    tests <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">struct</span> <span class="token punctuation">{</span>
        x    <span class="token builtin">float64</span>
        want <span class="token builtin">float64</span>
    <span class="token punctuation">}</span><span class="token punctuation">{</span>
        <span class="token punctuation">{</span><span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token number">0.3</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token operator">-</span><span class="token number">3.1</span><span class="token punctuation">,</span> <span class="token number">3.1</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> tt <span class="token operator">:=</span> <span class="token keyword">range</span> tests <span class="token punctuation">{</span>
        got <span class="token operator">:=</span> <span class="token function">Abs</span><span class="token punctuation">(</span>tt<span class="token punctuation">.</span>x<span class="token punctuation">)</span>
        assert<span class="token punctuation">.</span><span class="token function">Equal</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> got<span class="token punctuation">,</span> tt<span class="token punctuation">.</span>want<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>使用<code>assert</code>来对比结果，有下面这些好处：</p><ul><li>友好的输出结果，易于阅读。</li><li>因为少了<code>if got := Xxx(); got != tt.wang {}</code>的判断，代码变得更加简洁。</li><li>可以针对每次断言，添加额外的消息说明，例如<code>assert.Equal(t, got, tt.want, &quot;Abs test&quot;)</code>。</li></ul><p>assert包还提供了很多其他函数，供开发者进行结果对比，例如<code>Zero</code>、<code>NotZero</code>、<code>Equal</code>、<code>NotEqual</code>、<code>Less</code>、<code>True</code>、<code>Nil</code>、<code>NotNil</code>等。如果想了解更多函数，你可以参考<code>go doc github.com/stretchr/testify/assert</code>。</p><h3 id="自动生成单元测试用例" tabindex="-1"><a class="header-anchor" href="#自动生成单元测试用例" aria-hidden="true">#</a> 自动生成单元测试用例</h3><p>通过上面的学习，你也许可以发现，测试用例其实可以抽象成下面的模型：</p><p><img src="http://sm.nsddd.top/sm202303051037196.jpeg" alt="图片"></p><p><strong>用代码可表示为：</strong></p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">TestXxx</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">type</span> args <span class="token keyword">struct</span> <span class="token punctuation">{</span>
        <span class="token comment">// TODO: Add function input parameter definition.</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">type</span> want <span class="token keyword">struct</span> <span class="token punctuation">{</span>
         <span class="token comment">// TODO: Add function return parameter definition.</span>
    <span class="token punctuation">}</span>
    tests <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">struct</span> <span class="token punctuation">{</span>
        name <span class="token builtin">string</span>
        args args
        want want
    <span class="token punctuation">}</span><span class="token punctuation">{</span>
        <span class="token comment">// TODO: Add test cases.</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> tt <span class="token operator">:=</span> <span class="token keyword">range</span> tests <span class="token punctuation">{</span>
        t<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span>tt<span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> got <span class="token operator">:=</span> <span class="token function">Xxx</span><span class="token punctuation">(</span>tt<span class="token punctuation">.</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span> got <span class="token operator">!=</span> tt<span class="token punctuation">.</span>want <span class="token punctuation">{</span>
                t<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;Xxx() = %v, want %v&quot;</span><span class="token punctuation">,</span> got<span class="token punctuation">,</span> tt<span class="token punctuation">.</span>want<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token function">TestXxx</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">type</span> args <span class="token keyword">struct</span> <span class="token punctuation">{</span>
        <span class="token comment">// TODO: Add function input parameter definition.</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">type</span> want <span class="token keyword">struct</span> <span class="token punctuation">{</span>
         <span class="token comment">// TODO: Add function return parameter definition.</span>
    <span class="token punctuation">}</span>
    tests <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">struct</span> <span class="token punctuation">{</span>
        name <span class="token builtin">string</span>
        args args
        want want
    <span class="token punctuation">}</span><span class="token punctuation">{</span>
        <span class="token comment">// TODO: Add test cases.</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> tt <span class="token operator">:=</span> <span class="token keyword">range</span> tests <span class="token punctuation">{</span>
        t<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span>tt<span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> got <span class="token operator">:=</span> <span class="token function">Xxx</span><span class="token punctuation">(</span>tt<span class="token punctuation">.</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span> got <span class="token operator">!=</span> tt<span class="token punctuation">.</span>want <span class="token punctuation">{</span>
                t<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;Xxx() = %v, want %v&quot;</span><span class="token punctuation">,</span> got<span class="token punctuation">,</span> tt<span class="token punctuation">.</span>want<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>既然测试用例可以抽象成一些模型，那么我们就可以基于这些模型来自动生成测试代码。Go社区中有一些优秀的工具可以自动生成测试代码，我推荐你使用<a href="https://github.com/cweill/gotests" target="_blank" rel="noopener noreferrer">gotests<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>工具。</p><p>下面，我来讲讲gotests工具的使用方法，可以分成三个步骤。</p><p>第一步，安装gotests工具：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ go get <span class="token parameter variable">-u</span> github.com/cweill/gotests/<span class="token punctuation">..</span>.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>gotests命令执行格式为：<code>gotests [options] [PATH] [FILE] ...</code>。gotests可以为<code>PATH</code>下的所有Go源码文件中的函数生成测试代码，也可以只为某个<code>FILE</code>中的函数生成测试代码。</p><p>第二步，进入测试代码目录，执行gotests生成测试用例：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ gotests <span class="token parameter variable">-all</span> <span class="token parameter variable">-w</span> <span class="token builtin class-name">.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>上面的命令会为当前目录下所有Go源码文件中的函数生成测试代码。</p><p>第三步，添加测试用例：</p><p>生成完测试用例，你只需要添加需要测试的输入和预期的输出就可以了。下面的测试用例是通过gotests生成的：</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">TestUnpointer</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">type</span> args <span class="token keyword">struct</span> <span class="token punctuation">{</span>
        offset <span class="token operator">*</span><span class="token builtin">int64</span>
        limit  <span class="token operator">*</span><span class="token builtin">int64</span>
    <span class="token punctuation">}</span>
    tests <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">struct</span> <span class="token punctuation">{</span>
        name <span class="token builtin">string</span>
        args args
        want <span class="token operator">*</span>LimitAndOffset
    <span class="token punctuation">}</span><span class="token punctuation">{</span>
        <span class="token comment">// TODO: Add test cases.</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> tt <span class="token operator">:=</span> <span class="token keyword">range</span> tests <span class="token punctuation">{</span>
        t<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span>tt<span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> got <span class="token operator">:=</span> <span class="token function">Unpointer</span><span class="token punctuation">(</span>tt<span class="token punctuation">.</span>args<span class="token punctuation">.</span>offset<span class="token punctuation">,</span> tt<span class="token punctuation">.</span>args<span class="token punctuation">.</span>limit<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">!</span>reflect<span class="token punctuation">.</span><span class="token function">DeepEqual</span><span class="token punctuation">(</span>got<span class="token punctuation">,</span> tt<span class="token punctuation">.</span>want<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                t<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;Unpointer() = %v, want %v&quot;</span><span class="token punctuation">,</span> got<span class="token punctuation">,</span> tt<span class="token punctuation">.</span>want<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><em>我们只需要补全<code>TODO</code>位置的测试数据即可，补全后的测试用例见<a href="https://github.com/marmotedu/iam/blob/v1.0.8/internal/pkg/util/gormutil/gorm_test.go" target="_blank" rel="noopener noreferrer">gorm_test.go<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>文件。</em></p><h2 id="性能测试" tabindex="-1"><a class="header-anchor" href="#性能测试" aria-hidden="true">#</a> 性能测试</h2><p>上面，我讲了用来测试代码的功能是否正常的单元测试，接下来我们来看下性能测试，它是用来测试代码的性能是否满足需求的。</p><p>性能测试的用例函数必须以<code>Benchmark</code>开头，例如<code>BenchmarkXxx</code>或<code>Benchmark_Xxx</code>（ <code>Xxx</code> 部分为任意字母数字组合，首字母大写）。</p><p>函数参数必须是<code>\*testing.B\*</code>，函数内以<code>b.N</code>作为循环次数，其中<code>N</code>会在运行时动态调整，直到性能测试函数可以持续足够长的时间，以便能够可靠地计时。下面的代码是一个简单的性能测试函数（函数位于文件<a href="https://github.com/marmotedu/gopractise-demo/blob/master/test/math_test.go" target="_blank" rel="noopener noreferrer">math_test.go<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>中）：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>func BenchmarkRandInt(b *testing.B) {
    for i := 0; i &lt; b.N; i++ {
        RandInt()
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>go test</code>命令默认不会执行性能测试函数，需要通过指定参数<code>-bench &lt;pattern&gt;</code>来运行性能测试函数。<code>-bench</code>后可以跟正则表达式，选择需要执行的性能测试函数，例如<code>go test -bench=&quot;.*&quot;</code>表示执行所有的压力测试函数。执行<code>go test -bench=&quot;.</code>*<code>&quot;</code>后输出如下：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ go <span class="token builtin class-name">test</span> <span class="token parameter variable">-bench</span><span class="token operator">=</span><span class="token string">&quot;.*&quot;</span>
goos: linux
goarch: amd64
pkg: github.com/marmotedu/gopractise-demo/31/test
BenchmarkRandInt-4      <span class="token number">97384827</span>                <span class="token number">12.4</span> ns/op
PASS
ok      github.com/marmotedu/gopractise-demo/31/test    <span class="token number">1</span>.223s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面的结果只显示了性能测试函数的执行结果。<code>BenchmarkRandInt</code>性能测试函数的执行结果如下：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>BenchmarkRandInt-4   	<span class="token number">90848414</span>	        <span class="token number">12.8</span> ns/op
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>每个函数的性能执行结果一共有3列，分别代表不同的意思，这里用上面的函数举例子：</p><ul><li><code>BenchmarkRandInt-4</code>，<code>BenchmarkRandInt</code>表示所测试的测试函数名，4表示有4个CPU线程参与了此次测试，默认是<code>GOMAXPROCS</code>的值。</li><li><code>90848414</code> ，说明函数中的循环执行了<code>90848414</code>次。</li><li><code>12.8 ns/op</code>，说明每次循环的执行平均耗时是 <code>12.8</code> 纳秒，该值越小，说明代码性能越高。</li></ul><p>如果我们的性能测试函数在执行循环前，需要做一些耗时的准备工作，我们就需要重置性能测试时间计数，例如：</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">BenchmarkBigLen</span><span class="token punctuation">(</span>b <span class="token operator">*</span>testing<span class="token punctuation">.</span>B<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    big <span class="token operator">:=</span> <span class="token function">NewBig</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    b<span class="token punctuation">.</span><span class="token function">ResetTimer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> b<span class="token punctuation">.</span>N<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
        big<span class="token punctuation">.</span><span class="token function">Len</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>当然，我们也可以先停止性能测试的时间计数，然后再开始时间计数，例如：</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">BenchmarkBigLen</span><span class="token punctuation">(</span>b <span class="token operator">*</span>testing<span class="token punctuation">.</span>B<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  b<span class="token punctuation">.</span><span class="token function">StopTimer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 调用该函数停止压力测试的时间计数</span>
  big <span class="token operator">:=</span> <span class="token function">NewBig</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  b<span class="token punctuation">.</span><span class="token function">StartTimer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 重新开始时间</span>
  <span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> b<span class="token punctuation">.</span>N<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
    big<span class="token punctuation">.</span><span class="token function">Len</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>B类型的性能测试还支持下面 4 个参数。</p><ul><li>benchmem，输出内存分配统计：</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ go <span class="token builtin class-name">test</span> <span class="token parameter variable">-bench</span><span class="token operator">=</span><span class="token string">&quot;.*&quot;</span> <span class="token parameter variable">-benchmem</span>
goos: linux
goarch: amd64
pkg: github.com/marmotedu/gopractise-demo/31/test
BenchmarkRandInt-4      <span class="token number">96776823</span>                <span class="token number">12.8</span> ns/op             <span class="token number">0</span> B/op          <span class="token number">0</span> allocs/op
PASS
ok      github.com/marmotedu/gopractise-demo/31/test    <span class="token number">1</span>.255s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>指定了<code>-benchmem</code>参数后，执行结果中又多了两列： 0 B/op，表示每次执行分配了多少内存（字节），该值越小，说明代码内存占用越小；0 allocs/op，表示每次执行分配了多少次内存，该值越小，说明分配内存次数越少，意味着代码性能越高。</p><ul><li>benchtime，指定测试时间和循环执行次数（格式需要为Nx，例如100x）：</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ go <span class="token builtin class-name">test</span> <span class="token parameter variable">-bench</span><span class="token operator">=</span><span class="token string">&quot;.*&quot;</span> <span class="token parameter variable">-benchtime</span><span class="token operator">=</span>10s <span class="token comment"># 指定测试时间</span>
goos: linux
goarch: amd64
pkg: github.com/marmotedu/gopractise-demo/31/test
BenchmarkRandInt-4      <span class="token number">910328618</span>               <span class="token number">13.1</span> ns/op
PASS
ok      github.com/marmotedu/gopractise-demo/31/test    <span class="token number">13</span>.260s
$ go <span class="token builtin class-name">test</span> <span class="token parameter variable">-bench</span><span class="token operator">=</span><span class="token string">&quot;.*&quot;</span> <span class="token parameter variable">-benchtime</span><span class="token operator">=</span>100x <span class="token comment"># 指定循环执行次数</span>
goos: linux
goarch: amd64
pkg: github.com/marmotedu/gopractise-demo/31/test
BenchmarkRandInt-4           <span class="token number">100</span>                <span class="token number">16.9</span> ns/op
PASS
ok      github.com/marmotedu/gopractise-demo/31/test    <span class="token number">0</span>.003s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>cpu，指定GOMAXPROCS。</li><li>timeout，指定测试函数执行的超时时间：</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ go <span class="token builtin class-name">test</span> <span class="token parameter variable">-bench</span><span class="token operator">=</span><span class="token string">&quot;.*&quot;</span> <span class="token parameter variable">-timeout</span><span class="token operator">=</span>10s
goos: linux
goarch: amd64
pkg: github.com/marmotedu/gopractise-demo/31/test
BenchmarkRandInt-4      <span class="token number">97375881</span>                <span class="token number">12.4</span> ns/op
PASS
ok      github.com/marmotedu/gopractise-demo/31/test    <span class="token number">1</span>.224s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="总结" tabindex="-1"><a class="header-anchor" href="#总结" aria-hidden="true">#</a> 总结</h2><p>代码开发完成之后，我们需要为代码编写单元测试用例，并根据需要，给一些函数编写性能测试用例。Go语言提供了 <code>testing</code> 包，供我们编写测试用例，并通过 <code>go test</code> 命令来执行这些测试用例。</p><p>go test在执行测试用例时，会查找具有固定格式的Go源码文件名，并执行其中具有固定格式的函数，这些函数就是测试用例。这就要求我们的测试文件名、函数名要符合 <code>go test</code> 工具的要求：Go的测试文件名必须以 <code>_test.go</code> 结尾；测试用例函数必须以 <code>Test</code> 、 <code>Benchmark</code> 、 <code>Example</code> 开头。此外，我们在编写测试用例时，还要注意包和变量的命名规范。</p><p>Go项目开发中，编写得最多的是单元测试用例。单元测试用例函数以 <code>Test</code> 开头，例如 <code>TestXxx</code> 或 <code>Test_xxx</code> （<code>Xxx</code> 部分为任意字母数字组合，首字母大写）。函数参数必须是 <code>*testing.T</code> ，可以使用该类型来记录错误或测试状态。我们可以调用 <code>testing.T</code> 的 <code>Error</code> 、<code>Errorf</code> 、<code>FailNow</code> 、<code>Fatal</code> 、<code>FatalIf</code> 方法，来说明测试不通过；调用 <code>Log</code> 、<code>Logf</code> 方法来记录测试信息。</p><p>下面是一个简单的单元测试函数：</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">TestAbs</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    got <span class="token operator">:=</span> <span class="token function">Abs</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> got <span class="token operator">!=</span> <span class="token number">1</span> <span class="token punctuation">{</span>
        t<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;Abs(-1) = %f; want 1&quot;</span><span class="token punctuation">,</span> got<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>编写完测试用例之后，可以使用 <code>go test</code> 命令行工具来执行这些测试用例。 此外，我们还可以使用<a href="https://github.com/cweill/gotests" target="_blank" rel="noopener noreferrer">gotests<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>工具，来自动地生成单元测试用例，从而减少编写测试用例的工作量。</p><p>我们在Go项目开发中，还经常需要编写性能测试用例。性能测试用例函数必须以<code>Benchmark</code>开头，以<code>*testing.B</code> 作为函数入参，通过 <code>go test -bench &lt;pattern&gt;</code> 运行。</p><h2 id="课后练习" tabindex="-1"><a class="header-anchor" href="#课后练习" aria-hidden="true">#</a> 课后练习</h2><ol><li>编写一个 <code>PrintHello</code> 函数，该函数会返回 <code>Hello World</code> 字符串，并编写单元测试用例，对 <code>PrintHello</code> 函数进行测试。</li><li>思考一下，哪些场景下采用白盒测试，哪些场景下采用黑盒测试？</li></ol><h2 id="end-链接" tabindex="-1"><a class="header-anchor" href="#end-链接" aria-hidden="true">#</a> END 链接</h2><ul><li><div><a href="27.md" style="float:left;">⬆️上一节🔗 </a><a href="29.md" style="float:right;"> ️下一节🔗</a></div></li></ul><ul><li><p><a href="/iam/" class="">Ⓜ️回到目录🏠</a></p></li><li><p><a href="https://nsddd.top/archives/contributors" target="_blank" rel="noopener noreferrer"><strong>🫵参与贡献💞❤️‍🔥💖</strong><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>)</p></li><li><p>✴️版权声明 © ：本书所有内容遵循<a href="http://zh.wikipedia.org/wiki/Wikipedia:CC-by-sa-3.0%E5%8D%8F%E8%AE%AE%E6%96%87%E6%9C%AC" target="_blank" rel="noopener noreferrer">CC-BY-SA 3.0协议（署名-相同方式共享）©<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></li></ul></div><!--[--><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="external-link meta-item-label" href="https://github.com/kubecub/docs/edit/master/docs/iam/projects/28.md" rel="noopener noreferrer" target="_blank" aria-label="在GitHub上贡献此页面"><!--[--><!--]--> 在GitHub上贡献此页面 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">上次更新: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">贡献者: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 3293172751nss@gmail.com">Xinwei Xiong</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/iam/projects/27.html" class="" aria-label="第27节 效率神器：如何设计和实现一个命令行客户端工具？"><!--[--><!--]--> 第27节 效率神器：如何设计和实现一个命令行客户端工具？ <!--[--><!--]--></a></span><span class="next"><a href="/iam/projects/29.html" class="" aria-label="第29节 代码测试（下）：Go 语言其他测试类型及 IAM 测试介绍"><!--[--><!--]--> 第29节 代码测试（下）：Go 语言其他测试类型及 IAM 测试介绍 <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app.60cd6b8c.js" defer></script>
  </body>
</html>

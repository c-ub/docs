<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.51">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="/img/1.jpg"><title>第38节 如何制作Docker镜像？ | 你好</title><meta name="description" content="链学社致力于打造出区块链去中心化的学习平台">
    <link rel="modulepreload" href="/assets/app.df174e55.js"><link rel="modulepreload" href="/assets/38.html.564c84b7.js"><link rel="modulepreload" href="/assets/38.html.d8605d22.js"><link rel="prefetch" href="/assets/index.html.25a7a27a.js"><link rel="prefetch" href="/assets/index.html.a36ccd78.js"><link rel="prefetch" href="/assets/1.html.461afd80.js"><link rel="prefetch" href="/assets/10.html.4f13ef50.js"><link rel="prefetch" href="/assets/11.html.f09f95c3.js"><link rel="prefetch" href="/assets/12.html.a67acf21.js"><link rel="prefetch" href="/assets/13.html.0420c962.js"><link rel="prefetch" href="/assets/14.html.b0b5806d.js"><link rel="prefetch" href="/assets/15.html.06f1cde4.js"><link rel="prefetch" href="/assets/16.html.2c2a072d.js"><link rel="prefetch" href="/assets/17.html.be392cda.js"><link rel="prefetch" href="/assets/18.html.8b213912.js"><link rel="prefetch" href="/assets/19.html.1dca5398.js"><link rel="prefetch" href="/assets/2.html.ad5997eb.js"><link rel="prefetch" href="/assets/20.html.1bd75582.js"><link rel="prefetch" href="/assets/21.html.9cb3d476.js"><link rel="prefetch" href="/assets/22.html.4c43a0a4.js"><link rel="prefetch" href="/assets/23.html.0341a155.js"><link rel="prefetch" href="/assets/24.html.f74332a7.js"><link rel="prefetch" href="/assets/25.html.32aca821.js"><link rel="prefetch" href="/assets/26.html.cc5ca1a2.js"><link rel="prefetch" href="/assets/27.html.09791ec4.js"><link rel="prefetch" href="/assets/28.html.4aa1094d.js"><link rel="prefetch" href="/assets/29.html.165cddd8.js"><link rel="prefetch" href="/assets/3.html.427f6088.js"><link rel="prefetch" href="/assets/30.html.5c492d35.js"><link rel="prefetch" href="/assets/31.html.b4a50d0d.js"><link rel="prefetch" href="/assets/32.html.3a8a6f2f.js"><link rel="prefetch" href="/assets/33.html.e8f65480.js"><link rel="prefetch" href="/assets/34.html.580498c1.js"><link rel="prefetch" href="/assets/35.html.2da63961.js"><link rel="prefetch" href="/assets/36.html.d8049f92.js"><link rel="prefetch" href="/assets/37.html.0dbda88b.js"><link rel="prefetch" href="/assets/39.html.84a2efa8.js"><link rel="prefetch" href="/assets/4.html.3a1de71e.js"><link rel="prefetch" href="/assets/40.html.532610aa.js"><link rel="prefetch" href="/assets/41.html.172bb15b.js"><link rel="prefetch" href="/assets/42.html.e71d9386.js"><link rel="prefetch" href="/assets/43.html.99ab5c93.js"><link rel="prefetch" href="/assets/44.html.ed92b7f3.js"><link rel="prefetch" href="/assets/45.html.2fa65b5e.js"><link rel="prefetch" href="/assets/46.html.f0dd66d1.js"><link rel="prefetch" href="/assets/47.html.4c6f6d3d.js"><link rel="prefetch" href="/assets/48.html.3cdc0986.js"><link rel="prefetch" href="/assets/49.html.936da8ed.js"><link rel="prefetch" href="/assets/5.html.0f758775.js"><link rel="prefetch" href="/assets/50.html.e8114b3c.js"><link rel="prefetch" href="/assets/51.html.8dba5f2d.js"><link rel="prefetch" href="/assets/52.html.4e857563.js"><link rel="prefetch" href="/assets/53.html.c513f2cd.js"><link rel="prefetch" href="/assets/54.html.cc298904.js"><link rel="prefetch" href="/assets/55.html.dd8403bb.js"><link rel="prefetch" href="/assets/56.html.a6fa9c2b.js"><link rel="prefetch" href="/assets/57.html.8d9ca11b.js"><link rel="prefetch" href="/assets/58.html.d2d6137f.js"><link rel="prefetch" href="/assets/59.html.64bfc6aa.js"><link rel="prefetch" href="/assets/6.html.4f7ba7c5.js"><link rel="prefetch" href="/assets/60.html.9d280a7e.js"><link rel="prefetch" href="/assets/61.html.93e3d982.js"><link rel="prefetch" href="/assets/62.html.7c25e781.js"><link rel="prefetch" href="/assets/63.html.c7c354a1.js"><link rel="prefetch" href="/assets/64.html.0d112a0c.js"><link rel="prefetch" href="/assets/65.html.8b9a0ae3.js"><link rel="prefetch" href="/assets/66.html.60a5c98f.js"><link rel="prefetch" href="/assets/67.html.65a79637.js"><link rel="prefetch" href="/assets/68.html.9c8743e4.js"><link rel="prefetch" href="/assets/69.html.f262d742.js"><link rel="prefetch" href="/assets/7.html.658a2ddf.js"><link rel="prefetch" href="/assets/70.html.a13f0df5.js"><link rel="prefetch" href="/assets/71.html.e5232458.js"><link rel="prefetch" href="/assets/72.html.55331bc1.js"><link rel="prefetch" href="/assets/73.html.cf7ccd53.js"><link rel="prefetch" href="/assets/74.html.48daf8af.js"><link rel="prefetch" href="/assets/75.html.4a47e12f.js"><link rel="prefetch" href="/assets/76.html.72c869e6.js"><link rel="prefetch" href="/assets/77.html.a9d9ff7d.js"><link rel="prefetch" href="/assets/78.html.0feb5171.js"><link rel="prefetch" href="/assets/79.html.7a6a2cc4.js"><link rel="prefetch" href="/assets/8.html.8d69e3db.js"><link rel="prefetch" href="/assets/80.html.88f5c71d.js"><link rel="prefetch" href="/assets/81.html.3ec4d333.js"><link rel="prefetch" href="/assets/82.html.70be117a.js"><link rel="prefetch" href="/assets/83.html.07de8b59.js"><link rel="prefetch" href="/assets/84.html.37bf069c.js"><link rel="prefetch" href="/assets/85.html.d88064c7.js"><link rel="prefetch" href="/assets/86.html.2ea4f0ba.js"><link rel="prefetch" href="/assets/87.html.fcd098dc.js"><link rel="prefetch" href="/assets/88.html.455f17e4.js"><link rel="prefetch" href="/assets/89.html.94c12162.js"><link rel="prefetch" href="/assets/9.html.3619251b.js"><link rel="prefetch" href="/assets/90.html.47f84836.js"><link rel="prefetch" href="/assets/91.html.f355cbb5.js"><link rel="prefetch" href="/assets/92.html.4b6d0a6b.js"><link rel="prefetch" href="/assets/93.html.8c027538.js"><link rel="prefetch" href="/assets/94.html.e175d373.js"><link rel="prefetch" href="/assets/95.html.58fba167.js"><link rel="prefetch" href="/assets/96.html.cfc1673c.js"><link rel="prefetch" href="/assets/97.html.71615abb.js"><link rel="prefetch" href="/assets/98.html.817dd510.js"><link rel="prefetch" href="/assets/99.html.41ed9550.js"><link rel="prefetch" href="/assets/404.html.c3e557d0.js"><link rel="prefetch" href="/assets/index.html.5078607b.js"><link rel="prefetch" href="/assets/index.html.238b898d.js"><link rel="prefetch" href="/assets/1.html.68bd8bc7.js"><link rel="prefetch" href="/assets/10.html.6703ed8a.js"><link rel="prefetch" href="/assets/11.html.087bca0d.js"><link rel="prefetch" href="/assets/12.html.54a22c52.js"><link rel="prefetch" href="/assets/13.html.4bb58d38.js"><link rel="prefetch" href="/assets/14.html.503f448c.js"><link rel="prefetch" href="/assets/15.html.8574c656.js"><link rel="prefetch" href="/assets/16.html.a1bd17bb.js"><link rel="prefetch" href="/assets/17.html.1efae1db.js"><link rel="prefetch" href="/assets/18.html.2f97fa21.js"><link rel="prefetch" href="/assets/19.html.3e0f7c64.js"><link rel="prefetch" href="/assets/2.html.58eeb18b.js"><link rel="prefetch" href="/assets/20.html.b8b46978.js"><link rel="prefetch" href="/assets/21.html.70c7de34.js"><link rel="prefetch" href="/assets/22.html.aa7bd96c.js"><link rel="prefetch" href="/assets/23.html.ad35e20a.js"><link rel="prefetch" href="/assets/24.html.0963e8cd.js"><link rel="prefetch" href="/assets/25.html.df593c5c.js"><link rel="prefetch" href="/assets/26.html.21e72cc8.js"><link rel="prefetch" href="/assets/27.html.abbc553f.js"><link rel="prefetch" href="/assets/28.html.eefcc4fe.js"><link rel="prefetch" href="/assets/29.html.b3a7277c.js"><link rel="prefetch" href="/assets/3.html.ece505c8.js"><link rel="prefetch" href="/assets/30.html.4139f101.js"><link rel="prefetch" href="/assets/31.html.78bdceca.js"><link rel="prefetch" href="/assets/32.html.b715024d.js"><link rel="prefetch" href="/assets/33.html.28fbd3f1.js"><link rel="prefetch" href="/assets/34.html.4a53b877.js"><link rel="prefetch" href="/assets/35.html.3714035c.js"><link rel="prefetch" href="/assets/36.html.6593b1dd.js"><link rel="prefetch" href="/assets/37.html.1030763e.js"><link rel="prefetch" href="/assets/39.html.9e6b9426.js"><link rel="prefetch" href="/assets/4.html.0cced93c.js"><link rel="prefetch" href="/assets/40.html.baa78d6a.js"><link rel="prefetch" href="/assets/41.html.ce225826.js"><link rel="prefetch" href="/assets/42.html.6ef135a0.js"><link rel="prefetch" href="/assets/43.html.235f7002.js"><link rel="prefetch" href="/assets/44.html.d18c82d2.js"><link rel="prefetch" href="/assets/45.html.2f2c2f8c.js"><link rel="prefetch" href="/assets/46.html.45e49c32.js"><link rel="prefetch" href="/assets/47.html.2071b30e.js"><link rel="prefetch" href="/assets/48.html.d1a08b55.js"><link rel="prefetch" href="/assets/49.html.5ebe1da7.js"><link rel="prefetch" href="/assets/5.html.92b708de.js"><link rel="prefetch" href="/assets/50.html.3a175eb7.js"><link rel="prefetch" href="/assets/51.html.d27f00bb.js"><link rel="prefetch" href="/assets/52.html.8b437f64.js"><link rel="prefetch" href="/assets/53.html.d913eb66.js"><link rel="prefetch" href="/assets/54.html.8271495e.js"><link rel="prefetch" href="/assets/55.html.bdc49926.js"><link rel="prefetch" href="/assets/56.html.3dc8abe7.js"><link rel="prefetch" href="/assets/57.html.7d8f4d4c.js"><link rel="prefetch" href="/assets/58.html.2e807b03.js"><link rel="prefetch" href="/assets/59.html.83549612.js"><link rel="prefetch" href="/assets/6.html.1d2cb545.js"><link rel="prefetch" href="/assets/60.html.fb941722.js"><link rel="prefetch" href="/assets/61.html.10d42607.js"><link rel="prefetch" href="/assets/62.html.63d223ec.js"><link rel="prefetch" href="/assets/63.html.afb0566c.js"><link rel="prefetch" href="/assets/64.html.88e70600.js"><link rel="prefetch" href="/assets/65.html.6ee1b8fd.js"><link rel="prefetch" href="/assets/66.html.ab8f36c8.js"><link rel="prefetch" href="/assets/67.html.bb9f4dde.js"><link rel="prefetch" href="/assets/68.html.081ecec1.js"><link rel="prefetch" href="/assets/69.html.94b26ac8.js"><link rel="prefetch" href="/assets/7.html.cef2e333.js"><link rel="prefetch" href="/assets/70.html.21112954.js"><link rel="prefetch" href="/assets/71.html.b6760737.js"><link rel="prefetch" href="/assets/72.html.46e6db4d.js"><link rel="prefetch" href="/assets/73.html.872f9067.js"><link rel="prefetch" href="/assets/74.html.e2fad9a6.js"><link rel="prefetch" href="/assets/75.html.41837637.js"><link rel="prefetch" href="/assets/76.html.bd895802.js"><link rel="prefetch" href="/assets/77.html.d16746b1.js"><link rel="prefetch" href="/assets/78.html.7573af34.js"><link rel="prefetch" href="/assets/79.html.4ba1b576.js"><link rel="prefetch" href="/assets/8.html.ffbe5f0d.js"><link rel="prefetch" href="/assets/80.html.964f8ea4.js"><link rel="prefetch" href="/assets/81.html.f0f8c8ea.js"><link rel="prefetch" href="/assets/82.html.42775672.js"><link rel="prefetch" href="/assets/83.html.dca364d9.js"><link rel="prefetch" href="/assets/84.html.03706d5c.js"><link rel="prefetch" href="/assets/85.html.32142600.js"><link rel="prefetch" href="/assets/86.html.bc85e920.js"><link rel="prefetch" href="/assets/87.html.406eea6e.js"><link rel="prefetch" href="/assets/88.html.2fa5b983.js"><link rel="prefetch" href="/assets/89.html.ac21d36d.js"><link rel="prefetch" href="/assets/9.html.b60314dd.js"><link rel="prefetch" href="/assets/90.html.ccb3b75c.js"><link rel="prefetch" href="/assets/91.html.42ecc4c5.js"><link rel="prefetch" href="/assets/92.html.50a515c1.js"><link rel="prefetch" href="/assets/93.html.b5657afc.js"><link rel="prefetch" href="/assets/94.html.c185d24f.js"><link rel="prefetch" href="/assets/95.html.ad73eb9e.js"><link rel="prefetch" href="/assets/96.html.cb8ab449.js"><link rel="prefetch" href="/assets/97.html.06281eee.js"><link rel="prefetch" href="/assets/98.html.23720464.js"><link rel="prefetch" href="/assets/99.html.ae6e8b44.js"><link rel="prefetch" href="/assets/404.html.e3b93612.js">
    <link rel="stylesheet" href="/assets/style.03848e77.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="切换侧边栏" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><!----><span class="site-name can-hide">你好</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="🤵关于我"><span class="title">🤵关于我</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="🤵关于我"><span class="title">🤵关于我</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a class="external-link" href="https://github.com/3293172751/cs-awesome-Block_Chain" rel="noopener noreferrer" target="_blank" aria-label="Github仓库"><!--[--><!--]--> Github仓库 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="http://nsddd.top" rel="noopener noreferrer" target="_blank" aria-label="我的博客"><!--[--><!--]--> 我的博客 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="https://www.zhihu.com/people/3293172751" rel="noopener noreferrer" target="_blank" aria-label="知乎"><!--[--><!--]--> 知乎 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="https://github.com/C-UB/" rel="noopener noreferrer" target="_blank" aria-label="⛓️链学社组织"><!--[--><!--]--> ⛓️链学社组织 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a href="/" class="" aria-label="🏠首页"><!--[--><!--]--> 🏠首页 <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://docker.nsddd.top/" rel="noopener noreferrer" target="_blank" aria-label="🐋docker文档"><!--[--><!--]--> 🐋docker文档 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="📚go文档"><span class="title">📚go文档</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="📚go文档"><span class="title">📚go文档</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/projec/" class="" aria-label="🔥 K8s-Iam 项目"><!--[--><!--]--> 🔥 K8s-Iam 项目 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/k8s/" class="" aria-label="🔥 k8s 教程"><!--[--><!--]--> 🔥 k8s 教程 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/k8s-iam/" class="" aria-label="🔥 iam 教程"><!--[--><!--]--> 🔥 iam 教程 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/3293172751/awesome-go" rel="noopener noreferrer" target="_blank" aria-label="查看源码"><!--[--><!--]--> 查看源码 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="切换颜色模式"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><div id="docsearch-container"></div></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="🤵关于我"><span class="title">🤵关于我</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="🤵关于我"><span class="title">🤵关于我</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a class="external-link" href="https://github.com/3293172751/cs-awesome-Block_Chain" rel="noopener noreferrer" target="_blank" aria-label="Github仓库"><!--[--><!--]--> Github仓库 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="http://nsddd.top" rel="noopener noreferrer" target="_blank" aria-label="我的博客"><!--[--><!--]--> 我的博客 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="https://www.zhihu.com/people/3293172751" rel="noopener noreferrer" target="_blank" aria-label="知乎"><!--[--><!--]--> 知乎 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="https://github.com/C-UB/" rel="noopener noreferrer" target="_blank" aria-label="⛓️链学社组织"><!--[--><!--]--> ⛓️链学社组织 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a href="/" class="" aria-label="🏠首页"><!--[--><!--]--> 🏠首页 <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://docker.nsddd.top/" rel="noopener noreferrer" target="_blank" aria-label="🐋docker文档"><!--[--><!--]--> 🐋docker文档 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="📚go文档"><span class="title">📚go文档</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="📚go文档"><span class="title">📚go文档</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/projec/" class="" aria-label="🔥 K8s-Iam 项目"><!--[--><!--]--> 🔥 K8s-Iam 项目 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/k8s/" class="" aria-label="🔥 k8s 教程"><!--[--><!--]--> 🔥 k8s 教程 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/k8s-iam/" class="" aria-label="🔥 iam 教程"><!--[--><!--]--> 🔥 iam 教程 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/3293172751/awesome-go" rel="noopener noreferrer" target="_blank" aria-label="查看源码"><!--[--><!--]--> 查看源码 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><a href="/" class="sidebar-item sidebar-heading" aria-label="🏠回到主页"><!--[--><!--]--> 🏠回到主页 <!--[--><!--]--></a><!----></li><li><p tabindex="0" class="sidebar-item sidebar-heading active">🔥 Go语言基础篇 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/iam/projects/1.html" class="sidebar-item" aria-label="第1节 IAM项目介绍"><!--[--><!--]--> 第1节 IAM项目介绍 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/2.html" class="sidebar-item" aria-label="第2节 IAM项目部署"><!--[--><!--]--> 第2节 IAM项目部署 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/3.html" class="sidebar-item" aria-label="第3节 设计规范"><!--[--><!--]--> 第3节 设计规范 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/4.html" class="sidebar-item" aria-label="第4节 Go语言项目设计"><!--[--><!--]--> 第4节 Go语言项目设计 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/5.html" class="sidebar-item" aria-label="第5节 设计并写出优雅的Go语言项目"><!--[--><!--]--> 第5节 设计并写出优雅的Go语言项目 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/6.html" class="sidebar-item" aria-label="第6节 API 风格设计"><!--[--><!--]--> 第6节 API 风格设计 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/7.html" class="sidebar-item" aria-label="第7节 高质量的Makefile"><!--[--><!--]--> 第7节 高质量的Makefile <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/8.html" class="sidebar-item" aria-label="第8节 IAM 项目如何进行研发流程管理"><!--[--><!--]--> 第8节 IAM 项目如何进行研发流程管理 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/9.html" class="sidebar-item" aria-label="第9节 静态代码检测"><!--[--><!--]--> 第9节 静态代码检测 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/10.html" class="sidebar-item" aria-label="第10节 如何生成 Swagger API 文档"><!--[--><!--]--> 第10节 如何生成 Swagger API 文档 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/11.html" class="sidebar-item" aria-label="第11节 设计一套科学的错误码"><!--[--><!--]--> 第11节 设计一套科学的错误码 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/12.html" class="sidebar-item" aria-label="第12节 记录和设计日志"><!--[--><!--]--> 第12节 记录和设计日志 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/13.html" class="sidebar-item" aria-label="第13节  从 0 编写一个日志包"><!--[--><!--]--> 第13节  从 0 编写一个日志包 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/14.html" class="sidebar-item" aria-label="第14节 Pflag、Viper、Cobra 核心功能介绍"><!--[--><!--]--> 第14节 Pflag、Viper、Cobra 核心功能介绍 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/15.html" class="sidebar-item" aria-label="第15节 如何构建一个优秀的企业应用框架"><!--[--><!--]--> 第15节 如何构建一个优秀的企业应用框架 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/16.html" class="sidebar-item" aria-label="第16节 Gin 框架"><!--[--><!--]--> 第16节 Gin 框架 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/17.html" class="sidebar-item" aria-label="第17节 认证机制：应用程序如何进行访问认证？"><!--[--><!--]--> 第17节 认证机制：应用程序如何进行访问认证？ <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/18.html" class="sidebar-item" aria-label="第18节 IAM 项目认证"><!--[--><!--]--> 第18节 IAM 项目认证 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/19.html" class="sidebar-item" aria-label="第19节 权限模型：5大权限模型是如何进行资源授权的？"><!--[--><!--]--> 第19节 权限模型：5大权限模型是如何进行资源授权的？ <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/20.html" class="sidebar-item" aria-label="第20节 控制流（上）：通过iam-apiserver设计，看Web服务的构建"><!--[--><!--]--> 第20节 控制流（上）：通过iam-apiserver设计，看Web服务的构建 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/21.html" class="sidebar-item" aria-label="第21节 控制流（下）：iam-apiserver服务核心功能实现讲解"><!--[--><!--]--> 第21节 控制流（下）：iam-apiserver服务核心功能实现讲解 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/22.html" class="sidebar-item" aria-label="第22节 ORM：CURD 神器 GORM 包介绍及实战"><!--[--><!--]--> 第22节 ORM：CURD 神器 GORM 包介绍及实战 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/23.html" class="sidebar-item" aria-label="第23节 数据流：通过iam-authz-server设计，看数据流服务的设计"><!--[--><!--]--> 第23节 数据流：通过iam-authz-server设计，看数据流服务的设计 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/24.html" class="sidebar-item" aria-label="第24节 数据处理：如何高效处理应用程序产生的数据？"><!--[--><!--]--> 第24节 数据处理：如何高效处理应用程序产生的数据？ <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/25.html" class="sidebar-item" aria-label="第25节  SDK 设计（上）：如何设计出一个优秀的 Go SDK？"><!--[--><!--]--> 第25节  SDK 设计（上）：如何设计出一个优秀的 Go SDK？ <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/26.html" class="sidebar-item" aria-label="第26节  SDK 设计（下）：IAM项目Go SDK设计和实现"><!--[--><!--]--> 第26节  SDK 设计（下）：IAM项目Go SDK设计和实现 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/27.html" class="sidebar-item" aria-label="第27节 效率神器：如何设计和实现一个命令行客户端工具？"><!--[--><!--]--> 第27节 效率神器：如何设计和实现一个命令行客户端工具？ <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/28.html" class="sidebar-item" aria-label="第28节 代码测试（上）：如何编写 Go 语言单元测试和性能测试用例？"><!--[--><!--]--> 第28节 代码测试（上）：如何编写 Go 语言单元测试和性能测试用例？ <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/29.html" class="sidebar-item" aria-label="第29节 代码测试（下）：Go 语言其他测试类型及 IAM 测试介绍"><!--[--><!--]--> 第29节 代码测试（下）：Go 语言其他测试类型及 IAM 测试介绍 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/30.html" class="sidebar-item" aria-label="第30节 性能分析（上）：如何分析 Go 语言代码的性能？"><!--[--><!--]--> 第30节 性能分析（上）：如何分析 Go 语言代码的性能？ <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/31.html" class="sidebar-item" aria-label="第31节 性能分析（下）：API Server性能测试和调优实战"><!--[--><!--]--> 第31节 性能分析（下）：API Server性能测试和调优实战 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/32.html" class="sidebar-item" aria-label="第32节 软件部署实战（上）：部署方案及负载均衡、高可用组件介绍"><!--[--><!--]--> 第32节 软件部署实战（上）：部署方案及负载均衡、高可用组件介绍 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/33.html" class="sidebar-item" aria-label="第33节 软件部署实战（中）：IAM 系统生产环境部署实战"><!--[--><!--]--> 第33节 软件部署实战（中）：IAM 系统生产环境部署实战 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/34.html" class="sidebar-item" aria-label="第34节 软件部署实战（下）：IAM系统安全加固、水平扩缩容实战"><!--[--><!--]--> 第34节 软件部署实战（下）：IAM系统安全加固、水平扩缩容实战 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/35.html" class="sidebar-item" aria-label="第35节 技术演进（上）：虚拟化技术演进之路"><!--[--><!--]--> 第35节 技术演进（上）：虚拟化技术演进之路 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/36.html" class="sidebar-item" aria-label="第36节 技术演进（下）：软件架构和应用生命周期技术演进之路"><!--[--><!--]--> 第36节 技术演进（下）：软件架构和应用生命周期技术演进之路 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/37.html" class="sidebar-item" aria-label="第37节 基于Kubernetes的云原生架构设计"><!--[--><!--]--> 第37节 基于Kubernetes的云原生架构设计 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/iam/projects/38.html" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="第38节 如何制作Docker镜像？"><!--[--><!--]--> 第38节 如何制作Docker镜像？ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/iam/projects/38.html#开始" class="router-link-active router-link-exact-active sidebar-item" aria-label="开始"><!--[--><!--]--> 开始 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/iam/projects/38.html#docker镜像的构建原理和方式" class="router-link-active router-link-exact-active sidebar-item" aria-label="Docker镜像的构建原理和方式"><!--[--><!--]--> Docker镜像的构建原理和方式 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/iam/projects/38.html#dockerfile指令介绍" class="router-link-active router-link-exact-active sidebar-item" aria-label="Dockerfile指令介绍"><!--[--><!--]--> Dockerfile指令介绍 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/iam/projects/38.html#dockerfile最佳实践" class="router-link-active router-link-exact-active sidebar-item" aria-label="Dockerfile最佳实践"><!--[--><!--]--> Dockerfile最佳实践 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/iam/projects/38.html#总结" class="router-link-active router-link-exact-active sidebar-item" aria-label="总结"><!--[--><!--]--> 总结 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/iam/projects/38.html#课后练习" class="router-link-active router-link-exact-active sidebar-item" aria-label="课后练习"><!--[--><!--]--> 课后练习 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/iam/projects/38.html#end-链接" class="router-link-active router-link-exact-active sidebar-item" aria-label="END 链接"><!--[--><!--]--> END 链接 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a href="/iam/projects/39.html" class="sidebar-item" aria-label="第39节 如何编写Kubernetes资源定义文件？"><!--[--><!--]--> 第39节 如何编写Kubernetes资源定义文件？ <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/40.html" class="sidebar-item" aria-label="第40节 IAM 容器化部署实战"><!--[--><!--]--> 第40节 IAM 容器化部署实战 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/41.html" class="sidebar-item" aria-label="第41节 服务编排（上）：Helm服务编排基础知识"><!--[--><!--]--> 第41节 服务编排（上）：Helm服务编排基础知识 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/42.html" class="sidebar-item" aria-label="第42节 服务编排（下）：基于Helm的服务编排部署实战"><!--[--><!--]--> 第42节 服务编排（下）：基于Helm的服务编排部署实战 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/43.html" class="sidebar-item" aria-label="第43节 基于 GitHub Actions 的 CI 实战"><!--[--><!--]--> 第43节 基于 GitHub Actions 的 CI 实战 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/44.html" class="sidebar-item" aria-label="第44节 可直接套用的 Go 编码规范"><!--[--><!--]--> 第44节 可直接套用的 Go 编码规范 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/45.html" class="sidebar-item" aria-label="第45节 Go Modules依赖包管理全讲"><!--[--><!--]--> 第45节 Go Modules依赖包管理全讲 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/46.html" class="sidebar-item" aria-label="第46节 IAM排障指南"><!--[--><!--]--> 第46节 IAM排障指南 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/47.html" class="sidebar-item" aria-label="第47节"><!--[--><!--]--> 第47节 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/48.html" class="sidebar-item" aria-label="第48节 分布式系统设计"><!--[--><!--]--> 第48节 分布式系统设计 <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/49.html" class="sidebar-item" aria-label="第49节 如何从小白进阶成 Go 语言专家？"><!--[--><!--]--> 第49节 如何从小白进阶成 Go 语言专家？ <!--[--><!--]--></a><!----></li><li><a href="/iam/projects/50.html" class="sidebar-item" aria-label="第50节"><!--[--><!--]--> 第50节 <!--[--><!--]--></a><!----></li><li><a class="external-link sidebar-item" href="https://nsddd.top/archives/contributors" rel="noopener noreferrer" target="_blank" aria-label="💝如何参与贡献？"><!--[--><!--]--> 💝如何参与贡献？ <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><ul><li><a href="https://github.com/cubxxw/iam" target="_blank" rel="noopener noreferrer">🔥 开源地址<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><h1 id="第38节-如何制作docker镜像" tabindex="-1"><a class="header-anchor" href="#第38节-如何制作docker镜像" aria-hidden="true">#</a> 第38节 如何制作Docker镜像？</h1><br><div><a href="37.md" style="float:left;">⬆️上一节🔗 </a><a href="39.md" style="float:right;"> ⬇️下一节🔗</a></div><br><blockquote><p>❤️💕💕During the winter vacation, I followed up and learned two projects: tiktok project and IAM project, and summarized and practiced the CloudNative project and Go language. I learned a lot in the process.Myblog:<a href="http://nsddd.top/" target="_blank" rel="noopener noreferrer">http://nsddd.top<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></blockquote><hr><nav class="table-of-contents"><ul><li><a aria-current="page" href="/iam/projects/38.html#开始" class="router-link-active router-link-exact-active">开始</a></li><li><a aria-current="page" href="/iam/projects/38.html#docker镜像的构建原理和方式" class="router-link-active router-link-exact-active">Docker镜像的构建原理和方式</a><ul><li><a aria-current="page" href="/iam/projects/38.html#通过docker-commit命令构建镜像" class="router-link-active router-link-exact-active">通过docker commit命令构建镜像</a></li><li><a aria-current="page" href="/iam/projects/38.html#通过dockerfile来构建镜像" class="router-link-active router-link-exact-active">通过Dockerfile来构建镜像</a></li><li><a aria-current="page" href="/iam/projects/38.html#其他制作镜像方式" class="router-link-active router-link-exact-active">其他制作镜像方式</a></li></ul></li><li><a aria-current="page" href="/iam/projects/38.html#dockerfile指令介绍" class="router-link-active router-link-exact-active">Dockerfile指令介绍</a></li><li><a aria-current="page" href="/iam/projects/38.html#dockerfile最佳实践" class="router-link-active router-link-exact-active">Dockerfile最佳实践</a></li><li><a aria-current="page" href="/iam/projects/38.html#总结" class="router-link-active router-link-exact-active">总结</a></li><li><a aria-current="page" href="/iam/projects/38.html#课后练习" class="router-link-active router-link-exact-active">课后练习</a></li><li><a aria-current="page" href="/iam/projects/38.html#end-链接" class="router-link-active router-link-exact-active">END 链接</a></li></ul></nav><p>[TOC]</p><h2 id="开始" tabindex="-1"><a class="header-anchor" href="#开始" aria-hidden="true">#</a> 开始</h2><p>要落地云原生架构，其中的一个核心点是通过容器来部署我们的应用。如果要使用容器来部署应用，那么制作应用的Docker镜像就是我们绕不开的关键一步。今天，我就来详细介绍下如何制作Docker镜像。</p><p>在这一讲中，我会先讲解下Docker镜像的构建原理和方式，然后介绍Dockerfile的指令，以及如何编写Dockerfile文件。最后，介绍下编写Dockerfile文件时要遵循的一些最佳实践。</p><h2 id="docker镜像的构建原理和方式" tabindex="-1"><a class="header-anchor" href="#docker镜像的构建原理和方式" aria-hidden="true">#</a> Docker镜像的构建原理和方式</h2><p>首先，我们来看下Docker镜像构建的原理和方式。</p><p>我们可以用多种方式来构建一个Docker镜像，最常用的有两种：</p><ul><li>通过<code>docker commit</code>命令，基于一个已存在的容器构建出镜像。</li><li>编写Dockerfile文件，并使用<code>docker build</code>命令来构建镜像。</li></ul><p>上面这两种方法中，镜像构建的底层原理是相同的，都是通过下面3个步骤来构建镜像：</p><ol><li>基于原镜像，启动一个Docker容器。</li><li>在容器中进行一些操作，例如执行命令、安装文件等。由这些操作产生的文件变更都会被记录在容器的存储层中。</li><li>将容器存储层的变更commit到新的镜像层中，并添加到原镜像上。</li></ol><p>下面，我们来具体讲解这两种构建Docker镜像的方式。</p><h3 id="通过docker-commit命令构建镜像" tabindex="-1"><a class="header-anchor" href="#通过docker-commit命令构建镜像" aria-hidden="true">#</a> 通过<code>docker commit</code>命令构建镜像</h3><p>我们可以通过<code>docker commit</code>来构建一个镜像，命令的格式为<code>docker commit [选项] [&lt;仓库名&gt;[:&lt;标签&gt;]]</code>。</p><p>下图中，我们通过4个步骤构建了Docker镜像<code>ccr.ccs.tencentyun.com/marmotedu/iam-apiserver-amd64:test</code>：</p><p><img src="http://sm.nsddd.top/sm202303062205203.png" alt="图片"></p><p>具体步骤如下：</p><ol><li>执行<code>docker ps</code>获取需要构建镜像的容器ID <code>48d1dbb89a7f</code>。</li><li>执行<code>docker pause 48d1dbb89a7f</code>暂停<code>48d1dbb89a7f</code>容器的运行。</li><li>执行<code>docker commit 48d1dbb89a7f ccr.ccs.tencentyun.com/marmotedu/iam-apiserver-amd64:test</code>，基于容器ID <code>48d1dbb89a7f</code>构建Docker镜像。</li><li>执行<code>docker images ccr.ccs.tencentyun.com/marmotedu/iam-apiserver-amd64:test</code>，查看镜像是否成功构建。</li></ol><p>这种镜像构建方式通常用在下面两个场景中：</p><ul><li>构建临时的测试镜像；</li><li>容器被入侵后，使用<code>docker commit</code>，基于被入侵的容器构建镜像，从而保留现场，方便以后追溯。</li></ul><p>除了这两种场景，我不建议你使用<code>docker commit</code>来构建生产现网环境的镜像。我这么说的主要原因有两个：</p><ul><li>使用<code>docker commit</code>构建的镜像包含了编译构建、安装软件，以及程序运行产生的大量无用文件，这会导致镜像体积很大，非常臃肿。</li><li>使用<code>docker commit</code>构建的镜像会丢失掉所有对该镜像的操作历史，无法还原镜像的构建过程，不利于镜像的维护。</li></ul><p>下面，我们再来看看如何使用<code>Dockerfile</code>来构建镜像。</p><h3 id="通过dockerfile来构建镜像" tabindex="-1"><a class="header-anchor" href="#通过dockerfile来构建镜像" aria-hidden="true">#</a> 通过<code>Dockerfile</code>来构建镜像</h3><p>在实际开发中，使用<code>Dockerfile</code>来构建是最常用，也最标准的镜像构建方法。<code>Dockerfile</code>是Docker用来构建镜像的文本文件，里面包含了一系列用来构建镜像的指令。</p><p><code>docker build</code>命令会读取<code>Dockerfile</code>的内容，并将<code>Dockerfile</code>的内容发送给Docker引擎，最终Docker引擎会解析<code>Dockerfile</code>中的每一条指令，构建出需要的镜像。</p><p><code>docker build</code>的命令格式为<code>docker build [OPTIONS] PATH | URL | -</code>。<code>PATH</code>、<code>URL</code>、<code>-</code>指出了构建镜像的上下文（context），context中包含了构建镜像需要的<code>Dockerfile</code>文件和其他文件。默认情况下，Docker构建引擎会查找context中名为<code>Dockerfile</code>的文件，但你可以通过<code>-f, --file</code>选项，手动指定<code>Dockerfile</code>文件。例如：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code> $ <span class="token function">docker</span> build <span class="token parameter variable">-f</span> Dockerfile <span class="token parameter variable">-t</span> ccr.ccs.tencentyun.com/marmotedu/iam-apiserver-amd64:test <span class="token builtin class-name">.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>使用<code>Dockerfile</code>构建镜像，本质上也是通过镜像创建容器，并在容器中执行相应的指令，然后停止容器，提交存储层的文件变更。和用<code>docker commit</code>构建镜像的方式相比，它有三个好处：</p><ul><li><code>Dockerfile</code> 包含了镜像制作的完整操作流程，其他开发者可以通过 Dockerfile 了解并复现制作过程。</li><li><code>Dockerfile</code> 中的每一条指令都会创建新的镜像层，这些镜像可以被 Docker Daemnon 缓存。再次制作镜像时，Docker 会尽量复用缓存的镜像层（using cache），而不是重新逐层构建，这样可以节省时间和磁盘空间。</li><li>Dockerfile 的操作流程可以通过<code>docker image history [镜像名称]</code>查询，方便开发者查看变更记录。</li></ul><p>这里，我们通过一个示例，来详细介绍下通过<code>Dockerfile</code>构建镜像的流程。</p><p>**首先，**我们需要编写一个<code>Dockerfile</code>文件。下面是iam-apiserver的<a href="https://github.com/marmotedu/iam/blob/v1.0.8/build/docker/iam-apiserver/Dockerfile" target="_blank" rel="noopener noreferrer">Dockerfile<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>文件内容：</p><div class="language-docker ext-docker line-numbers-mode"><pre class="language-docker"><code><span class="token instruction"><span class="token keyword">FROM</span> centos:centos8</span>
<span class="token instruction"><span class="token keyword">LABEL</span> maintainer=<span class="token string">&quot;&lt;colin404@foxmail.com&gt;&quot;</span></span>

<span class="token instruction"><span class="token keyword">RUN</span> ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</span>
<span class="token instruction"><span class="token keyword">RUN</span> echo <span class="token string">&quot;Asia/Shanghai&quot;</span> &gt; /etc/timezone</span>

<span class="token instruction"><span class="token keyword">WORKDIR</span> /opt/iam</span>
<span class="token instruction"><span class="token keyword">COPY</span> iam-apiserver /opt/iam/bin/</span>

<span class="token instruction"><span class="token keyword">ENTRYPOINT</span> [<span class="token string">&quot;/opt/iam/bin/iam-apiserver&quot;</span>]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这里选择<code>centos:centos8</code>作为基础镜像，是因为<code>centos:centos8</code>镜像中包含了基本的排障工具，例如<code>vi</code>、<code>cat</code>、<code>curl</code>、<code>mkdir</code>、<code>cp</code>等工具。</p><p>**接着，**执行<code>docker build</code>命令来构建镜像：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">docker</span> build <span class="token parameter variable">-f</span> Dockerfile <span class="token parameter variable">-t</span> ccr.ccs.tencentyun.com/marmotedu/iam-apiserver-amd64:test <span class="token builtin class-name">.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>执行<code>docker build</code>后的构建流程为：</p><p><strong>第一步</strong>，<code>docker build</code>会将context中的文件打包传给Docker daemon。如果context中有<code>.dockerignore</code>文件，则会从上传列表中删除满足<code>.dockerignore</code>规则的文件。</p><p>这里有个例外，如果<code>.dockerignore</code>文件中有<code>.dockerignore</code>或者<code>Dockerfile</code>，<code>docker build</code>命令在排除文件时会忽略掉这两个文件。如果指定了镜像的tag，还会对repository和tag进行验证。</p><p><strong>第二步</strong>，<code>docker build</code>命令向Docker server发送HTTP请求，请求Docker server构建镜像，请求中包含了需要的context信息。</p><p><strong>第三步</strong>，Docker server接收到构建请求之后，会执行以下流程来构建镜像：</p><ol><li>创建一个临时目录，并将context中的文件解压到该目录下。</li><li>读取并解析Dockerfile，遍历其中的指令，根据命令类型分发到不同的模块去执行。</li><li>Docker构建引擎为每一条指令创建一个临时容器，在临时容器中执行指令，然后commit容器，生成一个新的镜像层。</li><li>最后，将所有指令构建出的镜像层合并，形成build的最后结果。最后一次commit生成的镜像ID就是最终的镜像ID。</li></ol><p>为了提高构建效率，<code>docker build</code>默认会缓存已有的镜像层。如果构建镜像时发现某个镜像层已经被缓存，就会直接使用该缓存镜像，而不用重新构建。如果不希望使用缓存的镜像，可以在执行<code>docker build</code>命令时，指定<code>--no-cache=true</code>参数。</p><p>Docker匹配缓存镜像的规则为：遍历缓存中的基础镜像及其子镜像，检查这些镜像的构建指令是否和当前指令完全一致，如果不一样，则说明缓存不匹配。对于<code>ADD</code>、<code>COPY</code>指令，还会根据文件的校验和（checksum）来判断添加到镜像中的文件是否相同，如果不相同，则说明缓存不匹配。</p><p>这里要注意，缓存匹配检查不会检查容器中的文件。比如，当使用<code>RUN apt-get -y update</code>命令更新了容器中的文件时，缓存策略并不会检查这些文件，来判断缓存是否匹配。</p><p>最后，我们可以通过<code>docker history</code>命令来查看镜像的构建历史，如下图所示：</p><p><img src="http://sm.nsddd.top/sm202303062208067.png" alt="图片"></p><h3 id="其他制作镜像方式" tabindex="-1"><a class="header-anchor" href="#其他制作镜像方式" aria-hidden="true">#</a> 其他制作镜像方式</h3><p>上面介绍的是两种最常用的镜像构建方式，还有一些其他的镜像创建方式，这里我简单介绍两种。</p><p><strong>通过<code>docker save</code>和<code>docker load</code>命令构建：</strong></p><p><code>docker save</code>用来将镜像保存为一个tar文件，<code>docker load</code>用来将tar格式的镜像文件加载到当前机器上，例如：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 在 A 机器上执行，并将 nginx-v1.0.0.tar.gz 复制到 B 机器</span>
$ <span class="token function">docker</span> save nginx <span class="token operator">|</span> <span class="token function">gzip</span> <span class="token operator">&gt;</span> nginx-v1.0.0.tar.gz

<span class="token comment"># 在 B 机器上执行</span>
$ <span class="token function">docker</span> load <span class="token parameter variable">-i</span> nginx-v1.0.0.tar.gz
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通过上面的命令，我们就在机器B上创建了<code>nginx</code>镜像。</p><p><strong>通过<code>docker export</code>和<code>docker import</code>命令构建：</strong></p><p>我们先通过<code>docker export</code> 保存镜像，再通过<code>docker import</code> 加载镜像，具体命令如下：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 在 A 机器上执行，并将 nginx-v1.0.0.tar.gz 复制到 B 机器</span>
$ <span class="token function">docker</span> <span class="token builtin class-name">export</span> nginx <span class="token operator">&gt;</span> nginx-v1.0.0.tar.gz

<span class="token comment"># 在 B 机器上执行</span>
$ <span class="token function">docker</span> <span class="token function">import</span> - nginx:v1.0.0 nginx-v1.0.0.tar.gz
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通过<code>docker export</code>导出的镜像和通过<code>docker save</code>保存的镜像相比，会丢失掉所有的镜像构建历史。在实际生产环境中，我不建议你通过<code>docker save</code>和<code>docker export</code>这两种方式来创建镜像。我比较推荐的方式是：在A机器上将镜像push到镜像仓库，在B机器上从镜像仓库pull该镜像。</p><h2 id="dockerfile指令介绍" tabindex="-1"><a class="header-anchor" href="#dockerfile指令介绍" aria-hidden="true">#</a> Dockerfile指令介绍</h2><p>上面，我介绍了一些与Docker镜像构建有关的基础知识。在实际生产环境中，我们标准的做法是通过Dockerfile来构建镜像，这就要求你会编写Dockerfile文件。接下来，我就详细介绍下如何编写Dockerfile文件。</p><p>Dockerfile指令的基本格式如下：</p><div class="language-docker ext-docker line-numbers-mode"><pre class="language-docker"><code><span class="token comment"># Comment</span>
INSTRUCTION arguments
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><code>INSTRUCTION</code>是指令，不区分大小写，但我的建议是指令都大写，这样可以与参数进行区分。Dockerfile中，以 <code>#</code> 开头的行是注释，而在其他位置出现的 <code>#</code> 会被当成参数，例如：</p><div class="language-docker ext-docker line-numbers-mode"><pre class="language-docker"><code><span class="token comment"># Comment</span>
<span class="token instruction"><span class="token keyword">RUN</span> echo <span class="token string">&#39;hello world # dockerfile&#39;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>一个Dockerfile文件中包含了多条指令，这些指令可以分为5类。</p><ul><li>定义基础镜像的指令：<strong>FROM</strong>；</li><li>定义镜像维护者的指令：<strong>MAINTAINER</strong>（可选）；</li><li>定义镜像构建过程的指令：<strong>COPY</strong>、ADD、<strong>RUN</strong>、USER、<strong>WORKDIR</strong>、ARG、<strong>ENV</strong>、VOLUME、<strong>ONBUILD</strong>；</li><li>定义容器启动时执行命令的指令：<strong>CMD</strong>、<strong>ENTRYPOINT</strong>；</li><li>其他指令：EXPOSE、HEALTHCHECK、STOPSIGNAL。</li></ul><p>其中，加粗的指令是编写Dockerfile时经常用到的指令，需要你重点了解下。我把这些常用Dockerfile指令的介绍放在了GitHub上，你可以看看这个<a href="https://github.com/marmotedu/geekbang-go/blob/master/Dockerfile%E6%8C%87%E4%BB%A4%E8%AF%A6%E8%A7%A3.md" target="_blank" rel="noopener noreferrer">Dockerfile指令详解<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>。</p><p>下面是一个Dockerfile示例：</p><div class="language-docker ext-docker line-numbers-mode"><pre class="language-docker"><code><span class="token comment"># 第一行必须指定构建该镜像所基于的容器镜像</span>
<span class="token instruction"><span class="token keyword">FROM</span> centos:centos8</span>

<span class="token comment"># 维护者信息</span>
<span class="token instruction"><span class="token keyword">MAINTAINER</span> Lingfei Kong &lt;colin404@foxmail.com&gt;</span>

<span class="token comment"># 镜像的操作指令</span>
<span class="token instruction"><span class="token keyword">RUN</span> ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</span>
<span class="token instruction"><span class="token keyword">RUN</span> echo <span class="token string">&quot;Asia/Shanghai&quot;</span> &gt; /etc/timezone</span>
<span class="token instruction"><span class="token keyword">WORKDIR</span> /opt/iam</span>
<span class="token instruction"><span class="token keyword">COPY</span> iam-apiserver /opt/iam/bin/</span>

<span class="token comment"># 容器启动时执行指令</span>
<span class="token instruction"><span class="token keyword">ENTRYPOINT</span> [<span class="token string">&quot;/opt/iam/bin/iam-apiserver&quot;</span>]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Docker会顺序解释并执行Dockerfile中的指令，并且第一条指令必须是<code>FROM</code>，<code>FROM</code> 用来指定构建镜像的基础镜像。接下来，一般会指定镜像维护者的信息。后面是镜像操作的指令，最后会通过<code>CMD</code>或者<code>ENTRYPOINT</code>来指定容器启动的命令和参数。</p><h2 id="dockerfile最佳实践" tabindex="-1"><a class="header-anchor" href="#dockerfile最佳实践" aria-hidden="true">#</a> Dockerfile最佳实践</h2><p>上面我介绍了Dockerfile的指令，但在编写Dockerfile时，只知道这些指令是不够的，还不能编写一个合格的Dockerfile。我们还需要遵循一些编写 Dockerfile的最佳实践。这里，我总结了一份编写 Dockerfile的最佳实践清单，你可以参考。</p><ol><li>建议所有的Dockerfile指令大写，这样做可以很好地跟在镜像内执行的指令区分开来。</li><li>在选择基础镜像时，尽量选择官方的镜像，并在满足要求的情况下，尽量选择体积小的镜像。目前，Linux镜像大小有以下关系：<code>busybox &lt; debian &lt; centos &lt; ubuntu</code>。最好确保同一个项目中使用一个统一的基础镜像。如无特殊需求，可以选择使用<code>debian:jessie</code>或者<code>alpine</code>。</li><li>在构建镜像时，删除不需要的文件，只安装需要的文件，保持镜像干净、轻量。</li><li>使用更少的层，把相关的内容放到一个层，并使用换行符进行分割。这样可以进一步减小镜像的体积，也方便查看镜像历史。</li><li>不要在Dockerfile中修改文件的权限。因为如果修改文件的权限，Docker在构建时会重新复制一份，这会导致镜像体积越来越大。</li><li>给镜像打上标签，标签可以帮助你理解镜像的功能，例如：<code>docker build -t=&quot;nginx:3.0-onbuild&quot;</code>。</li><li><code>FROM</code>指令应该包含tag，例如使用<code>FROM debian:jessie</code>，而不是<code>FROM debian</code>。</li><li>充分利用缓存。Docker构建引擎会顺序执行Dockerfile中的指令，而且一旦缓存失效，后续命令将不能使用缓存。为了有效地利用缓存，需要尽量将所有的Dockerfile文件中相同的部分都放在前面，而将不同的部分放在后面。</li><li>优先使用<code>COPY</code>而非<code>ADD</code>指令。和<code>ADD</code>相比，<code>COPY</code> 功能简单，而且也够用。<code>ADD</code>可变的行为会导致该指令的行为不清晰，不利于后期维护和理解。</li><li>推荐将<code>CMD</code>和<code>ENTRYPOINT</code>指令结合使用，使用execl格式的<code>ENTRYPOINT</code>指令设置固定的默认命令和参数，然后使用<code>CMD</code>指令设置可变的参数。</li><li>尽量使用Dockerfile共享镜像。通过共享Dockerfile，可以使开发者明确知道Docker镜像的构建过程，并且可以将Dockerfile文件加入版本控制，跟踪起来。</li><li>使用<code>.dockerignore</code>忽略构建镜像时非必需的文件。忽略无用的文件，可以提高构建速度。</li><li>使用多阶段构建。多阶段构建可以大幅减小最终镜像的体积。例如，<code>COPY</code>指令中可能包含一些安装包，安装完成之后这些内容就废弃掉。下面是一个简单的多阶段构建示例：</li></ol><div class="language-docker ext-docker line-numbers-mode"><pre class="language-docker"><code><span class="token instruction"><span class="token keyword">FROM</span> golang:1.11-alpine <span class="token keyword">AS</span> build</span>

<span class="token comment"># 安装依赖包</span>
<span class="token instruction"><span class="token keyword">RUN</span> go get github.com/golang/mock/mockgen</span>

<span class="token comment"># 复制源码并执行build，此处当文件有变化会产生新的一层镜像层</span>
<span class="token instruction"><span class="token keyword">COPY</span> . /go/src/iam/</span>
<span class="token instruction"><span class="token keyword">RUN</span> go build -o /bin/iam</span>

<span class="token comment"># 缩小到一层镜像</span>
<span class="token instruction"><span class="token keyword">FROM</span> busybox</span>
<span class="token instruction"><span class="token keyword">COPY</span> <span class="token options"><span class="token property">--from</span><span class="token punctuation">=</span><span class="token string">build</span></span> /bin/iam /bin/iam</span>
<span class="token instruction"><span class="token keyword">ENTRYPOINT</span> [<span class="token string">&quot;/bin/iam&quot;</span>]</span>
<span class="token instruction"><span class="token keyword">CMD</span> [<span class="token string">&quot;--help&quot;</span>]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="总结" tabindex="-1"><a class="header-anchor" href="#总结" aria-hidden="true">#</a> 总结</h2><p>如果你想使用Docker容器来部署应用，那么就需要制作Docker镜像。今天，我介绍了如何制作Docker镜像。</p><p>你可以使用这两种方式来构建Docker镜像：</p><ul><li>通过 <code>docker commit</code> 命令，基于一个已存在的容器构建出镜像。</li><li>通过编写Dockerfile文件，并使用 <code>docker build</code> 命令来构建镜像。</li></ul><p>这两种方法中，镜像构建的底层原理是相同的：</p><ol><li>基于原镜像启动一个Docker容器。</li><li>在容器中进行一些操作，例如执行命令、安装文件等，由这些操作产生的文件变更都会被记录在容器的存储层中。</li><li>将容器存储层的变更commit到新的镜像层中，并添加到原镜像上。</li></ol><p>此外，我们还可以使用 <code>docker save</code> / <code>docker load</code> 和 <code>docker export</code> / <code>docker import</code> 来复制Docker镜像。</p><p>在实际生产环境中，我们标准的做法是通过Dockerfile来构建镜像。使用Dockerfile构建镜像，就需要你编写Dockerfile文件。Dockerfile支持多个指令，这些指令可以分为5类，对指令的具体介绍你可以再返回复习一遍。</p><p>另外，我们在构建Docker镜像时，也要遵循一些最佳实践，具体你可以参考我给你总结的最佳实践清单。</p><h2 id="课后练习" tabindex="-1"><a class="header-anchor" href="#课后练习" aria-hidden="true">#</a> 课后练习</h2><ol><li>思考下，为什么在编写Dockerfile时，“把相关的内容放到一个层，使用换行符 ``进行分割”可以减小镜像的体积？</li><li>尝试一下，为你正在开发的应用编写Dockerfile文件，并成功构建出Docker镜像。</li></ol><h2 id="end-链接" tabindex="-1"><a class="header-anchor" href="#end-链接" aria-hidden="true">#</a> END 链接</h2><ul><li><div><a href="37.md" style="float:left;">⬆️上一节🔗 </a><a href="39.md" style="float:right;"> ️下一节🔗</a></div></li></ul><ul><li><p><a href="/iam/" class="">Ⓜ️回到目录🏠</a></p></li><li><p><a href="https://nsddd.top/archives/contributors" target="_blank" rel="noopener noreferrer"><strong>🫵参与贡献💞❤️‍🔥💖</strong><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>)</p></li><li><p>✴️版权声明 © ：本书所有内容遵循<a href="http://zh.wikipedia.org/wiki/Wikipedia:CC-by-sa-3.0%E5%8D%8F%E8%AE%AE%E6%96%87%E6%9C%AC" target="_blank" rel="noopener noreferrer">CC-BY-SA 3.0协议（署名-相同方式共享）©<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></li></ul></div><!--[--><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="external-link meta-item-label" href="https://github.com/3293172751/awesome-go/edit/master/docs/iam/projects/38.md" rel="noopener noreferrer" target="_blank" aria-label="在GitHub上贡献此页面"><!--[--><!--]--> 在GitHub上贡献此页面 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!----><!----></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/iam/projects/37.html" class="" aria-label="第37节 基于Kubernetes的云原生架构设计"><!--[--><!--]--> 第37节 基于Kubernetes的云原生架构设计 <!--[--><!--]--></a></span><span class="next"><a href="/iam/projects/39.html" class="" aria-label="第39节 如何编写Kubernetes资源定义文件？"><!--[--><!--]--> 第39节 如何编写Kubernetes资源定义文件？ <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app.df174e55.js" defer></script>
  </body>
</html>
